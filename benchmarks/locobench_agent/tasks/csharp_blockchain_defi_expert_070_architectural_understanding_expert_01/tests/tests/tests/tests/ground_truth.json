{
  "ground_truth": "A successful solution will be a well-structured Markdown document (`PROPOSAL.md`) that contains the following key insights:\n\n*   **Affected Components:** `TransactionProcessor`, `StakingService`, `GovernanceService`, `P2PService`, and `ApiGateway` are the primary stakeholders. The proposal should note that every component using `IEventBus` is affected.\n*   **Data Consistency Solution:** The proposal MUST identify the loss of atomicity as the primary challenge. The gold-standard solution presented should be the **Transactional Outbox Pattern**. A naive solution that simply replaces the bus implementation without addressing this consistency gap is incorrect.\n*   **Configuration Example (`appsettings.json`):**\n    ```json\n    \"MessageBroker\": {\n      \"HostName\": \"rabbitmq.utilitychain.net\",\n      \"UserName\": \"user\",\n      \"Password\": \"password\",\n      \"ExchangeName\": \"utilitychain_events\"\n    }\n    ```\n*   **DI Changes (`Startup.cs`):** The report must show the change from `services.AddSingleton<IEventBus, InMemoryEventBus>();` to something like `services.AddSingleton<IEventBus, RabbitMqEventBus>();` and also show the registration of the outbox poller service: `services.AddHostedService<OutboxProcessorService>();`.\n*   **Resilience Strategy:** The proposal must explicitly recommend using **Dead-Letter Queues (DLQs)** to handle messages that repeatedly fail processing, preventing poison messages from halting the system. It should also recommend **configurable retry policies with exponential backoff** for transient errors like network hiccups when connecting to the broker.\n*   **Trade-off Analysis:** The analysis must be balanced. It should praise the move for enabling scalability, fault isolation, and independent deployments. Critically, it must also acknowledge the costs: increased operational overhead (managing a message broker cluster), introduction of network latency for inter-service calls, and the added complexity of ensuring eventual consistency.",
  "context_files": [
    "UtilityChainCoreSuite/config/node-config.default.json",
    "UtilityChainCoreSuite/src/UtilityChain.Node/appsettings.json",
    "UtilityChainCoreSuite/src/UtilityChain.Networking/MessageObserver.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Core/Abstractions/IEventBus.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Governance/GovernanceService.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Core/Services/InMemoryEventBus.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Staking/StakingService.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Networking/P2PService.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Tokens/TokenService.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Cli/CliService.cs",
    "UtilityChainCoreSuite/docs/adr/003-event-driven-module-communication.md",
    "UtilityChainCoreSuite/src/UtilityChain.Wallet/WalletService.cs",
    "UtilityChainCoreSuite/src/UtilityChain.ApiGateway/ApiProxyService.cs",
    "UtilityChainCoreSuite/docs/adr/001-monolithic-architecture.md",
    "UtilityChainCoreSuite/src/UtilityChain.Core/Abstractions/IStateRepository.cs",
    "UtilityChainCoreSuite/docs/architecture.md",
    "UtilityChainCoreSuite/src/UtilityChain.TransactionProcessing/Factories/ContractCallTransactionFactory.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Governance/ProposalStateMachine.cs",
    "UtilityChainCoreSuite/src/UtilityChain.VM/IContract.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Tokens/TokenFactory.cs",
    "UtilityChainCoreSuite/src/UtilityChain.TransactionProcessing/TransactionPool.cs",
    "UtilityChainCoreSuite/src/UtilityChain.TransactionProcessing/TransactionValidator.cs",
    "UtilityChainCoreSuite/src/UtilityChain.TransactionProcessing/Factories/TransferTransactionFactory.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Tokens/Standards/IURC20.cs",
    "UtilityChainCoreSuite/LICENSE",
    "UtilityChainCoreSuite/src/UtilityChain.Core/State/StateMachine.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Governance/Proposal.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Cryptography/Signature.cs",
    "UtilityChainCoreSuite/src/UtilityChain.VM/SmartContractEngine.cs",
    "UtilityChainCoreSuite/src/UtilityChain.VM/ContractExecutor.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Tokens/NFTMinter.cs",
    "UtilityChainCoreSuite/src/UtilityChain.ApiGateway/GatewayController.cs",
    "UtilityChainCoreSuite/src/UtilityChain.TransactionProcessing/Factories/StakingTransactionFactory.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Core/Data/Account.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Consensus/ConsensusEngine.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Wallet/WalletProxy.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Networking/Peer.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Core/Data/Block.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Core/State/WorldState.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Node/Startup.cs",
    "UtilityChainCoreSuite/src/UtilityChain.TransactionProcessing/TransactionProcessor.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Consensus/Strategies/ProofOfAuthorityStrategy.cs",
    "UtilityChainCoreSuite/src/UtilityChain.ApiGateway/Startup.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Node/Program.cs",
    "UtilityChainCoreSuite/src/UtilityChain.VM/ContractState.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Consensus/Strategies/ProofOfStakeStrategy.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Cli/Commands/WalletCommands.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Core/Data/Transaction.cs",
    "UtilityChainCoreSuite/src/UtilityChain.VM/Triggers/EventTrigger.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Staking/Stake.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Wallet/KeyStore.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Node/NodeHost.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Cli/Commands/GovernanceCommands.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Consensus/ConsensusContext.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Cli/Commands/NodeCommands.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Networking/Message.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Cryptography/ICryptoProvider.cs",
    "UtilityChainCoreSuite/docs/guides/04-smart-contract-dev.md",
    "UtilityChainCoreSuite/src/UtilityChain.Cryptography/DefaultCryptoProvider.cs",
    "UtilityChainCoreSuite/src/UtilityChain.ApiGateway/GraphQL/Mutation.cs",
    "UtilityChainCoreSuite/docs/guides/03-wallet-guide.md",
    "UtilityChainCoreSuite/docs/guides/02-cli-reference.md",
    "UtilityChainCoreSuite/src/UtilityChain.Staking/IStakingRewardStrategy.cs",
    "UtilityChainCoreSuite/docs/api/rest/swagger.json",
    "UtilityChainCoreSuite/src/UtilityChain.Cryptography/Hashing.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Tokens/Standards/IURC721.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Cryptography/KeyPair.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Wallet/Desktop/MainWindow.axaml",
    "UtilityChainCoreSuite/src/UtilityChain.Governance/Policies/MajorityVotePolicy.cs",
    "UtilityChainCoreSuite/docs/adr/002-pluggable-consensus-strategy.md",
    "UtilityChainCoreSuite/src/UtilityChain.Consensus/IConsensusStrategy.cs",
    "UtilityChainCoreSuite/docs/api/graphql/schema.graphql",
    "UtilityChainCoreSuite/docs/guides/01-setup-guide.md",
    "UtilityChainCoreSuite/src/UtilityChain.Governance/IGovernancePolicy.cs",
    "UtilityChainCoreSuite/src/UtilityChain.Staking/Strategies/InflationaryRewardStrategy.cs",
    "UtilityChainCoreSuite/docs/guides/05-governance-guide.md",
    "UtilityChainCoreSuite/src/UtilityChain.Staking/Strategies/FixedRewardStrategy.cs"
  ],
  "task_category": "architectural_understanding",
  "evaluation_criteria": [
    "correctly_identifies_event_bus_usage: Accurately lists the key services that publish and subscribe to the IEventBus.",
    "understands_current_architecture_limitations: Clearly articulates why the synchronous, in-memory event bus is a scalability and resilience risk.",
    "addresses_asynchronous_consistency_challenge: Identifies the atomicity problem and proposes a robust pattern like the Transactional Outbox to solve it. This is a critical criterion.",
    "proposes_concrete_config_and_startup_changes: Provides specific, correct examples of changes required in `appsettings.json` and `Startup.cs`.",
    "analyzes_new_failure_modes_and_resilience: Demonstrates foresight by identifying new risks (broker failure, poison messages) and proposing standard solutions (DLQs, retries).",
    "evaluates_architectural_tradeoffs: Presents a balanced view of the pros and cons of the proposed architectural change.",
    "report_clarity_and_structure: The final Markdown proposal is well-organized, clearly written, and follows the requested structure."
  ]
}