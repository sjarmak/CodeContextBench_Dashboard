{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://lexilearn.ai/schemas/feedback_schema.json",
  "title": "LexiLearn Feedback Schema",
  "description": "Schema definition for feedback artifacts generated by the LexiLearn MVC Orchestrator. This schema is used by the validation subsystem in both Model and Controller layers to ensure that feedback JSON files exchanged among services are well-formed and versioned.",
  "type": "object",
  "required": [
    "feedback_id",
    "user_id",
    "session_id",
    "model_version",
    "timestamp_utc",
    "locale",
    "application",
    "items"
  ],
  "additionalProperties": false,
  "properties": {
    "feedback_id": {
      "type": "string",
      "description": "A UUID v4 that uniquely identifies a feedback artifact.",
      "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
    },
    "user_id": {
      "type": "string",
      "description": "The unique identifier for the learner or educator receiving the feedback.",
      "minLength": 1,
      "maxLength": 128
    },
    "session_id": {
      "type": "string",
      "description": "The unique identifier for the learning session that produced the feedback.",
      "minLength": 1,
      "maxLength": 128
    },
    "model_version": {
      "type": "string",
      "description": "Semantic version of the model (e.g., '3.1.4') that generated the feedback.",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-[\\da-zA-Z\\-\\.]+)?(?:\\+[\\da-zA-Z\\-\\.]+)?$"
    },
    "timestamp_utc": {
      "type": "string",
      "description": "RFC 3339 timestamp in UTC indicating when the feedback was generated.",
      "format": "date-time"
    },
    "locale": {
      "type": "string",
      "description": "BCP 47 locale code representing the learner's locale (e.g., 'en-US').",
      "pattern": "^[a-zA-Z]{2,3}(?:-[a-zA-Z]{2})?$"
    },
    "application": {
      "type": "object",
      "description": "Metadata about the client application requesting feedback.",
      "required": ["name", "version"],
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string",
          "description": "Application or microservice name.",
          "minLength": 1,
          "maxLength": 128
        },
        "version": {
          "type": "string",
          "description": "Semantic version of the client application.",
          "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-[\\da-zA-Z\\-\\.]+)?(?:\\+[\\da-zA-Z\\-\\.]+)?$"
        }
      }
    },
    "items": {
      "type": "array",
      "description": "Array of feedback items produced by the model.",
      "minItems": 1,
      "maxItems": 100,
      "items": {
        "type": "object",
        "required": ["type", "message", "confidence"],
        "additionalProperties": false,
        "properties": {
          "type": {
            "type": "string",
            "description": "Category of feedback.",
            "enum": [
              "GRAMMAR",
              "VOCABULARY",
              "PRONUNCIATION",
              "COMPREHENSION",
              "FLUENCY",
              "CONTENT",
              "STRUCTURE",
              "OTHER"
            ]
          },
          "message": {
            "type": "string",
            "description": "Human-readable feedback message.",
            "minLength": 1,
            "maxLength": 4096
          },
          "confidence": {
            "type": "number",
            "description": "The model's confidence score for this feedback item (0.0 to 1.0).",
            "minimum": 0.0,
            "maximum": 1.0
          },
          "suggestions": {
            "type": "array",
            "description": "Optional model suggestions for improvement.",
            "minItems": 0,
            "maxItems": 10,
            "items": {
              "type": "string",
              "minLength": 1,
              "maxLength": 1024
            }
          },
          "evidence": {
            "type": "object",
            "description": "Optional evidence or excerpts that justify the feedback.",
            "additionalProperties": false,
            "properties": {
              "excerpt": {
                "type": "string",
                "description": "Text or transcript excerpt.",
                "maxLength": 2048
              },
              "offsets": {
                "type": "array",
                "description": "Offsets within the source text where the excerpt appears.",
                "items": {
                  "type": "object",
                  "required": ["start", "end"],
                  "additionalProperties": false,
                  "properties": {
                    "start": { "type": "integer", "minimum": 0 },
                    "end": { "type": "integer", "minimum": 0 }
                  }
                },
                "minItems": 0,
                "maxItems": 10
              }
            }
          },
          "actionable": {
            "type": "boolean",
            "description": "Whether the feedback requires learner action."
          },
          "created_at": {
            "type": "string",
            "description": "RFC 3339 timestamp (UTC) when this item was created. Falls back to parent timestamp if omitted.",
            "format": "date-time"
          }
        }
      }
    },
    "aggregate_scores": {
      "type": "object",
      "description": "Overall performance metrics summarizing the feedback.",
      "additionalProperties": false,
      "properties": {
        "fluency": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0
        },
        "accuracy": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0
        },
        "complexity": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0
        },
        "comprehension": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0
        }
      }
    },
    "tags": {
      "type": "array",
      "description": "Arbitrary key words attached to this feedback artifact.",
      "minItems": 0,
      "maxItems": 32,
      "uniqueItems": true,
      "items": {
        "type": "string",
        "minLength": 1,
        "maxLength": 64,
        "pattern": "^[a-zA-Z0-9_\\-]+$"
      }
    },
    "metadata": {
      "type": "object",
      "description": "Arbitrary keyâ€“value metadata for integration with external systems (non-validated).",
      "additionalProperties": {
        "type": ["string", "number", "boolean", "null"]
      }
    }
  },
  "definitions": {}
}