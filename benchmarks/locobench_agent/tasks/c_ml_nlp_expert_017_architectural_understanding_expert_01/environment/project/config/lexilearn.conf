# ======================================================================
#  LexiLearn MVC Orchestrator – Primary Runtime Configuration
#  File:    lexilearn_orchestrator/config/lexilearn.conf
#  Purpose: Centralized configuration for the LexiLearn Orchestrator.
#           Parsed at bootstrap by src/core/ll_config.c and cached into
#           a singleton (see ll_get_config()) for fast read-only access.
#
#  NOTE:
#    • All keys are case-insensitive.
#    • Environment variables may override any key by prefixing with
#      “LEXILEARN_” (e.g., export LEXILEARN_DB__HOST="db.prod.local").
#    • Paths may include ${HOME}, ${PWD}, or ${ENV_VAR} tokens which are
#      expanded at runtime.
# ======================================================================

########################################################################
#  GLOBAL RUNTIME
########################################################################
[orchestrator]
# One of: "dev", "staging", "prod"
env                 =   prod

# RFC-3339 timestamp format used across the platform
timestamp_fmt       =   %Y-%m-%dT%H:%M:%SZ

# Number of worker threads for the pipeline controller
worker_threads      =   8

# PID file for process supervision (systemd, supervisord, etc.)
pid_file            =   /var/run/lexilearn/orchestrator.pid

# Absolute path to write structured JSON logs (rotated daily)
log_file            =   /var/log/lexilearn/orchestrator.log
log_level           =   INFO          # DEBUG | INFO | WARN | ERROR | FATAL

########################################################################
#  DATA LAYER
########################################################################
[data_paths]
# Raw multimodal payloads (written by ingestion adapters)
incoming_root       =   /mnt/lexilearn/data/incoming

# Post-validated assets (voice, essays, LMS snapshots, etc.)
validated_root      =   /mnt/lexilearn/data/validated

# Feature store (Parquet + Delta Lake)
feature_store_root  =   /mnt/lexilearn/feature_store

# Maximum allowed file-size (in MiB) for a single ingestion payload
max_payload_size_mb =   512

########################################################################
#  BACKEND SERVICES
########################################################################
[db]
host                =   db.prod.lexilearn.internal
port                =   5432
database            =   lexilearn
user                =   orchestrator
# Secrets are injected via HashiCorp Vault at runtime; placeholders only
password            =   ${LL_DB_PASSWORD}

[redis]
host                =   cache.prod.lexilearn.internal
port                =   6379
db_index            =   4
conn_pool_size      =   25

[kafka]
bootstrap_servers   =   kafka01.lexilearn.internal:9092,kafka02.lexilearn.internal:9092
ingest_topic        =   lexilearn.ingest
events_topic        =   lexilearn.events
group_id            =   lexilearn_orchestrator

########################################################################
#  MACHINE LEARNING / MLOps
########################################################################
[ml_pipeline]
# Registered default strategy (see src/ml/strategies/)
default_strategy    =   transformer_summarizer_v3

# File-system root for model artifacts (versioned via MLflow backend)
model_registry_root =   /mnt/lexilearn/models

# Enable automatic hyper-parameter optimization with Optuna
hyperparameter_tuning = true

# Cron expression (UTC) for periodic retraining job
retraining_schedule   = 0 3 * * 1       # 03:00 every Monday

# Minimum KS-statistic threshold prompting retraining (model drift)
drift_threshold       = 0.12

# Allowable maximum training duration per experiment (in minutes)
max_training_minutes  = 180

########################################################################
#  SECURITY & COMPLIANCE
########################################################################
[security]
# AES-256-GCM key for on-disk encryption of sensitive artifacts
encryption_key     = ${LL_ENCRYPTION_KEY}

# GDPR data retention window (in days) for raw student data
retention_days     = 90

# Mask student PII fields before persisting to feature store
mask_pii           = true

########################################################################
#  OBSERVER PATTERN HOOKS
########################################################################
[observers]
# Fully-qualified trie of Observer modules that will be dlopen()'d
# in the Controller’s event bus. Comma-separated list.
modules = \
  libobsv_drift_monitor.so,\
  libobsv_experiment_logger.so,\
  libobsv_perf_profiler.so

########################################################################
#  TELEMETRY & MONITORING
########################################################################
[monitoring]
enable_prometheus  = true
prometheus_port    = 9502
enable_opentelemetry = true
otlp_endpoint      = otel.prod.lexilearn.internal:4317
healthcheck_port   = 8055

########################################################################
#  FEATURE FLAGS
########################################################################
[features]
enable_heatmaps          = true
enable_explainability    = true
enable_voice_transcripts = false        # Disabled until VAD refactor

########################################################################
#  SANITY CHECK
########################################################################
# Bump this schema_version when adding/removing keys to force version
# checks in src/core/ll_config.c during CI.
schema_version = 2.4.1
