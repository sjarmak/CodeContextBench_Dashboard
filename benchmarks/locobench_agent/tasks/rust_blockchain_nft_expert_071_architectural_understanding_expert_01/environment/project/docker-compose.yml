```yaml
# ------------------------------------------------------------------------
# CanvasChain Symphony â€“ docker-compose.yml
#
# Orchestrates all Rust micro-services, the event-bus, the consensus node,
# persistence layer and observability stack.
#
# Every service follows the same conventions:
#   * gRPC is exposed on port 50051 (container-internal)
#   * REST/Prometheus metrics on port 8080 (container-internal)
#   * HEALTHCHECK uses the /health REST endpoint
#   * Logs go to stdout and are collected by the container runtime
#
# Usage:
#   docker compose up -d          # start all services
#   docker compose logs -f        # follow logs
#   docker compose down -v        # tear everything down
#
# ------------------------------------------------------------------------
version: "3.9"

x-env-common: &env-common
  RUST_LOG: "info,hyper=warn,tower=warn"
  EVENT_BUS_URL: "nats://event-bus:4222"
  DATABASE_URL: "postgres://canvas:canvas@db:5432/canvas"
  CONSENSUS_NODE_URL: "http://consensus-node:9944"
  OTEL_EXPORTER_OTLP_ENDPOINT: "http://tempo:4317"

x-healthcheck: &default-healthcheck
  interval: 10s
  timeout: 3s
  retries: 5
  start_period: 15s

networks:
  canvaschain:
    driver: bridge

volumes:
  postgres_data:
  tempo_data:

services:
  # ---------------- Core Messaging & Persistence -----------------
  event-bus:
    image: nats:2.10-alpine
    container_name: canvas_event_bus
    networks:
      - canvaschain
    healthcheck:
      test: ["CMD", "nats", "ping", "-s", "localhost"]
      <<: *default-healthcheck
    restart: unless-stopped

  db:
    image: postgres:15-alpine
    container_name: canvas_postgres
    networks:
      - canvaschain
    environment:
      POSTGRES_USER: canvas
      POSTGRES_PASSWORD: canvas
      POSTGRES_DB: canvas
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U $$POSTGRES_USER"]
      <<: *default-healthcheck
    restart: unless-stopped

  # ------------- Consensus (Substrate-based) ----------------------
  consensus-node:
    build:
      context: ./consensus-node
      dockerfile: Dockerfile
    container_name: canvas_consensus_node
    ports:
      - "9944:9944"   # RPC
      - "30333:30333" # P2P
    networks:
      - canvaschain
    environment:
      <<: *env-common
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9944/health"]
      <<: *default-healthcheck
    restart: unless-stopped

  # ---------------- Observability Stack --------------------------
  prometheus:
    image: prom/prometheus:v2.45.0
    container_name: canvas_prometheus
    networks:
      - canvaschain
    volumes:
      - ./ops/prometheus.yml:/etc/prometheus/prometheus.yml:ro
    restart: unless-stopped

  grafana:
    image: grafana/grafana:10.2.0
    container_name: canvas_grafana
    networks:
      - canvaschain
    ports:
      - "3000:3000"
    environment:
      GF_SECURITY_ADMIN_USER: admin
      GF_SECURITY_ADMIN_PASSWORD: admin
    restart: unless-stopped
    depends_on:
      - prometheus

  tempo:
    image: grafana/tempo:2.3.1
    container_name: canvas_tempo
    networks:
      - canvaschain
    volumes:
      - tempo_data:/var/tempo
    command: ["-config.file=/etc/tempo.yaml"]
    restart: unless-stopped

  # ---------------- Micro-services -------------------------------
  composition-svc:
    build: { context: ./services/composition, dockerfile: Dockerfile }
    container_name: canvas_composition
    networks: [ canvaschain ]
    environment:
      <<: *env-common
    depends_on:
      db: { condition: service_healthy }
      event-bus: { condition: service_healthy }
      consensus-node: { condition: service_healthy }
    ports:
      - "6001:8080"
      - "7001:50051"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      <<: *default-healthcheck
    restart: unless-stopped

  minting-svc:
    build: { context: ./services/minting, dockerfile: Dockerfile }
    container_name: canvas_minting
    networks: [ canvaschain ]
    environment:
      <<: *env-common
    depends_on:
      composition-svc: { condition: service_healthy }
      event-bus: { condition: service_healthy }
    ports:
      - "6002:8080"
      - "7002:50051"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      <<: *default-healthcheck
    restart: unless-stopped

  remixing-svc:
    build: { context: ./services/remixing, dockerfile: Dockerfile }
    container_name: canvas_remixing
    networks: [ canvaschain ]
    environment:
      <<: *env-common
    depends_on:
      minting-svc: { condition: service_healthy }
      event-bus: { condition: service_healthy }
    ports:
      - "6003:8080"
      - "7003:50051"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      <<: *default-healthcheck
    restart: unless-stopped

  marketplace-svc:
    build: { context: ./services/marketplace, dockerfile: Dockerfile }
    container_name: canvas_marketplace
    networks: [ canvaschain ]
    environment:
      <<: *env-common
    depends_on:
      db: { condition: service_healthy }
      event-bus: { condition: service_healthy }
    ports:
      - "6004:8080"
      - "7004:50051"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      <<: *default-healthcheck
    restart: unless-stopped

  royalty-svc:
    build: { context: ./services/royalty, dockerfile: Dockerfile }
    container_name: canvas_royalty
    networks: [ canvaschain ]
    environment:
      <<: *env-common
    depends_on:
      marketplace-svc: { condition: service_healthy }
      event-bus: { condition: service_healthy }
    ports:
      - "6005:8080"
      - "7005:50051"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      <<: *default-healthcheck
    restart: unless-stopped

  governance-svc:
    build: { context: ./services/governance, dockerfile: Dockerfile }
    container_name: canvas_governance
    networks: [ canvaschain ]
    environment:
      <<: *env-common
    depends_on:
      db: { condition: service_healthy }
      event-bus: { condition: service_healthy }
    ports:
      - "6006:8080"
      - "7006:50051"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      <<: *default-healthcheck
    restart: unless-stopped

  wallet-svc:
    build: { context: ./services/wallet, dockerfile: Dockerfile }
    container_name: canvas_wallet
    networks: [ canvaschain ]
    environment:
      <<: *env-common
    depends_on:
      db: { condition: service_healthy }
      event-bus: { condition: service_healthy }
    ports:
      - "6007:8080"
      - "7007:50051"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      <<: *default-healthcheck
    restart: unless-stopped

  staking-svc:
    build: { context: ./services/staking, dockerfile: Dockerfile }
    container_name: canvas_staking
    networks: [ canvaschain ]
    environment:
      <<: *env-common
    depends_on:
      wallet-svc: { condition: service_healthy }
      event-bus: { condition: service_healthy }
    ports:
      - "6008:8080"
      - "7008:50051"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      <<: *default-healthcheck
    restart: unless-stopped

  token-management-svc:
    build: { context: ./services/token-management, dockerfile: Dockerfile }
    container_name: canvas_token_management
    networks: [ canvaschain ]
    environment:
      <<: *env-common
    depends_on:
      wallet-svc: { condition: service_healthy }
      event-bus: { condition: service_healthy }
    ports:
      - "6009:8080"
      - "7009:50051"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      <<: *default-healthcheck
    restart: unless-stopped

  oracle-svc:
    build: { context: ./services/oracle, dockerfile: Dockerfile }
    container_name: canvas_oracle
    networks: [ canvaschain ]
    environment:
      <<: *env-common
      EXTERNAL_FEED_URL: "https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=usd"
    depends_on:
      event-bus: { condition: service_healthy }
    ports:
      - "6010:8080"
      - "7010:50051"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      <<: *default-healthcheck
    restart: unless-stopped

# ------------------------------------------------------------------------
# End of file
# ------------------------------------------------------------------------
```