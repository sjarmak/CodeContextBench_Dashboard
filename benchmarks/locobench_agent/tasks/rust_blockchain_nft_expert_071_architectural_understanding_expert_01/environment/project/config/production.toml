# --------------------------------------------------------------------------
# CanvasChain Symphony – Production Configuration
# File: config/production.toml
#
# This file governs the behaviour of every CanvasChain Symphony node running
# on MAINNET.  It is loaded at startup via the `config` crate and can be
# overridden by environment variables (e.g. `DATABASE__URL`) or command-line
# flags (`--config.foo.bar=baz`).
#
# All monetary values are expressed in the smallest denomination (µCCS for the
# native CCS token) unless otherwise noted.
# --------------------------------------------------------------------------

[global]
environment                = "production"
chain_id                   = "canvaschain-mainnet"
network_id                 = 901
node_name                  = "${HOSTNAME}"
data_dir                   = "/var/lib/canvaschain"
log_level                  = "info"
metrics                    = true                   # Enable Prometheus exporter
panic_hook                = "capture-and-exit"      # Options: abort, capture-and-exit
max_parallel_compilations = 4                       # Caps WASM contract compilation

# --------------------------------------------------------------------------
# gRPC Gateway (shared by all micro-services)
# --------------------------------------------------------------------------
[grpc]
host                       = "0.0.0.0"
port                       = 8043
timeout_ms                 = 5_000
max_concurrent_streams     = 256
tls_cert_path              = "certs/grpc.pem"       # Relative to `data_dir`
tls_key_path               = "certs/grpc-key.pem"

# --------------------------------------------------------------------------
# Relational storage (indexer, metadata, governance state, off-chain data)
# --------------------------------------------------------------------------
[database]
url                        = "${DATABASE_URL}"      # e.g. postgres://prod:***@pg01.canvaschain.art/ccs
pool_size                  = 64
connection_timeout_secs    = 10
migrations_on_start        = true
read_replicas              = [
  "${READ_REPLICA_1_URL}",
  "${READ_REPLICA_2_URL}",
]

# --------------------------------------------------------------------------
# Event Bus (asynchronous micro-service backbone)
# --------------------------------------------------------------------------
[event_bus]
nats_url                   = "nats://nats.event-bus.prod:4222"
connect_timeout_ms         = 2_000
payload_compression        = "zstd"
max_payload_bytes          = 1_048_576              # 1 MiB
cluster_discovery          = true
tls_enabled                = true

# --------------------------------------------------------------------------
# Proof-of-Inspiration Consensus Parameters
# --------------------------------------------------------------------------
[consensus]
engine                     = "ProofOfInspiration"
epoch_duration_secs        = 900                    # 15 minutes
min_stake                  = "1_000_000000"         # 1 000 CCS (in µCCS)
vrf_curve                  = "ed25519"              # Default curve for VRF
finality_threshold         = 12                     # ⩾ finality steps before block is final

# --------------------------------------------------------------------------
# Cryptography & Key Management
# --------------------------------------------------------------------------
[crypto]
default_signature_curve    = "ed25519"
supported_curves           = ["ed25519", "bls12_381", "falcon_512"]
hash_function              = "blake3"
enable_hardware_acceleration = true
kms_endpoint               = "https://kms.canvaschain.art"
key_cache_ttl_secs         = 300

# --------------------------------------------------------------------------
# NFT Runtime Limits & Defaults
# --------------------------------------------------------------------------
[nft]
max_layers_per_token       = 256
max_traits_per_layer       = 32
default_royalty_bps        = 750                    # 7.5 %
allow_off_chain_layers     = false
evolution_tick_secs        = 60
metadata_version           = 2

# --------------------------------------------------------------------------
# Fee Market / Gas Scheduler
# --------------------------------------------------------------------------
[gas]
block_max_gas              = 20_000_000
tx_base_gas                = 21_000
tx_gas_price_min           = "0.1"                  # gwei
tx_gas_price_max           = "1_000"                # gwei
gas_refund_ratio_bps       = 20

# --------------------------------------------------------------------------
# DeFi Module
# --------------------------------------------------------------------------
[defi]
lending_pool_address       = "0xdef1a7e00000000000000000000000000000000"
reward_token_address       = "0xcca5feed000000000000000000000000000000"
apy_update_interval_secs   = 300
collateralisation_ratio_bps = 15000                 # 150 %

# --------------------------------------------------------------------------
# Security / API Gateway
# --------------------------------------------------------------------------
[security]
tls_cert_path              = "certs/node.pem"
tls_key_path               = "certs/node-key.pem"
jwt_secret                 = "${JWT_SECRET}"
allowed_origins            = ["https://canvaschain.art", "https://api.canvaschain.art"]
rate_limit_per_min         = 6_000
ip_whitelist               = ["198.51.100.0/24", "203.0.113.0/24"]

# --------------------------------------------------------------------------
# Structured Logging
# --------------------------------------------------------------------------
[logging]
format                     = "json"                 # {json, compact, pretty}
filter                     = "canvaschain=info,hyper=warn,sqlx=warn"
file_rotation              = "daily"
log_dir                    = "/var/log/canvaschain"
compress_rotated           = true
retention_days             = 14

# --------------------------------------------------------------------------
# Telemetry & Observability
# --------------------------------------------------------------------------
[telemetry]
collector_endpoint         = "https://otel.canvaschain.art/v1/traces"
sample_rate                = 0.10                  # 10 % of traces
prometheus_exporter_port   = 9464

# --------------------------------------------------------------------------
# Maintenance Jobs
# --------------------------------------------------------------------------
[maintenance]
auto_prune                 = true
prune_depth_blocks         = 200_000
db_vacuum_frequency_hours  = 24
snapshot_interval_blocks   = 10_000

# --------------------------------------------------------------------------
# Upgrade / Versioning Policy
# --------------------------------------------------------------------------
[upgrade]
allow_unsafe_hardforks     = false
semver_check               = true
required_version           = ">=1.4.0, <2.0.0"

# --------------------------------------------------------------------------
# Runtime Extensions (Dynamic Loading via the Strategy Pattern)
# --------------------------------------------------------------------------
[extensions]
enabled = [
  "canvas_vr",                 # VR-specific rendering primitives
  "canvas_physical_computing", # OSC / MIDI / DMX bridging
  "canvas_ai_assist",          # Generative ML on-chain co-creation
]

# --------------------------------------------------------------------------
# Micro-services — each runs in its own process / container
# --------------------------------------------------------------------------
[services]

  [services.composition]
  enabled                 = true
  grpc_port               = 50_051
  healthcheck             = "/health"
  max_concurrent_jobs     = 32
  job_queue_size          = 1_024
  job_timeout_secs        = 120

  [services.minting]
  enabled                 = true
  grpc_port               = 50_052
  fee_ratio_bps           = 250           # 2.5 %
  signer_key_path         = "keys/minting.ed25519"
  allow_batch_mints       = true
  batch_max_size          = 100

  [services.remixing]
  enabled                 = true
  grpc_port               = 50_053
  max_remix_depth         = 5
  cache_size_mb           = 512

  [services.marketplace]
  enabled                 = true
  grpc_port               = 50_054
  api_key                 = "${MARKETPLACE_API_KEY}"
  listing_fee_bps         = 150
  settlement_time_secs    = 60

  [services.royalty_streaming]
  enabled                 = true
  grpc_port               = 50_055
  payout_interval_secs    = 86_400        # Daily
  buffer_threshold_ccs    = "50_000000"   # 50 CCS

  [services.wallet_integration]
  enabled                 = true
  grpc_port               = 50_056
  hardware_wallet_support = true
  websocket_broadcast     = true

  [services.governance]
  enabled                 = true
  grpc_port               = 50_057
  voting_period_secs      = 259_200       # 3 days
  quorum_percent          = 10
  supermajority_percent   = 66
  proposal_deposit        = "500_000000"  # 500 CCS

  [services.token_management]
  enabled                 = true
  grpc_port               = 50_058
  burn_enabled            = true
  max_supply              = "1_000_000_000_000000" # 1 B CCS
  reissue_window_secs     = 86_400

  [services.defi_protocols]
  enabled                 = true
  grpc_port               = 50_059
  strategies              = ["lending", "yield_farming", "auto_compound"]
  controller_address      = "0xdeaDbeec000000000000000000000000000000"

  [services.smart_contracts]
  enabled                 = true
  grpc_port               = 50_060
  vm_cache_size_mb        = 256
  max_contract_size_kb    = 512
  enable_precompiles      = ["ripemd160", "blake2b", "secp256k1_recover"]

# --------------------------------------------------------------------------
# End of file
# --------------------------------------------------------------------------