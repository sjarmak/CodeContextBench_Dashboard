```yaml
asyncapi: '2.6.0'

info:
  title: CanvasChain Symphony – Global Event Contract
  version: 1.0.0
  description: |
    This **AsyncAPI** document defines the canonical event-bus contract for all
    CanvasChain Symphony micro-services.  
    Services written in Rust (or any language) MUST adhere to these topics,
    message shapes and semantics when publishing or subscribing over the
    NATS-powered mesh.  
    All events follow the [CloudEvents 1.0](https://cloudevents.io/) envelope
    for cross-platform interoperability, and every payload is signed using the
    micro-service’s Strategy-pattern pluggable cryptography module  
    (Ed25519 by default, BLS & post-quantum curves optional).

  license:
    name: Apache-2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html
  contact:
    name: Core Protocol Team
    url: https://github.com/canvaschain
    email: protocol@canvaschain.io

defaultContentType: application/json

servers:
  natsDev:
    url: nats://event-bus.dev.canvaschain.local:4222
    protocol: nats
    description: Development cluster
    security:
      - tls: []
    variables:
      namespace:
        default: dev
        description: Logical tenant namespace

  natsProd:
    url: nats://event-bus.prod.canvaschain.io:4222
    protocol: nats
    description: Production cluster
    security:
      - tls: []

tags:
  - name: nft
    description: Events related to NFT lifecycle & creative evolution
  - name: governance
    description: DAO voting & parameter-change events
  - name: defi
    description: Yield, staking & lending events
  - name: ops
    description: Internal ops, monitoring & error streams

channels:

  # ──────────────────────  NFT DOMAIN  ──────────────────────

  nft.composed.v1:
    description: Emitted when a new generative composition is proposed on-chain.
    subscribe:
      operationId: onNftComposed
      summary: Receive notifications for new compositions
      message:
        $ref: '#/components/messages/NftComposed'
    publish:
      operationId: ackNftComposed
      summary: Acknowledge successful processing (optional)
      message:
        $ref: '#/components/messages/Ack'

  nft.minted.v1:
    description: Fired by the `minting-svc` after a composition has been minted
      into its first NFT layer.
    subscribe:
      operationId: onNftMinted
      message:
        $ref: '#/components/messages/NftMinted'
    publish:
      operationId: ackNftMinted
      message:
        $ref: '#/components/messages/Ack'

  nft.remixed.v1:
    description: Indicates an existing NFT has been remixed (layer mutation).
    subscribe:
      operationId: onNftRemixed
      message:
        $ref: '#/components/messages/NftRemixed'

  nft.sold.v1:
    description: Marketplace transaction resulting in ownership transfer.
    subscribe:
      operationId: onNftSold
      message:
        $ref: '#/components/messages/NftSold'

  # ──────────────────────  GOVERNANCE DOMAIN  ──────────────────────

  governance.vote.cast.v1:
    description: DAO vote cast or updated by a token holder.
    subscribe:
      operationId: onVoteCast
      message:
        $ref: '#/components/messages/GovVoteCast'

  governance.proposal.executed.v1:
    subscribe:
      operationId: onProposalExecuted
      message:
        $ref: '#/components/messages/GovProposalExecuted'

  # ──────────────────────  DEFI DOMAIN  ──────────────────────

  defi.stake.rewarded.v1:
    subscribe:
      operationId: onStakeRewarded
      message:
        $ref: '#/components/messages/DefiStakeRewarded'

  defi.position.opened.v1:
    subscribe:
      operationId: onDefiPositionOpened
      message:
        $ref: '#/components/messages/DefiPositionOpened'

  # ──────────────────────  OPS / ERROR DOMAIN  ──────────────────────

  ops.error.v1:
    description: Centralised error stream for observability & alerting.
    publish:
      operationId: publishError
      message:
        $ref: '#/components/messages/Error'

components:

  # ──────────────────────  MESSAGE TRAITS  ──────────────────────
  messageTraits:

    CloudEventV1:
      headers:
        type: object
        required:
          - ce_specversion
          - ce_id
          - ce_source
          - ce_type
          - ce_time
        properties:
          ce_specversion:
            type: string
            enum: ["1.0"]
          ce_id:
            type: string
            description: Unique event identifier (ULID preferred).
          ce_source:
            type: string
            description: Micro-service emitting the event.
          ce_type:
            type: string
            description: Formal event name.
          ce_time:
            type: string
            format: date-time
            description: RFC 3339 timestamp.
          ce_subject:
            type: string
            description: Context-dependent subject URI.
          ce_dataschema:
            type: string
            format: uri
            description: Payload schema URI.
          ce_datacontenttype:
            type: string
            default: application/json
          signature:
            type: string
            description: Detached JWS signature of the **payload** (hex).

    ErrorTrait:
      tags:
        - name: ops
      summary: |
        All error messages share this trait: CloudEvent envelope + error body.
      headers:
        $ref: '#/components/messageTraits/CloudEventV1/headers'

  # ──────────────────────  MESSAGES  ──────────────────────
  messages:

    # --- NFT LIFECYCLE --------------------------------------------------------

    NftComposed:
      name: NftComposed
      title: "New NFT Composition"
      tags:
        - name: nft
      summary: |
        A generative-art composition proposed by a *composer node* has been
        persisted to the blockchain state.
      traits:
        - $ref: '#/components/messageTraits/CloudEventV1'
      payload:
        $ref: '#/components/schemas/NftComposed'

    NftMinted:
      name: NftMinted
      tags:
        - name: nft
      summary: First immutable layer of an NFT minted.
      traits:
        - $ref: '#/components/messageTraits/CloudEventV1'
      payload:
        $ref: '#/components/schemas/NftMinted'

    NftRemixed:
      name: NftRemixed
      tags:
        - name: nft
      summary: NFT's creative state mutated via remix operation.
      traits:
        - $ref: '#/components/messageTraits/CloudEventV1'
      payload:
        $ref: '#/components/schemas/NftRemixed'

    NftSold:
      name: NftSold
      tags:
        - name: nft
      summary: Ownership transferred after a marketplace sale.
      traits:
        - $ref: '#/components/messageTraits/CloudEventV1'
      payload:
        $ref: '#/components/schemas/NftSold'

    # --- GOVERNANCE -----------------------------------------------------------

    GovVoteCast:
      name: GovVoteCast
      tags:
        - name: governance
      traits:
        - $ref: '#/components/messageTraits/CloudEventV1'
      payload:
        $ref: '#/components/schemas/GovVoteCast'

    GovProposalExecuted:
      name: GovProposalExecuted
      tags:
        - name: governance
      traits:
        - $ref: '#/components/messageTraits/CloudEventV1'
      payload:
        $ref: '#/components/schemas/GovProposalExecuted'

    # --- DEFI -----------------------------------------------------------------

    DefiStakeRewarded:
      name: DefiStakeRewarded
      tags:
        - name: defi
      traits:
        - $ref: '#/components/messageTraits/CloudEventV1'
      payload:
        $ref: '#/components/schemas/DefiStakeRewarded'

    DefiPositionOpened:
      name: DefiPositionOpened
      tags:
        - name: defi
      traits:
        - $ref: '#/components/messageTraits/CloudEventV1'
      payload:
        $ref: '#/components/schemas/DefiPositionOpened'

    # --- ACK & ERROR ----------------------------------------------------------

    Ack:
      name: Ack
      summary: Standard ACK sent by consumers when manual acknowledgement is enabled.
      traits:
        - $ref: '#/components/messageTraits/CloudEventV1'
      payload:
        $ref: '#/components/schemas/Ack'

    Error:
      name: Error
      summary: Fatal or recoverable error propagated by a service.
      traits:
        - $ref: '#/components/messageTraits/ErrorTrait'
      payload:
        $ref: '#/components/schemas/Error'

  # ──────────────────────  SCHEMAS  ──────────────────────
  schemas:

    # --- Common ----------------------------------------------------------------
    Ack:
      type: object
      required: [status, correlation_id]
      properties:
        status:
          type: string
          enum: [accepted, rejected, failed]
        correlation_id:
          type: string
        detail:
          type: string
          description: Optional failure detail.

    Error:
      type: object
      required: [code, message]
      properties:
        code:
          type: string
          description: Application-specific error code (e.g. ERR_WALLET_SIG).
        message:
          type: string
        service:
          type: string
          description: Service emitting the error.
        retryable:
          type: boolean
          default: false
        data:
          type: object
          additionalProperties: true

    WalletAddress:
      type: string
      pattern: '^0x[a-fA-F0-9]{40}$'
      description: EIP-55 checksum address of an account.

    TokenId:
      type: string
      pattern: '^[0-9a-f]{64}$'
      description: 256-bit token identifier (hex).

    # --- NFT -------------------------------------------------------------------

    NftComposed:
      type: object
      required: [composition_id, composer, seed, vrf_proof]
      properties:
        composition_id:
          $ref: '#/components/schemas/TokenId'
        composer:
          $ref: '#/components/schemas/WalletAddress'
        seed:
          type: string
          description: Deterministic seed for the generative algorithm (hex).
        vrf_proof:
          type: string
          description: Verifiable proof attesting random seed generation.
        metadata_uri:
          type: string
          format: uri
        block_height:
          type: integer
        created_at:
          type: string
          format: date-time

    NftMinted:
      type: object
      required: [token_id, owner, layer_hash]
      properties:
        token_id:
          $ref: '#/components/schemas/TokenId'
        owner:
          $ref: '#/components/schemas/WalletAddress'
        layer_hash:
          type: string
          description: Keccak-256 hash of the initial immutable layer.
        royalty_bps:
          type: integer
          minimum: 0
          maximum: 10000
          description: Basis-points royalty rate.
        tx_hash:
          type: string
        minted_at:
          type: string
          format: date-time

    NftRemixed:
      type: object
      required: [token_id, editor, diff_uri]
      properties:
        token_id:
          $ref: '#/components/schemas/TokenId'
        editor:
          $ref: '#/components/schemas/WalletAddress'
        diff_uri:
          type: string
          format: uri
          description: Uri of the JSON patch describing state mutation.
        new_layer_hash:
          type: string
        remixed_at:
          type: string
          format: date-time

    NftSold:
      type: object
      required: [token_id, price_wei, seller, buyer]
      properties:
        token_id:
          $ref: '#/components/schemas/TokenId'
        price_wei:
          type: string
          pattern: '^[0-9]+$'
        seller:
          $ref: '#/components/schemas/WalletAddress'
        buyer:
          $ref: '#/components/schemas/WalletAddress'
        marketplace_tx:
          type: string
        executed_at:
          type: string
          format: date-time

    # --- GOVERNANCE ------------------------------------------------------------

    GovVoteCast:
      type: object
      required: [proposal_id, voter, weight_bps, option]
      properties:
        proposal_id:
          type: string
        voter:
          $ref: '#/components/schemas/WalletAddress'
        weight_bps:
          type: integer
          minimum: 0
          maximum: 10000
        option:
          type: string
          enum: [yes, no, abstain]
        cast_at:
          type: string
          format: date-time

    GovProposalExecuted:
      type: object
      required: [proposal_id, executor, outcome]
      properties:
        proposal_id:
          type: string
        executor:
          $ref: '#/components/schemas/WalletAddress'
        outcome:
          type: string
          enum: [accepted, rejected, expired]
        tx_hash:
          type: string
        executed_at:
          type: string
          format: date-time

    # --- DEFI ------------------------------------------------------------------

    DefiStakeRewarded:
      type: object
      required: [staker, amount_wei, epoch]
      properties:
        staker:
          $ref: '#/components/schemas/WalletAddress'
        amount_wei:
          type: string
          pattern: '^[0-9]+$'
        epoch:
          type: integer
        tx_hash:
          type: string
        rewarded_at:
          type: string
          format: date-time

    DefiPositionOpened:
      type: object
      required: [position_id, owner, collateral_wei, leverage_x]
      properties:
        position_id:
          type: string
        owner:
          $ref: '#/components/schemas/WalletAddress'
        collateral_wei:
          type: string
          pattern: '^[0-9]+$'
        leverage_x:
          type: number
          minimum: 1
        market_pair:
          type: string
        opened_at:
          type: string
          format: date-time

  # ──────────────────────  SECURITY SCHEMES  ──────────────────────
  securitySchemes:
    tls:
      type: X509
      description: |
        TLS client certificate authentication enforced by the NATS server.
```