```yaml
# ------------------------------------------------------------------------
#  FortiLedger360 :: Staging Environment Configuration
#  File: configs/environments/staging.yaml
#
#  NOTE:
#    • Values ending with *_from_env are read at runtime from environment
#      variables—never commit production secrets into version-control.
#    • Any change to this file will trigger a rolling update in the
#      corresponding Kubernetes “staging” namespace through GitOps.
# ------------------------------------------------------------------------

environment: staging
version: "1.3.0"

metadata:
  last_updated: "2024-05-05T17:00:00Z"
  updated_by: "ci-bot@fortiledger360"
  description: |
    Staging configuration mimics production topology with lower quotas.
    All security controls are enforced; telemetry points to staging stacks.

# ------------------------------------------------------------------------
#  Core Platform Components
# ------------------------------------------------------------------------
platform:
  event_bus:
    provider: nats
    url: nats://nats.staging.fortiledger360.local:4222
    tls:
      enabled: true
      ca_cert_path: /etc/ssl/certs/fortiledger360/ca.pem
      client_cert_path: /etc/ssl/certs/fortiledger360/nats-client.pem
      client_key_path: /etc/ssl/private/fortiledger360/nats-client.key
    connection_pool: 10
    retry_policy: &default_retry
      attempts: 3
      backoff_strategy: exponential
      base_delay_ms: 500
      max_delay_ms: 5000

  service_mesh:
    provider: istio
    control_plane_host: istiod.staging.fortiledger360.svc.cluster.local
    mtls_mode: STRICT
    tracing:
      enabled: true
      sampling_rate: 0.25   # 25 % trace sampling in staging
    circuit_breakers:
      default:
        max_connections: 1000
        http1_max_pending_requests: 200
        http1_max_requests: 500
        sleep_window_seconds: 10

  secrets_management:
    provider: vault
    addr: https://vault.staging.fortiledger360.local:8200
    token_from_env: VAULT_TOKEN
    transit_key: fortiledger360-transit

# ------------------------------------------------------------------------
#  Data Stores
# ------------------------------------------------------------------------
datastores:
  postgres_ledgers:
    host: pg.staging.fortiledger360.local
    port: 5432
    dbname: ledgerdb
    user: fortiledger
    password_from_env: FLEDGER_PG_PASSWORD
    ssl_mode: require
    pool:
      size: 20
      max_idle: 5
      conn_max_lifetime_minutes: 30
    timeouts:
      connect_seconds: 5
      query_seconds: 30

  redis_cache:
    host: redis.staging.fortiledger360.local
    port: 6379
    db: 0
    tls_enabled: true
    password_from_env: FLEDGER_REDIS_PASSWORD
    pool_size: 50
    default_ttl_seconds: 600

  object_storage:
    provider: minio
    endpoint: s3.staging.fortiledger360.local:9000
    bucket: backups-staging
    secure: true
    access_key_from_env: MINIO_ACCESS_KEY_ID
    secret_key_from_env: MINIO_SECRET_ACCESS_KEY
    region: us-east-1
    multipart_chunk_mb: 32

# ------------------------------------------------------------------------
#  Observability
# ------------------------------------------------------------------------
observability:
  logging:
    level: INFO          # DEBUG, INFO, WARN, ERROR
    format: json
    aggregate:
      provider: loki
      url: http://loki.staging.fortiledger360.local:3100
  metrics:
    provider: prometheus
    push_gateway: http://prom-pushgateway.staging.fortiledger360.local:9091
  tracing:
    provider: jaeger
    endpoint: http://jaeger.staging.fortiledger360.local:14268/api/traces

# ------------------------------------------------------------------------
#  Feature Flags / Modules
# ------------------------------------------------------------------------
features:
  load_balancing:        true
  security_scanning:     true
  performance_metrics:   true
  backup_recovery:       true
  configuration_management: true

feature_flags:
  enable_deep_scan: true
  enable_drift_detection: true
  enable_real_time_alerts: true
  disable_expensive_analytics: false

# ------------------------------------------------------------------------
#  Domain Service Configuration
# ------------------------------------------------------------------------
services:
  scanner:
    max_concurrent_scans: 5
    vulnerability_db_update_cron: "0 */6 * * *"   # Every 6 hours
    retry_policy: *default_retry

  backup_node:
    full_backup_cron: "0 2 * * 0"       # Sundays @02:00
    incremental_backup_cron: "0 */6 * * *"
    retention_days: 14
    snapshot_concurrency: 3
    encryption:
      enabled: true
      kms_key: arn:aws:kms:us-east-1:123456789:key/backup-staging-key

  config_manager:
    drift_detection:
      sweep_interval_minutes: 15
      ruleset: "CIS_Benchmark_v1.3"
    retry_policy: *default_retry

  alert_broker:
    channels:
      slack:
        webhook_url_from_env: SLACK_WEBHOOK_URL
        channel: "#fortiledger360-staging-alerts"
      email:
        smtp_host: smtp.staging.fortiledger360.local
        smtp_port: 587
        username_from_env: SMTP_USERNAME
        password_from_env: SMTP_PASSWORD
        from_address: "FortiLedger360 Monitor <no-reply@fortiledger360.local>"
    escalation_policy:
      - name: P1
        notify_after_minutes: 0
        repeat: 3
      - name: P2
        notify_after_minutes: 15
        repeat: 2

# ------------------------------------------------------------------------
#  API / Edge
# ------------------------------------------------------------------------
api_gateway:
  host: api.staging.fortiledger360.local
  port: 443
  tls:
    certificate_path: /etc/ssl/certs/fortiledger360/api.pem
    key_path: /etc/ssl/private/fortiledger360/api.key
  rate_limiting:
    enabled: true
    default:
      requests_per_minute: 1200
      burst_requests: 200
  cors:
    allowed_origins:
      - "https://console.staging.fortiledger360.local"
    allow_credentials: true
    allowed_headers:
      - Content-Type
      - Authorization

auth:
  oidc:
    issuer: https://auth.staging.fortiledger360.local
    client_id: fortiledger360
    client_secret_from_env: OIDC_CLIENT_SECRET
    audiences:
      - fortiledger360-api
      - fortiledger360-console
    scopes:
      - openid
      - profile
      - email
  session:
    cookie_name: FL360_SESSIONID
    cookie_secure: true
    cookie_max_age_hours: 8

# ------------------------------------------------------------------------
#  Operational Policies
# ------------------------------------------------------------------------
autoscaling:
  enabled: true
  min_replicas: 3
  max_replicas: 20
  target_cpu_utilization_percent: 75

retry_policies:
  default: *default_retry
  event_bus_publish:
    attempts: 5
    backoff_strategy: linear
    base_delay_ms: 1000
    max_delay_ms: 1000

timeouts:
  grpc:
    dial_seconds: 5
    request_seconds: 30
  http:
    connect_seconds: 3
    read_seconds: 15
  database:
    connect_seconds: 5
    idle_timeout_seconds: 60

compliance:
  gdpr:
    enabled: true
    data_retention_days: 30
  hipaa:
    enabled: false

# ------------------------------------------------------------------------
#  End-of-File
# ------------------------------------------------------------------------
```