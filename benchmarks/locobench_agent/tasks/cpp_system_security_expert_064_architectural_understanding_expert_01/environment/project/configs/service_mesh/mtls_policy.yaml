```yaml
#################################################################################################
# FortiLedger360 Enterprise Security Suite
# Service-Mesh / Mutual-TLS Policy Bundle
#
# This multi-document YAML file hardens all east-west traffic inside the service-mesh by
# enforcing STRICT mutual-TLS (mTLS) while carving out clearly documented exceptions for
# legacy ingress traffic and metrics-scraping.  The file can be applied with:
#
#     kubectl apply -f mtls_policy.yaml
#
# NOTE:
#   1. Requires Istio 1.14+ (or any distribution that supports security.istio.io/v1beta1).
#   2. Resource names and namespaces are prefixed with “fortiledger-” to avoid collisions
#      with potential customer workloads that may share the cluster.
#################################################################################################

#################################################################################################
# 1. Global mesh-wide mTLS policy — STRICT by default
#################################################################################################
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: fortiledger-mesh-mtls
  namespace: istio-system
  labels:
    app.kubernetes.io/managed-by: "FortiLedger360"
    security.fortiledger.io/scope: "global"
  annotations:
    fortiledger.io/owner: platform-security
    fortiledger.io/description: >
      Enforces STRICT mutual-TLS across *all* namespaces unless a tighter
      (or looser) PeerAuthentication is defined closer to the workload.
spec:
  mtls:
    mode: STRICT   # All intra-mesh traffic must be encrypted & authenticated.

---

#################################################################################################
# 2. Ingress gateway override — PERMISSIVE
#    The public ingress gateway must accept plaintext HTTPS (TLS termination at gateway),
#    so we relax mTLS *only* for that workload.
#################################################################################################
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: ingress-gateway-permissive
  namespace: fortiledger-ingress
  labels:
    app.kubernetes.io/part-of: "FortiLedger360"
    app.kubernetes.io/component: "ingress-gateway"
  annotations:
    fortiledger.io/owner: platform-networking
spec:
  selector:
    matchLabels:
      app: fortiledger-ingress-gateway
  mtls:
    mode: PERMISSIVE   # Accept both mTLS and plain TLS from external clients.

---

#################################################################################################
# 3. Prometheus scrape exception — DISABLE only on port 9090
#    Prometheus’s built-in scrape endpoint is plain-HTTP; disabling mTLS on that port
#    avoids the need for sidecar injection inside the monitoring namespace.
#################################################################################################
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: prometheus-port-policy
  namespace: fortiledger-monitoring
  labels:
    app.kubernetes.io/name: "prometheus"
    security.fortiledger.io/scope: "port-level"
  annotations:
    fortiledger.io/owner: observability-team
spec:
  selector:
    matchLabels:
      app: prometheus
  mtls:
    mode: STRICT          # Default is still STRICT for every other port.
  portLevelMtls:
    "9090":               # Disable only for the metrics-scrape endpoint.
      mode: DISABLE

---

#################################################################################################
# 4. Client-side policy — DestinationRule enabling ISTIO_MUTUAL for all FortiLedger services
#################################################################################################
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: fortiledger-internal-mtls
  namespace: fortiledger-system
  labels:
    app.kubernetes.io/managed-by: "FortiLedger360"
  annotations:
    fortiledger.io/owner: platform-security
spec:
  host: "*.fortiledger-system.svc.cluster.local"
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL       # Sidecars use istiod-signed certs automatically.

---

#################################################################################################
# 5. AuthorizationPolicy — Allow only specific SPIFFE IDs to call the Scanner service
#################################################################################################
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: scanner-spiffe-authz
  namespace: fortiledger-scanner
  labels:
    app.kubernetes.io/component: "scanner"
    security.fortiledger.io/policy: "spiffe-strict"
  annotations:
    fortiledger.io/owner: threat-detection-team
spec:
  selector:
    matchLabels:
      app: scanner
  action: ALLOW
  rules:
    # Only these service accounts (identified via SPIFFE) may invoke gRPC on the Scanner
    - from:
        - source:
            requestPrincipals:
              - "spiffe://cluster.local/ns/fortiledger-scanner/sa/scanner-sa"
              - "spiffe://cluster.local/ns/fortiledger-orchestrator/sa/orchestrator-sa"
      to:
        - operation:
            methods: ["POST", "GET"]
            ports: ["50051"]
      when:
        - key: request.auth.claims[exp]   # Ensure the JWT hasn’t expired.
          notValues: ["0"]

---

#################################################################################################
# 6. Namespace-wide “default-deny” policy — Everything else is blocked
#################################################################################################
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: fortiledger-default-deny
  namespace: fortiledger-system
  labels:
    security.fortiledger.io/policy: "default-deny"
  annotations:
    fortiledger.io/owner: platform-security
spec: {}   # An empty spec with no ALLOW rules results in an implicit DENY ALL.

#################################################################################################
# END OF FILE
#################################################################################################
```