openapi: 3.0.3
info:
  title: FortiLedger360 Enterprise Security Suite – Public API
  description: |
    FortiLedger360 is an enterprise-grade, layered system-security platform tailored
    for medium-to-large B2B service providers who monetize their secure infrastructure
    as a product.  
    This specification documents **Version 1** of the public REST/HTTP surface
    exposed by the platform’s **Presentation & API** layer.  
    All endpoints are secured via OAuth 2.0 Bearer tokens (JWT) and are designed to be
    consumed by tenant-facing portals, automation scripts, or third-party service catalogs.

    Architectural Highlights
    – Event-Driven & Service-Mesh foundation  
    – Strategy, Command, and Chain-of-Responsibility patterns  
    – Strict multi-tenant isolation with per-tenant RBAC

    Contact support@fortiledger360.example
  version: "1.0.0"
servers:
  - url: https://api.fortiledger360.example/v1
    description: Production
  - url: https://sandbox.fortiledger360.example/v1
    description: Sandbox
tags:
  - name: Tenants
    description: Tenant on-boarding, off-boarding, and life-cycle operations
  - name: Scans
    description: Real-time & scheduled vulnerability scans
  - name: Backups
    description: Automated backup & disaster-recovery controls
  - name: LoadBalancers
    description: L7/L4 load-balancing tiers provisioning
  - name: Metrics
    description: SLA-bound observability & performance insights
  - name: Alerts
    description: Compliance and health alert subscriptions
  - name: Internal
    description: Internal-only utilities (require `X-FL360-Internal-Key`)
security:
  - bearerAuth: []
paths:
  /tenants:
    get:
      tags: [Tenants]
      summary: List tenants
      operationId: listTenants
      parameters:
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/PageToken'
      responses:
        "200":
          description: Paged list of tenants
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantList'
        default:
          $ref: '#/components/responses/Error'
    post:
      tags: [Tenants]
      summary: Create a new tenant
      operationId: createTenant
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TenantCreate'
      responses:
        "201":
          description: Tenant successfully created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tenant'
        default:
          $ref: '#/components/responses/Error'

  /tenants/{tenantId}:
    parameters:
      - $ref: '#/components/parameters/TenantId'
    get:
      tags: [Tenants]
      summary: Retrieve tenant details
      operationId: getTenant
      responses:
        "200":
          description: A single tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tenant'
        default:
          $ref: '#/components/responses/Error'
    patch:
      tags: [Tenants]
      summary: Update tenant properties
      operationId: updateTenant
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TenantUpdate'
      responses:
        "200":
          description: Tenant updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tenant'
        default:
          $ref: '#/components/responses/Error'
    delete:
      tags: [Tenants]
      summary: Delete tenant
      operationId: deleteTenant
      responses:
        "204":
          description: Tenant removed
        default:
          $ref: '#/components/responses/Error'

  /tenants/{tenantId}/scans:
    parameters:
      - $ref: '#/components/parameters/TenantId'
    post:
      tags: [Scans]
      summary: Initiate vulnerability scan
      operationId: initiateScan
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScanRequest'
      responses:
        "202":
          description: Scan accepted for processing
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScanStatus'
        default:
          $ref: '#/components/responses/Error'
    get:
      tags: [Scans]
      summary: List scans for tenant
      operationId: listScans
      parameters:
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/PageToken'
      responses:
        "200":
          description: Paged list of scans
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScanList'
        default:
          $ref: '#/components/responses/Error'

  /tenants/{tenantId}/scans/{scanId}:
    parameters:
      - $ref: '#/components/parameters/TenantId'
      - $ref: '#/components/parameters/ScanId'
    get:
      tags: [Scans]
      summary: Get scan status
      operationId: getScanStatus
      responses:
        "200":
          description: Scan status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScanStatus'
        default:
          $ref: '#/components/responses/Error'

  /tenants/{tenantId}/backups:
    parameters:
      - $ref: '#/components/parameters/TenantId'
    post:
      tags: [Backups]
      summary: Trigger on-demand backup
      operationId: triggerBackup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BackupRequest'
      responses:
        "202":
          description: Backup accepted for processing
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackupStatus'
        default:
          $ref: '#/components/responses/Error'
    get:
      tags: [Backups]
      summary: List backups for tenant
      operationId: listBackups
      parameters:
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/PageToken'
      responses:
        "200":
          description: Paged list of backups
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackupList'
        default:
          $ref: '#/components/responses/Error'

  /tenants/{tenantId}/backups/{backupId}:
    parameters:
      - $ref: '#/components/parameters/TenantId'
      - $ref: '#/components/parameters/BackupId'
    get:
      tags: [Backups]
      summary: Get backup status
      operationId: getBackupStatus
      responses:
        "200":
          description: Backup status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackupStatus'
        default:
          $ref: '#/components/responses/Error'

  /tenants/{tenantId}/load-balancers:
    parameters:
      - $ref: '#/components/parameters/TenantId'
    post:
      tags: [LoadBalancers]
      summary: Provision load balancer
      operationId: createLoadBalancer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoadBalancerCreate'
      responses:
        "202":
          description: Load balancer creation accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoadBalancer'
        default:
          $ref: '#/components/responses/Error'
    get:
      tags: [LoadBalancers]
      summary: List load balancers for tenant
      operationId: listLoadBalancers
      responses:
        "200":
          description: List of load balancers
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoadBalancerList'
        default:
          $ref: '#/components/responses/Error'

  /tenants/{tenantId}/load-balancers/{lbId}:
    parameters:
      - $ref: '#/components/parameters/TenantId'
      - $ref: '#/components/parameters/LbId'
    get:
      tags: [LoadBalancers]
      summary: Get load balancer
      operationId: getLoadBalancer
      responses:
        "200":
          description: Load balancer details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoadBalancer'
        default:
          $ref: '#/components/responses/Error'
    delete:
      tags: [LoadBalancers]
      summary: Delete load balancer
      operationId: deleteLoadBalancer
      responses:
        "204":
          description: Load balancer deleted
        default:
          $ref: '#/components/responses/Error'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    internalApiKey:
      type: apiKey
      in: header
      name: X-FL360-Internal-Key

  parameters:
    PageSize:
      name: pageSize
      in: query
      description: Number of items per page
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
    PageToken:
      name: pageToken
      in: query
      description: Token returned by previous call to fetch the next page
      schema:
        type: string
    TenantId:
      name: tenantId
      in: path
      required: true
      description: Unique tenant identifier
      schema:
        type: string
        pattern: '^[a-z0-9]{8,}$'
    ScanId:
      name: scanId
      in: path
      required: true
      description: Scan identifier
      schema:
        type: string
    BackupId:
      name: backupId
      in: path
      required: true
      description: Backup job identifier
      schema:
        type: string
    LbId:
      name: lbId
      in: path
      required: true
      description: Load balancer identifier
      schema:
        type: string

  responses:
    Error:
      description: Error payload
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

  schemas:
    Error:
      type: object
      required: [code, message]
      properties:
        code:
          type: string
          example: SCAN_NOT_FOUND
        message:
          type: string
          example: Scan with ID 42 not found for tenant ACME
        correlationId:
          type: string
          description: Correlates logs across micro-services
          example: 5e6d3f7b-a011-4edf-b5c3-2fd55e8ede2f
      additionalProperties: false

    Tenant:
      type: object
      required: [id, name, createdAt, plan]
      properties:
        id:
          type: string
          example: 9c1d73fa
        name:
          type: string
          example: ACME Corp.
        plan:
          type: string
          enum: [standard, premium, enterprise]
        status:
          type: string
          enum: [active, suspended, deleting]
          default: active
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      additionalProperties: false

    TenantList:
      type: object
      required: [items]
      properties:
        nextPageToken:
          type: string
          nullable: true
        items:
          type: array
          items:
            $ref: '#/components/schemas/Tenant'

    TenantCreate:
      type: object
      required: [name, plan]
      properties:
        name:
          type: string
        plan:
          type: string
          enum: [standard, premium, enterprise]
      additionalProperties: false

    TenantUpdate:
      type: object
      properties:
        name:
          type: string
        plan:
          type: string
          enum: [standard, premium, enterprise]
        status:
          type: string
          enum: [active, suspended]
      additionalProperties: false

    ScanRequest:
      type: object
      required: [profile, depth]
      properties:
        profile:
          type: string
          enum: [quick, standard, deep]
          example: deep
        depth:
          type: integer
          minimum: 1
          maximum: 10
          example: 5
        scheduleCron:
          type: string
          description: Optional CRON expression for recurring scans
          example: "0 0 * * *"
      additionalProperties: false

    ScanStatus:
      type: object
      required: [scanId, status]
      properties:
        scanId:
          type: string
          example: e1f6b7c2
        status:
          type: string
          enum: [queued, running, completed, failed, canceled]
        progress:
          type: integer
          minimum: 0
          maximum: 100
          example: 85
        startedAt:
          type: string
          format: date-time
        finishedAt:
          type: string
          format: date-time
        findings:
          type: integer
          minimum: 0
      additionalProperties: false

    ScanList:
      allOf:
        - $ref: '#/components/schemas/TenantList'   # reusing pagination structure
        - type: object
          properties:
            items:
              type: array
              items:
                $ref: '#/components/schemas/ScanStatus'

    BackupRequest:
      type: object
      required: [type]
      properties:
        type:
          type: string
          enum: [snapshot, full, incremental]
          example: snapshot
        retentionDays:
          type: integer
          minimum: 1
          example: 30
      additionalProperties: false

    BackupStatus:
      type: object
      required: [backupId, status]
      properties:
        backupId:
          type: string
          example: 5aa13d3b
        status:
          type: string
          enum: [queued, running, completed, failed, canceled]
        progress:
          type: integer
          minimum: 0
          maximum: 100
        sizeBytes:
          type: integer
          format: int64
        startedAt:
          type: string
          format: date-time
        finishedAt:
          type: string
          format: date-time
      additionalProperties: false

    BackupList:
      allOf:
        - $ref: '#/components/schemas/TenantList'
        - type: object
          properties:
            items:
              type: array
              items:
                $ref: '#/components/schemas/BackupStatus'

    LoadBalancerCreate:
      type: object
      required: [name, tier]
      properties:
        name:
          type: string
          example: public-api-lb
        tier:
          type: string
          enum: [edge, regional, global]
        algorithm:
          type: string
          enum: [round_robin, least_connections, ip_hash]
          default: round_robin
        sslTermination:
          type: boolean
          default: true
      additionalProperties: false

    LoadBalancer:
      type: object
      required: [lbId, name, tier, status, createdAt]
      properties:
        lbId:
          type: string
          example: a3f5d0c1
        name:
          type: string
        tier:
          type: string
          enum: [edge, regional, global]
        algorithm:
          type: string
          enum: [round_robin, least_connections, ip_hash]
        status:
          type: string
          enum: [provisioning, active, failed, deleting]
        endpoints:
          type: array
          items:
            type: string
            format: hostname
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      additionalProperties: false

    LoadBalancerList:
      type: object
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/LoadBalancer'
        nextPageToken:
          type: string
          nullable: true