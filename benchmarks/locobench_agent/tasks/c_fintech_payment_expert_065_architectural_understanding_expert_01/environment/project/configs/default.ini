;=============================================================================
; EduPay Ledger Academy - Default Configuration
;-----------------------------------------------------------------------------
; File Path : configs/default.ini
; Project   : EduPay Ledger Academy (fintech_payment)
; Format    : INI
;-----------------------------------------------------------------------------
; NOTE:
; 1. This file is parsed at application start-up before any command–line flags.
; 2. Environment variables with the same keys will override these defaults.
;    Example (bash):
;       export EDUPAY_DB__PASSWORD="Sup3rS3cre7"
; 3. Use uppercase letters and double underscores (“__”) for nested overrides
;    to stay POSIX-friendly (see examples in each section).
;=============================================================================

;-----------------------------------------------------------------------------
; [runtime] – General process settings
;-----------------------------------------------------------------------------
[runtime]
; Service identifier shown in logs and tracing dashboards.
service_name          = edupay-ledger-academy

; Application environment: development | staging | production
env                   = development

; Graceful shutdown timeout (in seconds).
shutdown_timeout      = 25

; Maximum number of OS threads the Go scheduler can run (0 = auto). 
; (Kept here for parity with multi-lang labs; ignored by the C runtime)
gomaxprocs            = 0

;-----------------------------------------------------------------------------
; [server] – API & gRPC listener configuration
;-----------------------------------------------------------------------------
[server.http]
; Bind address where the REST/GraphQL gateway will listen.
bind_addr             = 0.0.0.0:8080

; Read/Write/Idle timeouts (in seconds).
read_timeout          = 15
write_timeout         = 20
idle_timeout          = 60

[server.grpc]
; Bind address for internal gRPC transport (Saga orchestrator, CQRS bus).
bind_addr             = 0.0.0.0:9090
max_recv_msg_size     = 4194304        ; 4  MB
max_send_msg_size     = 16777216       ; 16 MB

;-----------------------------------------------------------------------------
; [database] – Primary payment-ledger store
;-----------------------------------------------------------------------------
[database]
; Supported drivers: postgres | mysql | sqlite | sqlserver
driver                = postgres

; DSN is ignored if host, port, user, and dbname are set.
dsn                   = ""

; Individual components—recommended for production so that sensitive data
; can be overridden via environment variables (EDUPAY_DB__PASSWORD, etc.).
host                  = localhost
port                  = 5432
user                  = edupay_app
password              = edupay_dev_pw
dbname                = edupay_ledger
sslmode               = require        ; disable | require | verify-full

; Connection pool tuning
max_open_conns        = 48
max_idle_conns        = 12
conn_max_idle_time    = 5m
conn_max_lifetime     = 60m

;-----------------------------------------------------------------------------
; [message_broker] – Event bus for CQRS & Saga Pattern
;-----------------------------------------------------------------------------
[message_broker]
; Broker type: nats | kafka | rabbitmq
driver                = nats
url                   = nats://localhost:4222

; Reconnect strategy
max_reconnects        = 20
reconnect_wait        = 2s

; TLS
enable_tls            = false
ca_file               = ""
cert_file             = ""
key_file              = ""

;-----------------------------------------------------------------------------
; [event_sourcing]
;-----------------------------------------------------------------------------
[event_sourcing]
; Storage backend for immutable event log: postgres | mysql | dynamodb
backend               = postgres

; Snapshot frequency—commit a snapshot every N events to speed up replays.
snapshot_interval     = 250

; Hard delete policy: true purges events permanently; false performs soft
; delete w/ tombstone (required for audit compliance).
hard_delete           = false

;-----------------------------------------------------------------------------
; [audit_trail]
;-----------------------------------------------------------------------------
[audit_trail]
; Write path for immutable CSV/JSON feeds used in coursework labs.
export_path           = /var/edupay/audit/

; Rotate files when they exceed X MB.
rotate_size_mb        = 100

; GZip archives older than N days.
archive_after_days    = 14

;-----------------------------------------------------------------------------
; [payments] – Core payment engine settings
;-----------------------------------------------------------------------------
[payments]
; Default ISO 4217 currency code.
default_currency      = USD

; Comma-separated list of ISO 4217 codes the platform will accept.
supported_currencies  = USD,EUR,GBP,JPY,CAD,AUD

; Settlement batch flush interval (cron-style or duration).
settlement_flush_cron = */15 * * * *   ; Every 15 minutes

; Maximum number of concurrent settlement workers.
max_settlement_workers= 8

;-----------------------------------------------------------------------------
; [multi_currency] – FX and treasury options
;-----------------------------------------------------------------------------
[multi_currency]
; FX rate provider driver: openexchangerates | fixer | noop
fx_provider           = openexchangerates
; API key pulled from env var in prod.
fx_api_key            = DEMO_KEY_CHANGE_ME

; Rate refresh interval
fx_refresh_interval   = 30m

; Spread percentage applied to retail FX conversions (bps).
fx_spread_bps         = 25

;-----------------------------------------------------------------------------
; [fraud_detection]
;-----------------------------------------------------------------------------
[fraud_detection]
; Enable or disable real-time heuristics (for coursework demos).
enabled               = true

; Threshold score above which transactions are auto-flagged (0-100).
risk_score_threshold  = 65

; ML model file path (ONNX or TensorFlow SavedModel).
model_path            = /opt/edupay/models/fraud_detector.onnx

; Fee charged per manual review (basis points).
manual_review_fee_bps = 15

;-----------------------------------------------------------------------------
; [regulatory_compliance]
;-----------------------------------------------------------------------------
[regulatory_compliance]
; FERPA KYC checking: strict | lenient | disabled
ferpa_mode            = strict

; PCI-DSS log redaction: full | partial | none
pci_redaction_level   = partial

; PSD2 SCA enforcement level: required | optional | off
psd2_sca              = required

;-----------------------------------------------------------------------------
; [saga] – Distributed Transaction Orchestration
;-----------------------------------------------------------------------------
[saga]
; Enable demonstration mode that injects random failures for teaching labs.
demo_mode             = false

; Probability (%) of injecting a fault into each saga step when demo_mode=true.
fault_injection_rate  = 15

; Idempotency key TTL (how long to remember completed saga steps).
idempotency_ttl       = 24h

;-----------------------------------------------------------------------------
; [logging]
;-----------------------------------------------------------------------------
[logging]
; log_level: trace | debug | info | warn | error | fatal
log_level             = info

; log_format: console | json
log_format            = json

; File logger (optional; empty path = stdout only).
file_path             = /var/log/edupay/app.log
max_size_mb           = 50
max_backups           = 5
max_age_days          = 30
compress              = true

;-----------------------------------------------------------------------------
; [metrics] – Prometheus & OpenTelemetry
;-----------------------------------------------------------------------------
[metrics]
; Enable Prometheus metrics endpoint.
prometheus_enabled    = true
prometheus_bind_addr  = 0.0.0.0:9102

; OTLP collector endpoint for distributed tracing.
otel_collector_url    = http://localhost:4317

; Sampling ratio: 1.0 = 100% (dev); 0.01 = 1% (prod)
otel_sampling_ratio   = 1.0

;-----------------------------------------------------------------------------
; [security] – TLS and JWT
;-----------------------------------------------------------------------------
[security.tls]
; Auto-generate self-signed certificates if none are provided (dev only).
autogenerate_certs    = true

cert_file             = /etc/ssl/certs/edupay.crt
key_file              = /etc/ssl/private/edupay.key
client_ca_file        = /etc/ssl/certs/edupay_ca.crt
min_tls_version       = 1.2

[security.jwt]
; HMAC or RSA keys for access tokens.
issuer                = EduPayLedgerAcademy
audience              = https://ledger.edupay.dev
secret                = CHANGEME_SUPER_SECRET
access_token_ttl      = 15m
refresh_token_ttl     = 14d

;-----------------------------------------------------------------------------
; [feature_flags] – Toggle experimental features
;-----------------------------------------------------------------------------
[feature_flags]
enable_graphql_api    = true
enable_webhooks       = true
enable_quic_transport = false
enable_real_time_fx   = true

;-----------------------------------------------------------------------------
; [testing] – Values used by unit & integration test harnesses
;-----------------------------------------------------------------------------
[testing]
; Seed for pseudo-random deterministic tests.
seed                  = 123456

; Mock payment gateway URL
mock_gateway_url      = http://localhost:18080

; Toggle slow e2e tests.
run_slow_tests        = false

;-----------------------------------------------------------------------------
; End of file
;=============================================================================
