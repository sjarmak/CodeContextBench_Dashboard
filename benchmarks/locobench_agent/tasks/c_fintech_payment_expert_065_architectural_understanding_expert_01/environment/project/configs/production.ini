;------------------------------------------------------------------------------
; EduPay Ledger Academy - Production Configuration
; File: configs/production.ini
;
; NOTE:
;   1) Secrets ending with *_env should be provided via environment variables
;      or mounted secret files and MUST NOT be committed to source control.
;   2) All paths are absolute and assume the container/host filesystem
;      follows the FHS standard.
;   3) This file is consumed at boot-time by the Configuration subsystem
;      implemented in `/internal/config/reader.c`.
;------------------------------------------------------------------------------


[Application]
name                         = EduPay Ledger Academy
environment                   = production
version                       = 1.4.3
domain                        = ledger.edupay.edu
timezone                      = UTC
default_currency              = USD
enable_feature_flags          = true


[Server]
http_port                     = 8443
grpc_port                     = 50051
max_connections               = 4096
read_timeout_seconds          = 15
write_timeout_seconds         = 15
idle_timeout_seconds          = 60


[Database.Primary]
driver                        = postgres
host                          = db-prod.edupay.internal
port                          = 5432
name                          = edupay_core
user                          = ledger_app
password_env                  = DB_LEDGER_APP_PASS
max_open_conns                = 150
max_idle_conns                = 25
conn_max_lifetime_minutes     = 30
sslmode                       = require
migration_dir                 = /opt/edupay/migrations/core


[Database.AuditTrail]
driver                        = postgres
host                          = db-audit.edupay.internal
port                          = 5432
name                          = edupay_audit
user                          = ledger_audit
password_env                  = DB_LEDGER_AUDIT_PASS
max_open_conns                = 75
max_idle_conns                = 15
conn_max_lifetime_minutes     = 120
sslmode                       = require
retention_days                = 3650            ; 10-year immutable trail


[MessageBroker]
provider                      = rabbitmq
host                          = mq-prod.edupay.internal
port                          = 5672
vhost                         = /
user                          = edupay_mq_user
password_env                  = MQ_EDUPAY_PASS
prefetch_count                = 150
tls_enabled                   = true
tls_ca_cert                   = /etc/edupay/certs/mq/ca.pem
tls_client_cert               = /etc/edupay/certs/mq/client.pem
tls_client_key                = /etc/edupay/certs/mq/client.key
retry_policy_initial_ms       = 1000
retry_policy_max_ms           = 30000
retry_policy_multiplier       = 2.0


[EventStore]
provider                      = kafka
brokers                       = kafka-1.edupay.internal:9093,kafka-2.edupay.internal:9093,kafka-3.edupay.internal:9093
topic_prefix                  = edupay.events.prod
schema_registry_url           = https://schema-registry.edupay.internal
sasl_username                 = edupay_kafka
sasl_password_env             = KAFKA_EDUPAY_PASS
tls_enabled                   = true
tls_ca_cert                   = /etc/edupay/certs/kafka/ca.pem
compression                   = lz4
acks                          = all
linger_ms                     = 5
batch_size_kb                 = 128


[CQRS]
rebuild_projection_on_start   = false
projection_refresh_interval_seconds = 2


[Saga]
enable_demo_mode              = false          ; Must be false in PROD
compensation_timeout_seconds  = 120


[FraudDetection]
enable_real_time_scoring      = true
min_transaction_amount_usd    = 0.01
max_transaction_amount_usd    = 100000.00
heuristics_model_path         = /opt/edupay/models/fraud/v5.2
async_scoring_timeout_ms      = 450
rule_engine_cache_ttl_seconds = 600


[MultiCurrency]
supported_currencies          = USD,EUR,GBP,AUD,JPY,CAD,BRL,INR,CNY,CHF
default_fx_provider           = fixer_io
fx_app_id_env                 = FX_FIXER_IO_APP_ID
fx_cache_ttl_minutes          = 30


[Compliance]
enable_pci_dss                = true
enable_psd2                   = true
enable_ferpa                  = true
tokenize_pii                  = true
pii_token_salt_env            = PII_SALT
ferpa_redaction_level         = strict


[Security]
keystore_path                 = /etc/edupay/keystores/application.p12
keystore_password_env         = KEYSTORE_PASS
jwt_public_key_path           = /etc/edupay/keys/jwt_public.pem
jwt_issuer                    = https://auth.edupay.edu
jwt_audience                  = edupay_ledger
require_mfa                   = true
allow_legacy_api_keys         = false
rate_limit_per_minute         = 600


[TLS]
pem_cert_file                 = /etc/edupay/certs/app/server.pem
pem_key_file                  = /etc/edupay/certs/app/server.key
minimum_tls_version           = 1.2
cipher_suites                 = TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384


[Logging]
level                         = INFO
format                        = json
output                        = /var/log/edupay/ledger.log
rotation_max_size_mb          = 250
rotation_max_backups          = 10
rotation_max_age_days         = 30


[Metrics]
provider                      = prometheus
port                          = 9090
pushgateway_url               = https://pushgateway.edupay.internal
collect_runtime_metrics       = true
collect_db_metrics            = true


[Tracing]
provider                      = jaeger
collector_endpoint            = https://jaeger-collector.edupay.internal/api/traces
sampling_rate                 = 0.25
service_name                  = edupay-ledger


[FeatureFlags]
fraud_detection_v6            = false
enable_beta_multi_tenant      = false
realtime_fx_conversion        = true
use_grpc_gateway              = true


[HealthCheck]
liveness_probe_path           = /health/live
readiness_probe_path          = /health/ready
period_seconds                = 10
failure_threshold             = 3


;------------------------------------------------------------------------------
; End of production.ini
;------------------------------------------------------------------------------