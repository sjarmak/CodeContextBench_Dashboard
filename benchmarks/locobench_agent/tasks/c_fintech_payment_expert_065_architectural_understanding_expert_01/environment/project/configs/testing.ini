;-------------------------------------------------------------------------------
; EduPay Ledger Academy
; Configuration File: configs/testing.ini
; Environment: Integration & Unit Testing
;
; This configuration file is loaded exclusively by the test-runner (CTest/CMocka)
; and the Docker compose profile `docker-compose.test.yml`.  Credentials and
; secrets herein are **non-production** and point at disposable containers or
; in-memory mocks so that students may experiment without risking live data or
; compliance violations.
;
; IMPORTANT:
;   • DO NOT promote any value from this file to production.
;   • Secrets are intentionally weak / short-lived for CI pipelines only.
;-------------------------------------------------------------------------------

[testing]
; Human-readable tag used by log headers and SQL prompts
environment                = TEST
; UTC timestamps keep reproducibility across time-zones
timezone                   = UTC
; Raise signal(SIGTRAP) on assertion failures to allow debugger attach
break_on_assert            = true
; Abort the entire test-suite on first fatal error
fail_fast                  = true
; Max seconds a single CTest can run before it is force-killed
test_timeout_seconds       = 45
; Path to JSON seed file used to hydrate the Event Store with sample transactions
bootstrap_seed_file        = ../tests/fixtures/seed_transactions.json

;-------------------------------------------------------------------------------
; DATABASE (PostgreSQL 14 ‑ ephemeral container orchestrated by docker-compose)
;-------------------------------------------------------------------------------
[database]
; Hostname provided by Docker network alias
host                       = edupay_db_test
port                       = 5432
username                   = edupay_ci
password                   = local_password
database                   = ledger_academy_test
; PostgreSQL search_path is pinned to the bounded context under test
schema                     = public, bursar_ctx, financial_aid_ctx
; Connection pool size tuned for parallel `ctest -j 8`
pool_size                  = 16
; Drop and recreate schema before every test run
reset_schema_on_startup    = true
; Enable `pg_stat_statements` for performance assertions
enable_query_stats         = true

;-------------------------------------------------------------------------------
; EVENT STORE (Apache Kafka ‑ replaced by in-memory stub during unit tests)
;-------------------------------------------------------------------------------
[event_store]
; `"memory://"` handler short-circuits network I/O while preserving API surface
bootstrap_servers          = memory://localhost
; Topic replication factors are ignored by the in-memory driver but required by
; CI integration tests that spin up a real broker
default_replication_factor = 1
; Simulate broker partition limits to exercise our back-pressure logic
max_message_bytes          = 1048576  ; 1 MB

;-------------------------------------------------------------------------------
; PAYMENT GATEWAY (Stripe emulator)
;-------------------------------------------------------------------------------
[payment_gateway]
; `stripe-mock` container listens on 12111 by default
endpoint_url               = http://stripe-mock:12111
api_key                    = sk_test_FAKE_123
; Force the emulator to inject a 503 Service Unavailable every Nth request.
; This toggles Network Chaos scenarios used in the Saga Pattern lab.
inject_fault_rate          = 0.10   ; 10 %

;-------------------------------------------------------------------------------
; FRAUD DETECTION SERVICE (gRPC stub)
;-------------------------------------------------------------------------------
[fraud_detection]
endpoint                   = grpc://fraud-detector-mock:50051
; Hard-coded threshold allows determinism in unit tests
suspicious_amount_limit    = 10000.00
; Toggle heuristic modules individually to test feature-flag behavior
enable_velocity_checks     = true
enable_geo_ip_checks       = false
enable_device_fingerprint  = true

;-------------------------------------------------------------------------------
; FEATURE FLAGS
;-------------------------------------------------------------------------------
[feature_flags]
; Activate Saga Pattern demonstration mode which purposely introduces orphaned
; transactions to validate compensating actions.
enable_saga_demo_mode      = true
; Write an immutable audit event for *every* read operation—costly but useful
; in compliance coursework.
verbose_audit_trail        = true
; Multi-currency support is on by default; flip to false to simplify KYC labs
enable_multi_currency      = true
; Toggle experimental WebAuthn login flow (client libraries not yet production-ready)
enable_webauthn_login      = false

;-------------------------------------------------------------------------------
; LOGGING
;-------------------------------------------------------------------------------
[logging]
; Logging verbosity: TRACE | DEBUG | INFO | WARN | ERROR | FATAL
level                      = DEBUG
; Directory is mounted from host machine for easy inspection by students
output_dir                 = ../build/test-logs
; Rotate log files when size exceeds 5 MiB
max_file_size              = 5242880
; Keep last N rotated logs
max_backup_files           = 8
; Print colored ANSI output to stdout when running interactively
ansi_color                 = true

;-------------------------------------------------------------------------------
; SECURITY / CRYPTOGRAPHY
;-------------------------------------------------------------------------------
[crypto]
; Symmetric key used to encrypt test fixtures—do *not* use in production
fixture_cipher_key_hex     = 00112233445566778899aabbccddeeff
; Disable hardware RNG requirement for deterministic unit tests
allow_weak_rng             = true
; PBKDF2 iterations are intentionally low to speed up tests
pbkdf2_iterations          = 1000

;-------------------------------------------------------------------------------
; MISCELLANEOUS
;-------------------------------------------------------------------------------
[misc]
; Path for temporary files created by the test harness
temp_dir                   = /tmp/edupay-test
; Locale settings ensure number formatting consistency
lc_numeric                 = en_US.UTF-8
lc_time                    = en_US.UTF-8