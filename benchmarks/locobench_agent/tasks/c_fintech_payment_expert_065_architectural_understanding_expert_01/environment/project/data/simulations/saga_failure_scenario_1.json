```c
/*
 * EduPay Ledger Academy
 * -------------------------------------------------------------
 * File:    saga_failure_scenario_1.c
 * Target:  Generates the JSON fixture
 *          data/simulations/saga_failure_scenario_1.json
 * Author:  EduPay Engineering Team
 *
 * Description:
 * -------------------------------------------------------------
 * Generates a realistic simulation file that drives the
 * “Saga Pattern Demonstration Mode”.  The scenario forces a
 * failure in the “PaymentService” after two successful saga
 * steps, requiring the orchestration layer to trigger
 * compensating transactions.
 *
 * Build:
 *      $ cc -Wall -Wextra -pedantic -std=c18 \
 *           -o saga_failure_scenario_1 saga_failure_scenario_1.c
 *
 * Usage:
 *      $ ./saga_failure_scenario_1 \
 *          ./data/simulations/saga_failure_scenario_1.json
 *
 * (If no argument is supplied, the program writes the file into
 *  the current working directory.)
 *
 * -------------------------------------------------------------
 */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <errno.h>

/* ------------------------------------------------------------------
 * CONSTANTS
 * ------------------------------------------------------------------*/
#define DEFAULT_FILENAME "saga_failure_scenario_1.json"
#define ISO8601_BUFSZ    32u
#define INDENT           "    "           /* 4-space indent for JSON */

/* ------------------------------------------------------------------
 * STATIC UTILITIES
 * ------------------------------------------------------------------*/

/*
 * iso8601_now()
 * -------------------------------------------------------------
 * Returns the current UTC time formatted as a valid ISO-8601
 * string (e.g., “2024-05-20T14:59:36Z”).
 *
 * The caller owns the returned heap allocation and must invoke
 * `free()` when finished.
 */
static char *iso8601_now(void)
{
    time_t     raw;
    struct tm  utc;
    char      *buf = calloc(ISO8601_BUFSZ, 1);

    if (!buf) {
        return NULL;
    }

    time(&raw);
#if defined(_WIN32)
    gmtime_s(&utc, &raw);
#else
    if (gmtime_r(&raw, &utc) == NULL) {
        free(buf);
        return NULL;
    }
#endif

    /* strftime guarantees NUL termination on success. */
    if (strftime(buf, ISO8601_BUFSZ, "%Y-%m-%dT%H:%M:%SZ", &utc) == 0) {
        free(buf);
        return NULL;
    }

    return buf;
}

/*
 * safe_fputs()
 * -------------------------------------------------------------
 * Wrapper around fputs() that aborts the program if an I/O
 * error occurs.  This keeps subsequent error handling readable
 * when streaming JSON to the target file.
 */
static void safe_fputs(const char *s, FILE *fp)
{
    if (fputs(s, fp) == EOF) {
        fprintf(stderr, "I/O error while writing JSON: %s\n",
                strerror(errno));
        fclose(fp);
        exit(EXIT_FAILURE);
    }
}

/* ------------------------------------------------------------------
 * MAIN
 * ------------------------------------------------------------------*/
int main(int argc, char *argv[])
{
    const char *out_path = (argc > 1) ? argv[1] : DEFAULT_FILENAME;
    FILE       *fp       = NULL;
    char       *created  = NULL;

    /* ------------------------------------------------------------------
     * Acquire resources
     * ------------------------------------------------------------------*/
    fp = fopen(out_path, "w");
    if (!fp) {
        fprintf(stderr, "Unable to open '%s' for writing: %s\n",
                out_path, strerror(errno));
        return EXIT_FAILURE;
    }

    created = iso8601_now();
    if (!created) {
        fprintf(stderr, "Failed to allocate ISO-8601 timestamp.\n");
        fclose(fp);
        return EXIT_FAILURE;
    }

    /* ------------------------------------------------------------------
     * Emit JSON content
     * ------------------------------------------------------------------*/
    safe_fputs("{\n", fp);

    /* Metadata */
    safe_fputs(INDENT "\"scenario_id\": \"saga-failure-001\",\n", fp);
    safe_fputs(INDENT "\"description\": "
               "\"Simulates a PaymentService outage during "
               "multi-step tuition payment saga.\",\n", fp);
    safe_fputs(INDENT "\"version\": 1,\n", fp);

    /* created_at */
    safe_fputs(INDENT "\"created_at\": \"", fp);
    safe_fputs(created, fp);
    safe_fputs("\",\n", fp);

    /* Steps array */
    safe_fputs(INDENT "\"steps\": [\n", fp);

    /* Step 1 ---------------------------------------------------------*/
    safe_fputs(INDENT INDENT "{\n", fp);
    safe_fputs(INDENT INDENT INDENT "\"service\": "
               "\"AdmissionsService\",\n", fp);
    safe_fputs(INDENT INDENT INDENT "\"action\": \"ReserveSeat\",\n", fp);
    safe_fputs(INDENT INDENT INDENT "\"expected_outcome\": \"SUCCESS\"\n",
               fp);
    safe_fputs(INDENT INDENT "},\n", fp);

    /* Step 2 ---------------------------------------------------------*/
    safe_fputs(INDENT INDENT "{\n", fp);
    safe_fputs(INDENT INDENT INDENT "\"service\": "
               "\"BursarService\",\n", fp);
    safe_fputs(INDENT INDENT INDENT "\"action\": "
               "\"AuthorizePaymentMethod\",\n", fp);
    safe_fputs(INDENT INDENT INDENT "\"expected_outcome\": \"SUCCESS\"\n",
               fp);
    safe_fputs(INDENT INDENT "},\n", fp);

    /* Step 3 (Injected Failure) -------------------------------------*/
    safe_fputs(INDENT INDENT "{\n", fp);
    safe_fputs(INDENT INDENT INDENT "\"service\": "
               "\"PaymentService\",\n", fp);
    safe_fputs(INDENT INDENT INDENT "\"action\": "
               "\"CaptureTuitionPayment\",\n", fp);
    safe_fputs(INDENT INDENT INDENT "\"expected_outcome\": \"FAILURE\",\n",
               fp);
    safe_fputs(INDENT INDENT INDENT "\"failure_injection\": {\n", fp);
    safe_fputs(INDENT INDENT INDENT INDENT "\"type\": "
               "\"NETWORK_PARTITION\",\n", fp);
    safe_fputs(INDENT INDENT INDENT INDENT "\"grace_period_ms\": 500\n",
               fp);
    safe_fputs(INDENT INDENT INDENT "}\n", fp);
    safe_fputs(INDENT INDENT "},\n", fp);

    /* Step 4 (Compensation 1) ---------------------------------------*/
    safe_fputs(INDENT INDENT "{\n", fp);
    safe_fputs(INDENT INDENT INDENT "\"service\": "
               "\"BursarService\",\n", fp);
    safe_fputs(INDENT INDENT INDENT "\"action\": "
               "\"ReverseAuthorization\",\n", fp);
    safe_fputs(INDENT INDENT INDENT "\"expected_outcome\": "
               "\"COMPENSATING\"\n", fp);
    safe_fputs(INDENT INDENT "},\n", fp);

    /* Step 5 (Compensation 2) ---------------------------------------*/
    safe_fputs(INDENT INDENT "{\n", fp);
    safe_fputs(INDENT INDENT INDENT "\"service\": "
               "\"AdmissionsService\",\n", fp);
    safe_fputs(INDENT INDENT INDENT "\"action\": \"ReleaseSeat\",\n", fp);
    safe_fputs(INDENT INDENT INDENT "\"expected_outcome\": "
               "\"COMPENSATING\"\n", fp);
    safe_fputs(INDENT INDENT "}\n", fp);

    /* Close steps array and root object */
    safe_fputs(INDENT "]\n", fp);
    safe_fputs("}\n", fp);

    /* ------------------------------------------------------------------
     * Cleanup
     * ------------------------------------------------------------------*/
    free(created);
    if (fclose(fp) != 0) {
        fprintf(stderr, "Warning: Failed to close file '%s': %s\n",
                out_path, strerror(errno));
        return EXIT_FAILURE;
    }

    printf("Generated simulation fixture: %s\n", out_path);
    return EXIT_SUCCESS;
}
```