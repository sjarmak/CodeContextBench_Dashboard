{
  "ground_truth": "The solution involves changes across several files, demonstrating a successful decoupling.\n\n-   **`ledgerquest/engine/physics/interface.py` (New File):**\n    ```python\n    from abc import ABC, abstractmethod\n    from typing import List\n    from ledgerquest.engine.ecs.entity import Entity\n\n    class AbstractPhysicsSimulator(ABC):\n        @abstractmethod\n        def add_body(self, entity: Entity):\n            ...\n\n        @abstractmethod\n        def remove_body(self, entity_id: int):\n            ...\n\n        @abstractmethod\n        def step(self, delta_time: float):\n            ...\n\n        @abstractmethod\n        def get_collisions(self) -> List[tuple[Entity, Entity]]:\n            ...\n    ```\n\n-   **`ledgerquest/engine/physics/simulator.py` (Modified):**\n    -   `from .interface import AbstractPhysicsSimulator` is added.\n    -   The class signature is changed to `class Simulator(AbstractPhysicsSimulator):`.\n    -   Methods like `step`, `add_body`, etc., now implement the abstract methods from the interface.\n\n-   **`ledgerquest/services/game_loop/physics_updater.py` (Modified):**\n    -   The import `from ledgerquest.engine.physics.simulator import Simulator` is **removed**.\n    -   A new import is added: `from ledgerquest.engine.physics.interface import AbstractPhysicsSimulator`.\n    -   The `__init__` method is changed to accept the simulator via dependency injection: `def __init__(self, ecs_registry, physics_simulator: AbstractPhysicsSimulator):`\n    -   All internal uses of `self.physics_simulator` now correctly call methods on the abstract type.\n\n-   **`tests/unit/engine/physics/test_simulator.py` (Modified):**\n    -   No functional changes to tests are expected. All tests should pass, verifying that the concrete implementation's logic is sound.\n\n-   **Service Initialization (e.g., `ledgerquest/services/__init__.py`) (Modified):**\n    -   The code that instantiates `PhysicsUpdater` is updated to first create a concrete `Simulator` and then pass it into the `PhysicsUpdater`'s constructor. This demonstrates the principle of dependency injection.",
  "context_files": [
    "LedgerQuestEngine/docs/architecture/data_model.md",
    "LedgerQuestEngine/ledgerquest/engine/core/resource_manager.py",
    "LedgerQuestEngine/ledgerquest/services/networking/connection_handler.py",
    "LedgerQuestEngine/ledgerquest/services/networking/message_handler.py",
    "LedgerQuestEngine/tests/unit/services/networking/test_connection_handler.py",
    "LedgerQuestEngine/ledgerquest/services/__init__.py",
    "LedgerQuestEngine/ledgerquest/services/game_loop/ai_updater.py",
    "LedgerQuestEngine/ledgerquest/shared/models.py",
    "LedgerQuestEngine/ledgerquest/services/game_loop/physics_updater.py",
    "LedgerQuestEngine/ledgerquest/services/auditing/__init__.py",
    "LedgerQuestEngine/ledgerquest/shared/utils.py",
    "LedgerQuestEngine/ledgerquest/services/game_loop/__init__.py",
    "LedgerQuestEngine/ledgerquest/shared/exceptions.py",
    "LedgerQuestEngine/ledgerquest/services/networking/__init__.py",
    "LedgerQuestEngine/ledgerquest/services/asset_management/__init__.py",
    "LedgerQuestEngine/ledgerquest/services/game_loop/state_broadcaster.py",
    "LedgerQuestEngine/ledgerquest/shared/__init__.py",
    "LedgerQuestEngine/ledgerquest/services/game_loop/input_processor.py",
    "LedgerQuestEngine/ledgerquest/services/asset_management/level_uploader.py",
    "LedgerQuestEngine/ledgerquest/services/auditing/log_writer.py",
    "LedgerQuestEngine/ledgerquest/services/game_loop/state_committer.py",
    "LedgerQuestEngine/ledgerquest/services/game_loop/script_executor.py",
    "LedgerQuestEngine/tests/unit/services/game_loop/test_input_processor.py",
    "LedgerQuestEngine/tests/unit/services/__init__.py",
    "LedgerQuestEngine/tests/unit/services/auditing/test_log_writer.py",
    "LedgerQuestEngine/tests/unit/engine/ecs/test_registry.py",
    "LedgerQuestEngine/ledgerquest/engine/ai/blackboard.py",
    "LedgerQuestEngine/ledgerquest/engine/ai/nodes.py",
    "LedgerQuestEngine/ledgerquest/engine/ai/__init__.py",
    "LedgerQuestEngine/ledgerquest/engine/ecs/system.py",
    "LedgerQuestEngine/ledgerquest/engine/ecs/component.py",
    "LedgerQuestEngine/ledgerquest/engine/ai/behavior_tree.py",
    "LedgerQuestEngine/ledgerquest/engine/ecs/entity.py",
    "LedgerQuestEngine/ledgerquest/engine/ecs/registry.py",
    "LedgerQuestEngine/ledgerquest/engine/core/command.py",
    "LedgerQuestEngine/tests/integration/test_multitenancy.py",
    "LedgerQuestEngine/tests/unit/engine/ai/test_behavior_tree.py",
    "LedgerQuestEngine/ledgerquest/engine/physics/components.py",
    "LedgerQuestEngine/ledgerquest/engine/scripting/api_provider.py",
    "LedgerQuestEngine/ledgerquest/engine/ecs/__init__.py",
    "LedgerQuestEngine/ledgerquest/engine/state/serializer.py",
    "LedgerQuestEngine/ledgerquest/engine/core/event_bus.py",
    "LedgerQuestEngine/ledgerquest/__init__.py",
    "LedgerQuestEngine/ledgerquest/engine/physics/collision.py",
    "LedgerQuestEngine/ledgerquest/engine/physics/simulator.py",
    "LedgerQuestEngine/tests/test_suite.py",
    "LedgerQuestEngine/infra/scripts/teardown.sh",
    "LedgerQuestEngine/ledgerquest/engine/physics/__init__.py",
    "LedgerQuestEngine/ledgerquest/engine/core/__init__.py",
    "LedgerQuestEngine/LICENSE",
    "LedgerQuestEngine/ledgerquest/engine/scripting/host.py",
    "LedgerQuestEngine/rendering/main.py",
    "LedgerQuestEngine/docs/architecture/adr/002-ecs-on-dynamodb.md",
    "LedgerQuestEngine/ledgerquest/engine/scripting/__init__.py",
    "LedgerQuestEngine/tests/fixtures/__init__.py",
    "LedgerQuestEngine/tests/unit/engine/physics/test_simulator.py",
    "LedgerQuestEngine/ledgerquest/engine/state/__init__.py",
    "LedgerQuestEngine/ledgerquest/engine/__init__.py",
    "LedgerQuestEngine/tests/__init__.py",
    "LedgerQuestEngine/ledgerquest/engine/state/game_state.py",
    "LedgerQuestEngine/rendering/renderer.py",
    "LedgerQuestEngine/tests/conftest.py",
    "LedgerQuestEngine/tests/integration/__init__.py",
    "LedgerQuestEngine/tests/integration/test_websocket_flow.py",
    "LedgerQuestEngine/infra/step_functions/game_loop_statemachine.asl.json",
    "LedgerQuestEngine/infra/scripts/deploy.sh",
    "LedgerQuestEngine/tests/integration/test_full_game_tick.py",
    "LedgerQuestEngine/docs/api/conf.py",
    "LedgerQuestEngine/tests/unit/__init__.py",
    "LedgerQuestEngine/docs/guides/deployment_guide.md",
    "LedgerQuestEngine/docs/guides/level_editor_manual.md",
    "LedgerQuestEngine/docs/architecture/overview.md",
    "LedgerQuestEngine/tests/unit/engine/scripting/test_host.py",
    "LedgerQuestEngine/docs/guides/scripting_api_reference.md",
    "LedgerQuestEngine/tests/unit/engine/__init__.py",
    "LedgerQuestEngine/infra/sam_template.yaml"
  ],
  "task_category": "cross_file_refactoring",
  "evaluation_criteria": [
    "**Correctness of Abstraction:** Was a new `interface.py` file created with a proper `AbstractPhysicsSimulator` ABC using Python's `abc` module?",
    "**Implementation of Interface:** Does the `Simulator` class in `simulator.py` correctly inherit from and implement the `AbstractPhysicsSimulator` interface?",
    "**Decoupling of Consumer:** Is the `PhysicsUpdater` service in `physics_updater.py` fully decoupled from the concrete `Simulator` class? (i.e., it imports and type-hints against `AbstractPhysicsSimulator`).",
    "**Dependency Injection:** Was the instantiation of `Simulator` moved out of the `PhysicsUpdater` and injected into it at a higher level of the application?",
    "**Functional Equivalence:** Does the refactored code pass all existing unit tests in `tests/unit/engine/physics/test_simulator.py` without modification to the test logic?",
    "**Code Cohesion:** Are the changes localized to the relevant modules (physics, game loop services, and their initializers) without creating unnecessary side-effects in unrelated files?",
    "**Code Quality:** Is the new code clean, readable, and does it follow standard Python conventions?"
  ]
}