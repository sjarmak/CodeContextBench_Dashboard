{
  "ground_truth": "The final state of the codebase should reflect a successful consolidation:\n\n*   **File Creation:** The file `flockdesk/core/services/user_service.py` exists and contains the `UserService` class.\n*   **File Deletion:** The files `flockdesk/core/services/profile_service.py` and `flockdesk/modules/presence/service.py` have been deleted from the project.\n*   **Code Modification:**\n    *   The new `UserService` class integrates methods for fetching profile data and managing real-time presence.\n    *   Files like `chat_vm.py`, `presence_vm.py`, `presence_widget.py`, and `avatar_widget.py` have been modified to import and use `UserService` exclusively for user data needs.\n    *   The service initialization/registration logic in `flockdesk/core/app.py` (or equivalent) has been updated to remove `ProfileService` and `PresenceService` and add `UserService`.\n*   **Test Modification:**\n    *   A new test file, `tests/unit/core/test_user_service.py` (or similar), exists and provides coverage for the new service.\n    *   Existing tests that depended on the old services have been updated or removed. For instance, `tests/integration/test_profile_sync.py` is either deleted or refactored to test the new service.",
  "context_files": [
    "flockdesk/core/shell/layout_manager.py",
    "flockdesk/core/services/auth_service.py",
    "flockdesk/core/services/settings_service.py",
    "flockdesk/core/services/update_service.py",
    "flockdesk/core/services/profile_service.py",
    "flockdesk/core/services/process_manager.py",
    "flockdesk/core/plugins/plugin_manager.py",
    "flockdesk/core/theming/theme_manager.py",
    "flockdesk/core/shortcuts/shortcut_manager.py",
    "flockdesk/modules/chat/service.py",
    "flockdesk/modules/whiteboard/service.py",
    "flockdesk/modules/co_editor/service.py",
    "flockdesk/modules/presence/service.py",
    "flockdesk/modules/dashboard/service.py",
    "flockdesk/shared/mvvm/viewmodel_base.py",
    "flockdesk/shared/mvvm/view_base.py",
    "tests/unit/core/test_settings_service.py",
    "tests/unit/core/test_layout_manager.py",
    "tests/unit/core/test_plugin_manager.py",
    "tests/unit/modules/test_whiteboard_model.py",
    "flockdesk/shared/utils/singleton.py",
    "flockdesk/core/services/crash_reporter.py",
    "flockdesk/shared/ipc/event_client.py",
    "flockdesk/shared/widgets/avatar_widget.py",
    "flockdesk/shared/schemas/user_profile.py",
    "flockdesk/shared/schemas/events.py",
    "tests/unit/shared/test_event_schemas.py",
    "flockdesk/core/shell/menu_bar.py",
    "flockdesk/modules/whiteboard/model/canvas_state.py",
    "tests/conftest.py",
    "flockdesk/modules/presence/viewmodel/presence_vm.py",
    "flockdesk/modules/chat/main.py",
    "flockdesk/modules/whiteboard/main.py",
    "scripts/run_dev.sh",
    "flockdesk/core/app.py",
    "assets/icons/app_icon.png",
    "flockdesk/modules/presence/main.py",
    "flockdesk/modules/whiteboard/viewmodel/whiteboard_vm.py",
    "flockdesk/modules/dashboard/viewmodel/dashboard_vm.py",
    "flockdesk/modules/chat/model/conversation.py",
    "flockdesk/modules/dashboard/main.py",
    "plugins_available/poll_plugin/poll.py",
    "flockdesk/modules/co_editor/main.py",
    "flockdesk/core/ipc/event_types.py",
    "flockdesk/modules/presence/view/presence_widget.py",
    "scripts/build.py",
    "flockdesk/core/shortcuts/commands.py",
    "flockdesk/modules/whiteboard/view/whiteboard_widget.py",
    "tests/integration/test_profile_sync.py",
    "flockdesk/modules/co_editor/viewmodel/editor_vm.py",
    "flockdesk/core/main.py",
    "flockdesk/core/shell/status_bar.py",
    "tests/unit/modules/test_chat_vm.py",
    "plugins_available/code_review_plugin/review_widget.py",
    "plugins_available/code_review_plugin/review_panel.py",
    "flockdesk/core/ipc/event_bus.py",
    "tests/integration/test_event_bus_communication.py",
    "flockdesk/core/plugins/plugin_manifest.py",
    "flockdesk/modules/co_editor/model/document.py",
    "flockdesk/core/shell/main_window.py",
    "flockdesk/modules/chat/viewmodel/chat_vm.py",
    "flockdesk/modules/dashboard/view/dashboard_widget.py",
    "flockdesk/modules/chat/view/chat_widget.py",
    "tests/integration/test_plugin_loading.py",
    "flockdesk/modules/co_editor/view/editor_widget.py",
    "flockdesk/modules/chat/view/chat_widget.ui",
    "plugins_available/poll_plugin/poll_widget.py",
    "docs/guides/03_plugin_development.md",
    "flockdesk/modules/presence/model/user_status.py",
    "assets/fonts/Inter-Regular.ttf",
    "docs/architecture.md",
    "flockdesk/core/theming/themes/light_theme.qss",
    "docs/api/conf.py"
  ],
  "task_category": "cross_file_refactoring",
  "evaluation_criteria": [
    "**Correctness & Functionality:** The application must compile and run without errors. All user-related features (displaying avatars, names, online statuses) must work as before. All tests in the suite must pass.",
    "**Completeness of Refactoring:** All usages of `ProfileService` and `PresenceService` must be successfully replaced with `UserService`. The two old service files must be deleted.",
    "**Architectural Soundness:** The new `UserService` must be well-designed, providing a clean and unified API that effectively encapsulates the combined responsibilities of the former services.",
    "**Code Quality:** The new and modified code must adhere to existing project conventions, be readable, and not introduce new bugs or code smells.",
    "**Test Maintenance:** The agent must demonstrate an ability to manage the test suite by creating, modifying, and deleting test files and test cases as appropriate for the refactoring.",
    "**File System Operations:** The agent must correctly create the new service file in the specified location and correctly delete the old files without leaving orphans or deleting incorrect files."
  ]
}