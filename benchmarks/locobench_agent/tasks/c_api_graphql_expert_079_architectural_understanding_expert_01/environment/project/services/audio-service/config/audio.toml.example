# SynestheticCanvas Audio-Service
# Example configuration file (audio.toml)

[service]
name = "audio-service"
instance_id = "audio-01"           # Unique service instance identifier
environment = "development"        # production | staging | development
bind_addr = "0.0.0.0"
port = 7001
base_url = "http://localhost:7001"
shutdown_timeout = 15              # Seconds allowed for graceful shutdown

[versioning]
default_version = "v1"
supported_versions = ["v1", "v2", "v3"]
service_semver = "1.3.0"           # Semantic version of this service build

[logging]
level = "debug"                    # debug | info | warn | error
format = "json"                    # json  | text
file = "logs/audio-service.log"
max_size     = 100                 # MiB before log rotation
max_backups  = 10                  # Rotated log files to retain
max_age      = 30                  # Days to keep a rotated log file
compress     = true                # Gzip old log files

[metrics]
enabled   = true
bind_addr = "0.0.0.0"
port      = 9102
push_gateway = ""                  # Optional Prometheus Pushgateway URL

[tracing]
enabled     = true
provider    = "jaeger"             # jaeger | opentelemetry | zipkin
endpoint    = "http://localhost:14268/api/traces"
sample_rate = 0.25                 # 25 % of requests will be traced

[security]
[security.tls]
enabled    = false
cert_file  = "/etc/ssl/certs/audio-service.crt"
key_file   = "/etc/ssl/private/audio-service.key"

[security.basic_auth]
username = "scadmin"
password = "change_me"

[ratelimit]
enabled      = true
rps          = 25                  # Requests per second per client
burst        = 50                  # Maximum burst per client
ban_seconds  = 60                  # Temporary ban for persistent offenders

[cache]
driver       = "redis"             # redis | inmem | memcached
ttl_seconds  = 300
redis_url    = "redis://127.0.0.1:6379/0"

[database]
driver                  = "postgres"
dsn                     = "postgres://artist:secret@localhost:5432/synesthetic_canvas?sslmode=disable"
max_open_conns          = 25
max_idle_conns          = 5
conn_max_lifetime_secs  = 1800

[repository]
enable_read  = true
enable_write = true

[validator]
schema_dir        = "./schemas"
max_body_bytes    = 1_048_576       # 1 MiB

[transcoder]
ffmpeg_bin   = "/usr/bin/ffmpeg"    # Path to FFmpeg executable
bitrate_kbps = 192
sample_rate  = 48000
channels     = "stereo"            # stereo | 5.1 | 7.1
true_peak    = true

[stream]
allowed_mime      = ["audio/mpeg", "audio/wav", "audio/ogg"]
chunk_size        = 65536          # Stream chunk size (bytes)
idle_timeout      = 90             # Seconds before idle connection terminates
max_concurrent    = 100            # Maximum concurrent streams

[graphql]
endpoint          = "/graphql"
playground        = true           # Disabled automatically in production
max_depth         = 10
complexity_limit  = 250

[rest]
enabled = true
prefix  = "/api/v1"

[rest.pagination]
default_limit = 50
max_limit     = 500

[alerting]
enabled      = true
provider     = "slack"
webhook_url  = "https://hooks.slack.com/services/EXAMPLE"
notify_on    = ["panic", "error"]

[features]
enable_waveform_cache           = true
enable_loudness_normalization   = true
enable_dynamic_range_compression = false

# End of audio.toml.example