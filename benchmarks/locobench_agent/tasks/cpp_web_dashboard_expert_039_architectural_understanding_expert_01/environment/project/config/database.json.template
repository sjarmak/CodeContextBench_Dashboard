{
  "$schema": "https://mosaicboard.studio/schemas/db-config.schema.json",

  /* =========================================================================
     MosaicBoard Studio – Database Connection Template
     -------------------------------------------------------------------------
     NOTE:
     1. This file is committed to the repository *as a template only*.
        Copy it to `database.json` (excluded via .gitignore) and replace every
        `${ENV:VAR}` placeholder with an actual value or keep the reference if
        your deployment platform performs runtime interpolation.
     2. All connection-sensitive data must come from the environment or a
        secrets-manager. **Never** commit live credentials to VCS.
     3. Field descriptions intentionally start with an underscore to avoid
        collisions with vendor-specific drivers that may reject unknown keys.
  ========================================================================= */

  "_meta": {
    "_generated": "2024-03-29T00:00:00Z",
    "_author":   "MosaicBoard Studio – DevOps",
    "_profile":  "Template"
  },

  /* -------------------------------------------------------------------------
     Global Defaults
  ------------------------------------------------------------------------- */
  "defaults": {
    "driver":              "postgres",
    "host":                "${ENV:DB_HOST}",
    "port":                "${ENV:DB_PORT|5432}",
    "database":            "${ENV:DB_NAME}",
    "username":            "${ENV:DB_USER}",
    "password":            "${ENV:DB_PASS}",
    "schema":              "public",
    "timezone":            "UTC",

    /* Connection Pool ------------------------------------------------------ */
    "pool": {
      "min_size":          2,
      "max_size":          20,
      "max_idle_time_ms":  30000,
      "connection_lifetime_ms": 1800000,
      "health_check_sec":  30
    },

    /* SSL / TLS ------------------------------------------------------------ */
    "ssl": {
      "enabled":           "${ENV:DB_SSL_ENABLED|false}",
      "mode":              "require",           // require | verify-ca | verify-full
      "root_cert":         "${ENV:DB_SSL_ROOT_CERT|}",
      "client_cert":       "${ENV:DB_SSL_CLIENT_CERT|}",
      "client_key":        "${ENV:DB_SSL_CLIENT_KEY|}"
    },

    /* Advanced ------------------------------------------------------------- */
    "statement_timeout_ms": 60000,
    "application_name":     "MosaicBoard-Studio",
    "search_path":          ["public"],

    "_notes": "The defaults above are inherited by each environment unless explicitly overridden."
  },

  /* -------------------------------------------------------------------------
     Environment-Specific Overrides
  ------------------------------------------------------------------------- */
  "environments": {
    "development": {
      "_description": "Local developer workstation",
      "host":       "${ENV:DEV_DB_HOST|127.0.0.1}",
      "username":   "${ENV:DEV_DB_USER|mosaicdev}",
      "password":   "${ENV:DEV_DB_PASS|mosaicdev}",
      "database":   "${ENV:DEV_DB_NAME|mosaicboard_dev}",
      "pool": {
        "max_size": 10
      },
      "ssl": {
        "enabled": false
      }
    },

    "test": {
      "_description": "Automated CI pipelines – in-memory or disposable db",
      "driver":     "sqlite",
      "database":   ":memory:",
      "pool": {
        "min_size": 1,
        "max_size": 1
      }
    },

    "staging": {
      "_description": "Pre-production mirror",
      "host":       "${ENV:STAGE_DB_HOST}",
      "username":   "${ENV:STAGE_DB_USER}",
      "password":   "${ENV:STAGE_DB_PASS}",
      "database":   "${ENV:STAGE_DB_NAME}",
      "pool": {
        "max_size": 15
      },
      "ssl": {
        "enabled": true,
        "mode":    "verify-ca"
      }
    },

    "production": {
      "_description": "Live customer traffic",
      "host":       "${ENV:PROD_DB_HOST}",
      "username":   "${ENV:PROD_DB_USER}",
      "password":   "${ENV:PROD_DB_PASS}",
      "database":   "${ENV:PROD_DB_NAME}",
      "pool": {
        "max_size": 40
      },
      "ssl": {
        "enabled": true,
        "mode":    "verify-full"
      },
      "statement_timeout_ms": 30000
    }
  },

  /* -------------------------------------------------------------------------
     Replica & Read-Scaling (Optional)
  ------------------------------------------------------------------------- */
  "read_replicas": [
    {
      "name":       "replica-1",
      "host":       "${ENV:REPLICA1_HOST}",
      "port":       5432,
      "username":   "${ENV:REPLICA1_USER}",
      "password":   "${ENV:REPLICA1_PASS}",
      "ssl": {
        "enabled": true,
        "mode":    "verify-ca"
      },
      "pool": {
        "min_size": 2,
        "max_size": 15
      }
    }
  ],

  /* -------------------------------------------------------------------------
     ORM Settings
  ------------------------------------------------------------------------- */
  "orm": {
    "dialect":                 "postgres",
    "enable_lazy_loading":     true,
    "auto_migrate":            false,
    "migrations_directory":    "./database/migrations",
    "models_namespace":        "Mosaic::ORM::Models",
    "naming_strategy":         "snake_case"
  }
}