```yaml
# ======================================================================
#  OpsForge Utility Nexus - Data Anonymizer Service
#  Global Spring Boot configuration file (application.yml)
#
#  The service follows a strict hexagonal architecture; therefore all
#  technology-specific details live in adapters that can be swapped
#  without touching business logic.  This configuration focuses on
#  infrastructure concerns such as:
#    • Observability (Actuator, Prometheus, structured logging, tracing)
#    • Environment-specific Datasource & Cache definitions
#    • Cross-cutting features (rate-limit, pagination, error handling)
#    • Secure defaults via environment variable overrides
#
#  NOTE:
#    1. Secrets must never be hard-coded; reference ENV variables.
#    2. Keep profile-specific overrides at the bottom of this file.
# ======================================================================

spring:
  application:
    name: data-anonymizer-service

  profiles:
    # Can be overridden at runtime: ‑Dspring.profiles.active=prod
    active: ${SPRING_PROFILES_ACTIVE:default}

  datasource:
    # Default datasource points to PostgreSQL; overridden in each profile.
    url: ${DB_URL:jdbc:postgresql://localhost:5432/data_anonymizer}
    username: ${DB_USER:anonymizer}
    password: ${DB_PASSWORD:secret}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      idle-timeout: 10000        # ms
      connection-timeout: 3000   # ms
      leak-detection-threshold: 2000
      pool-name: anonymizer-hikari

  jackson:
    serialization:
      write_dates_as_timestamps: false
    deserialization:
      fail-on-unknown-properties: true

  mvc:
    async:
      request-timeout: 30s

  # Distributed cache configuration (delegated to cache adapter)
  cache:
    type: redis
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      ssl: ${REDIS_SSL:false}
      time-to-live: 600000 # ms

  # Configure SpringDoc / OpenAPI generator
  doc:
    swagger-ui:
      path: /swagger-ui.html
      operationsSorter: method
    api-docs:
      path: /v3/api-docs

server:
  port: ${SERVER_PORT:8080}
  servlet:
    context-path: /api

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  metrics:
    export:
      prometheus:
        enabled: true
  endpoint:
    health:
      probes:
        enabled: true
    shutdown:
      enabled: false

logging:
  level:
    root: INFO
    com.opsforge.utility: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%X{traceId:-}] %logger{36} - %msg%n"

# ----------------------------------------------------------------------
#  Custom application-specific settings (exposed via @ConfigurationProps)
# ----------------------------------------------------------------------
app:
  version: v1
  pagination:
    default-page-size: 20
    max-page-size: 100
  cache:
    ttl-seconds: 600
  anonymizer:
    defaults:
      strategy: HASH
      fail-if-unsupported: true
    strategies:
      - name: HASH
        algorithm: SHA-512
        salt-env-variable: ANONYMIZER_SALT
      - name: MASK
        pattern: "(?<=.{3})."
        replacement: "*"
      - name: NULLIFY

# ───────────────────────────────────────────────────────────────────────
#  Profile: DEV  (activate with --spring.profiles.active=dev)
# ───────────────────────────────────────────────────────────────────────
---
spring:
  config:
    activate:
      on-profile: dev

  datasource:
    url: ${DB_URL_DEV:jdbc:postgresql://localhost:5432/data_anonymizer_dev}
    hikari:
      maximum-pool-size: 5

logging:
  level:
    root: DEBUG
  pattern:
    console: "%clr{%d{yyyy-MM-dd HH:mm:ss.SSS}}{faint} %clr{${PID:-}}{magenta} %clr{%-5level }{yellow} %clr{[%X{traceId:-}]}{cyan} %clr{%logger{36}}{green} %clr{- }{faint}%msg%n"

server:
  port: 8081

app:
  cache:
    ttl-seconds: 60   # Aggressive TTL for rapid local testing

# ───────────────────────────────────────────────────────────────────────
#  Profile: TEST  (activate with --spring.profiles.active=test)
# ───────────────────────────────────────────────────────────────────────
---
spring:
  config:
    activate:
      on-profile: test

  # Switch to in-memory database for isolated tests
  datasource:
    url: jdbc:h2:mem:anonymizerdb;DB_CLOSE_DELAY=-1;MODE=PostgreSQL
    driver-class-name: org.h2.Driver
    username: sa
    password: sa
  sql:
    init:
      mode: embedded

logging:
  level:
    root: WARN

server:
  port: 0             # Random port for parallel test execution

# ───────────────────────────────────────────────────────────────────────
#  Profile: PROD  (activate with --spring.profiles.active=prod)
# ───────────────────────────────────────────────────────────────────────
---
spring:
  config:
    activate:
      on-profile: prod

  datasource:
    url: ${DB_URL}
    username: ${DB_USER}
    password: ${DB_PASSWORD}
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      idle-timeout: 60000

  cache:
    redis:
      ssl: true
      time-to-live: 1800000 # 30 min

  main:
    # Fail fast if profile mis-match or bean override detected
    allow-bean-definition-overriding: false

server:
  port: ${PORT:80}

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,loggers

# OAuth2 / OIDC resource server configuration
security:
  oauth2:
    resourceserver:
      jwt:
        issuer-uri: ${OAUTH2_ISSUER_URI}
    client:
      registration:
        opsforge:
          client-id: ${CLIENT_ID}
          client-secret: ${CLIENT_SECRET}
          scope: openid,profile,email
          authorization-grant-type: client_credentials
          provider: opsforge
      provider:
        opsforge:
          issuer-uri: ${OAUTH2_ISSUER_URI}
```