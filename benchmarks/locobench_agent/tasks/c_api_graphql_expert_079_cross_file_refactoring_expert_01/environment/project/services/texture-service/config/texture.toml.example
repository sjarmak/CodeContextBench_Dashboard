# ==============================================================================
# SynestheticCanvas Texture Service - Example Configuration
# ------------------------------------------------------------------------------ 
# This file provides a comprehensive, self-documented reference configuration
# for the “texture-service” micro-service.  Copy this file to `texture.toml`,
# review every section, and tailor the values to your deployment targets
# (development, staging, production, etc.).
#
# All time-related settings are expressed in either *milliseconds* or *seconds*
# as explicitly stated by the key name.
# ==============================================================================

################################################################################
# Core Service Metadata
################################################################################
[service]
name        = "texture-service"   # Human-readable identifier
version     = "1.4.0"             # Pin service version for observability
environment = "development"       # dev | staging | production

################################################################################
# HTTP Server Configuration
################################################################################
[server]
bind                  = "0.0.0.0" # Listen on all interfaces by default
port                  = 8082
read_timeout_ms       = 10_000
write_timeout_ms      = 10_000
max_header_bytes      = 1_048_576  # 1 MiB
graceful_shutdown_ms  = 15_000

################################################################################
# Security / CORS / AuthN+AuthZ
################################################################################
[security]
# Allowed origins for browsers.  Use fully-qualified hosts in production.
allowed_origins       = ["*"]
token_provider_url    = "http://auth:8090/oauth2/token"
required_scopes       = ["textures.read", "textures.write"]

################################################################################
# Logging & Tracing
################################################################################
[logging]
level   = "debug"      # debug | info | warn | error
format  = "json"       # json  | text
output  = "stdout"     # stdout | stderr | /path/to/file

################################################################################
# Object Storage (e.g., AWS S3, MinIO)
################################################################################
[storage]
driver         = "s3"                         # s3 | filesystem | gcs
bucket         = "synesthetic-textures-dev"
region         = "us-east-1"
cache_ttl_secs = 259_200                      # 3 days

################################################################################
# Primary SQL Database (DDL managed by migrations)
################################################################################
[database]
type                  = "postgres"
dsn                   = "postgres://texture_user:secret@db:5432/textures?sslmode=disable"
max_open_conns        = 25
max_idle_conns        = 10
conn_max_lifetime_secs= 300

################################################################################
# Redis / Memory Cache
################################################################################
[redis]
addr             = "redis:6379"
db               = 1
password         = ""
max_retries      = 3
dial_timeout_ms  = 500
read_timeout_ms  = 800
write_timeout_ms = 800
pool_size        = 10

################################################################################
# Texture-Processing Defaults
################################################################################
[texture]
default_interpolation = "bicubic"          # nearest | bilinear | bicubic
max_resolution_px     = 16_384
max_upload_mb         = 512
generate_on_demand    = true

# Ordered pipeline stages; each stage maps to an internal C module
pipeline              = [
  "decode",
  "color-space",
  "normal-map",
  "compress",
  "store"
]

################################################################################
# Compression Settings
################################################################################
[compression]
formats = ["dxt1", "dxt5", "astc", "basisu"]
level   = 5               # 0 (fast/large) … 9 (slow/small)

################################################################################
# Monitoring / Observability
################################################################################
[monitoring]
prometheus_endpoint = "/metrics"
enable_tracing      = true
jaeger_endpoint     = "http://jaeger:14268/api/traces"
sampling_ratio      = 0.1              # 10 % of traffic

################################################################################
# Rate Limiting
################################################################################
[ratelimit]
enabled              = true
requests_per_minute  = 1_200
burst                = 200
strategy             = "token_bucket"  # token_bucket | leaky_bucket

################################################################################
# Feature Flags
################################################################################
[feature_flags]
enable_gpu_acceleration   = true
enable_basisu_transcoder  = false

################################################################################
# GraphQL Gateway Settings
################################################################################
[graphql]
schema_path          = "./schema/texture.graphql"
introspection_enabled= true
playground_enabled   = true

################################################################################
# REST Fallback API
################################################################################
[rest]
base_path     = "/textures/v1"
enable_openapi= true
openapi_path  = "/openapi.json"

################################################################################
# Retry / Backoff Policy for Upstream Calls
################################################################################
[retries]
max_attempts = 3
backoff_ms   = [100, 200, 500]   # Jitter added automatically by client

################################################################################
# Service-Level Timeouts
################################################################################
[timeouts]
external_request_ms   = 5_000
texture_generation_ms = 45_000
