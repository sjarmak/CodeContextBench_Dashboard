# =============================================================================
# SynestheticCanvas Palette Service – Example Configuration
# -----------------------------------------------------------------------------
# This is a fully-annotated example of palette-service’s configuration file.
# Copy it to `palette.toml`, adjust values for your environment, and rebuild
# the container or send SIGHUP to reload.
#
# NOTE: Comments use the std. TOML “#” symbol. All durations follow the
#       Go time format (e.g., "300ms", "5s", "10m").
# =============================================================================

###############################################################################
# Service-level metadata
###############################################################################
[service]
name                     = "palette-service"     # Human-readable service id.
environment              = "development"         # dev | staging | production
version                  = "1.0.0"               # Service semantic version.
enable_hot_reload        = true                  # Auto-reload configs in dev.
graceful_shutdown_timeout= "15s"                 # Max time to finish in-flight reqs.

###############################################################################
# HTTP Server
###############################################################################
[server.http]
host              = "0.0.0.0"
port              = 8081
read_timeout      = "5s"
write_timeout     = "5s"
idle_timeout      = "60s"
max_header_bytes  = 1_048_576                  # 1 MiB

###############################################################################
# (Optional) gRPC Server
###############################################################################
[server.grpc]
enabled                 = true
host                    = "0.0.0.0"
port                    = 9091
max_concurrent_streams  = 1024
keepalive_time          = "120s"

###############################################################################
# Primary Postgres Data Store
###############################################################################
[database]
driver            = "postgres"
dsn               = "postgres://palette_user:secret@palette-db:5432/palettes?sslmode=disable"
max_open_conns    = 50
max_idle_conns    = 10
conn_max_lifetime = "30m"

###############################################################################
# Redis Cache (for palette snapshots & rate-limiter buckets)
###############################################################################
[cache.redis]
enabled        = true
addr           = "redis:6379"
db             = 3
password       = ""
dial_timeout   = "3s"
read_timeout   = "3s"
write_timeout  = "3s"
pool_size      = 20

###############################################################################
# JWT/OIDC Authentication
###############################################################################
[auth]
jwks_uri           = "https://auth.synestheticcanvas.io/.well-known/jwks.json"
audience           = "palette-service"
issuer             = "https://auth.synestheticcanvas.io/"
allowed_algorithms = ["RS256"]

###############################################################################
# Structured Logging
###############################################################################
[logging]
level        = "debug"                         # debug | info | warn | error
format       = "json"                          # json | console
file         = "/var/log/synestheticcanvas/palette-service.log"
max_size     = 100                             # Size (MiB) before rotate.
max_backups  = 7                               # Files to retain.
max_age      = 28                              # Days to retain.
compress     = true                            # Gzip old logs.

###############################################################################
# Distributed Tracing (OpenTelemetry)
###############################################################################
[tracing]
enabled      = true
exporter     = "otlp"                          # otlp | jaeger | zipkin
endpoint     = "http://otel-collector:4317"
sample_rate  = 0.25                            # 0.0–1.0

###############################################################################
# Request Rate-Limiting
###############################################################################
[rate_limit]
enabled     = true
requests_per_second = 100
burst       = 200
strategy    = "token_bucket"                   # token_bucket | leaky_bucket

###############################################################################
# Pagination Defaults
###############################################################################
[pagination]
default_limit = 25
max_limit     = 100

###############################################################################
# Palette Engine Settings
###############################################################################
[palette]
default_color_model   = "rgb"                  # rgb | hsl | lab
allow_custom_palettes = true
max_palette_size      = 256

###############################################################################
# Palette Repository Configuration
###############################################################################
[palette.repository]
type              = "file"                     # file | s3 | git
path              = "/data/palettes"
watch_for_changes = true                       # Watch FS & hot-reload.
sync_interval     = "15s"

# --- Git-based repository (optional) ----------------------------------------
[palette.repository.git]
enabled        = false
remote         = "git@github.com:synestheticcanvas/palettes.git"
branch         = "main"
poll_interval  = "5m"
ssh_key_path   = "/run/secrets/git_ssh_key"

###############################################################################
# JSON Schema Validators
###############################################################################
[validators]
schema_dir = "/etc/synestheticcanvas/palette-schemas"
fail_fast  = true                              # Stop on first validation error.

###############################################################################
# Feature Flags / Experimental Toggles
###############################################################################
[experimental]
enable_lab_features = false
feature_flags       = ["svg_gradient_export"]  # Array of strings.