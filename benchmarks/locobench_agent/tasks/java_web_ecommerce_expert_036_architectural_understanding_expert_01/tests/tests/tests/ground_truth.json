{
  "ground_truth": "### WMS Integration Technical Plan\n\n#### 1. Module and Dependency Strategy\n\nA new Maven module `sprintcart-pro-adapters/wms-adapter` will be created. \n-   **Dependencies:** `wms-adapter` will depend on `sprintcart-pro-application` and `sprintcart-pro-domain` to access the port interfaces and application services it needs to call.\n-   **Configuration:** The main `sprintcart-pro-app` module will need to add `wms-adapter` as a dependency in its `pom.xml` so that the Spring Boot application can discover and wire the new beans (Controller, Adapter implementation).\n\n#### 2. Ports (Interfaces) Definition\n\nTwo new ports will be created in the `sprintcart-pro-domain` module:\n\n-   **Outbound Port:** For sending data to the WMS.\n    -   **File:** `sprintcart-pro-domain/src/main/java/com/sprintcart/domain/ports/out/wms/WmsPort.java`\n    -   **Interface:** \n        ```java\n        package com.sprintcart.domain.ports.out.wms;\n\n        import com.sprintcart.domain.model.order.Order;\n\n        public interface WmsPort {\n            /**\n             * Submits a fulfillment request to the external WMS.\n             * @param order The confirmed order to be fulfilled.\n             */\n            void requestFulfillment(Order order);\n        }\n        ```\n-   **Inbound Port (Use Case):** For updating stock from an external system.\n    -   **File:** `sprintcart-pro-domain/src/main/java/com/sprintcart/domain/ports/in/inventory/UpdateStockUseCase.java`\n    -   **Interface:**\n        ```java\n        package com.sprintcart.domain.ports.in.inventory;\n\n        public interface UpdateStockUseCase {\n            /**\n             * Updates the stock level for a given product SKU.\n             * @param sku The product SKU to update.\n             * @param quantityChange The change in quantity (can be positive or negative).\n             */\n            void updateStockLevel(String sku, int quantityChange);\n        }\n        ```\n\n#### 3. Adapter Implementation Plan\n\nThe `wms-adapter` module will contain:\n\n1.  **`WmsAdapter.java`:** Implements `WmsPort`. It will use a `WebClient` or `RestTemplate` to make an outbound POST request to the WMS API's fulfillment endpoint. It will map the domain `Order` model to a WMS-specific DTO before sending.\n2.  **`WmsController.java`:** A new `@RestController` that exposes a secure endpoint (e.g., `POST /api/internal/wms/stock-update`). It will accept a WMS-specific DTO, validate it, and then call the `UpdateStockUseCase` port.\n3.  **`WmsDto.java`:** A record or class representing the stock update payload from the WMS.\n\n#### 4. Application Layer Orchestration\n\n-   **Outbound (Fulfillment):** The `FulfillmentService` in the `application` module will be injected with `WmsPort`. A new method, `processFulfillment(Order order)`, will be added. This method will be called (e.g., by the `DomainEventProcessor` listening for `OrderPlacedEvent`) and will invoke `wmsPort.requestFulfillment(order)`.\n-   **Inbound (Stock Update):** The `CatalogService` in the `application` module will implement the `UpdateStockUseCase` interface. The `updateStockLevel` method will use the existing `ProductRepositoryPort` to find the product by SKU, update its stock quantity, and save it back to the database.\n\n#### 5. Data Flow Diagram (Inbound Stock Update)\n\n`External WMS` -> `[Network]` -> `1. WmsController` (in `wms-adapter`) -> `2. UpdateStockUseCase` (port in `domain`) -> `3. CatalogService` (implementation in `application`) -> `4. ProductRepositoryPort` (port in `domain`) -> `5. ProductRepositoryAdapter` (implementation in `persistence-adapter`) -> `6. Database`\n\n#### 6. Architectural Justification\n\nThis plan strictly adheres to the principles outlined in **`docs/architecture/adr/001-hexagonal-architecture.md`**. \n\n1.  **Dependency Inversion:** The `domain` core defines the `WmsPort` and `UpdateStockUseCase` interfaces but has no knowledge of the WMS itself. The `wms-adapter`, an infrastructure detail, depends on the domain, not the other way around. This follows the Dependency Rule.\n2.  **Separation of Concerns:** The new `wms-adapter` encapsulates all details of the WMS communication (endpoints, DTOs, client logic), isolating it from the core business logic. This is consistent with the visual separation shown in the **`docs/architecture/c4-model/03_component_diagram.puml`**, where adapters (like Persistence, Payment) are on the periphery of the system.\n",
  "context_files": [
    "sprintcart-pro/pom.xml",
    "sprintcart-pro/sprintcart-pro-app/pom.xml",
    "sprintcart-pro/sprintcart-pro-app/src/main/java/com/sprintcart/app/config/WebSecurityConfig.java",
    "sprintcart-pro/sprintcart-pro-app/src/main/java/com/sprintcart/app/config/CacheConfig.java",
    "sprintcart-pro/sprintcart-pro-domain/pom.xml",
    "sprintcart-pro/sprintcart-pro-application/pom.xml",
    "sprintcart-pro/sprintcart-pro-adapters/pom.xml",
    "sprintcart-pro/sprintcart-pro-adapters/web-adapter/pom.xml",
    "sprintcart-pro/sprintcart-pro-adapters/persistence-adapter/pom.xml",
    "sprintcart-pro/sprintcart-pro-adapters/payment-adapter/pom.xml",
    "sprintcart-pro/sprintcart-pro-adapters/notification-adapter/pom.xml",
    "sprintcart-pro/sprintcart-pro-adapters/search-adapter/pom.xml",
    "sprintcart-pro/sprintcart-pro-spa/package.json",
    "sprintcart-pro/docs/architecture/c4-model/03_component_diagram.puml",
    "sprintcart-pro/sprintcart-pro-application/src/main/java/com/sprintcart/application/service/DomainEventProcessor.java",
    "sprintcart-pro/sprintcart-pro-application/src/main/java/com/sprintcart/application/service/AutomationService.java",
    "sprintcart-pro/sprintcart-pro-application/src/main/java/com/sprintcart/application/service/OrderService.java",
    "sprintcart-pro/sprintcart-pro-application/src/main/test/java/com/sprintcart/application/service/CatalogServiceTest.java",
    "sprintcart-pro/sprintcart-pro-application/src/main/java/com/sprintcart/application/service/FulfillmentService.java",
    "sprintcart-pro/sprintcart-pro-application/src/main/java/com/sprintcart/application/service/CatalogService.java",
    "sprintcart-pro/docs/architecture/adr/001-hexagonal-architecture.md",
    "sprintcart-pro/sprintcart-pro-application/src/main/test/java/com/sprintcart/application/service/OrderServiceTest.java",
    "sprintcart-pro/docs/architecture/c4-model/02_container_diagram.puml",
    "sprintcart-pro/docs/architecture/c4-model/01_system_context.puml",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/ports/in/catalog/ManageCatalogUseCase.java",
    "sprintcart-pro/sprintcart-pro-adapters/payment-adapter/src/main/java/com/sprintcart/adapters/payment/paypal/PayPalAdapter.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/model/productivity/Trigger.java",
    "sprintcart-pro/sprintcart-pro-adapters/payment-adapter/src/main/java/com/sprintcart/adapters/payment/stripe/StripeAdapter.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/model/catalog/Attribute.java",
    "sprintcart-pro/sprintcart-pro-adapters/web-adapter/src/main/java/com/sprintcart/adapters/web/rest/OrderController.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/ports/in/order/PlaceOrderUseCase.java",
    "sprintcart-pro/sprintcart-pro-adapters/web-adapter/src/main/java/com/sprintcart/adapters/web/rest/AdminController.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/model/productivity/AutomationRule.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/ports/in/automation/ConfigureAutomationUseCase.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/model/user/User.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/ports/in/order/ManageFulfillmentUseCase.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/ports/out/persistence/ProductRepositoryPort.java",
    "sprintcart-pro/sprintcart-pro-adapters/web-adapter/src/main/java/com/sprintcart/adapters/web/rest/GlobalExceptionHandler.java",
    "sprintcart-pro/sprintcart-pro-adapters/web-adapter/src/main/java/com/sprintcart/adapters/web/rest/ProductController.java",
    "sprintcart-pro/sprintcart-pro-adapters/search-adapter/src/main/java/com/sprintcart/adapters/search/elasticsearch/ElasticsearchAdapter.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/model/catalog/Sku.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/model/order/ShippingInfo.java",
    "sprintcart-pro/sprintcart-pro-adapters/persistence-adapter/src/main/java/com/sprintcart/adapters/persistence/entity/ProductEntity.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/model/order/OrderItem.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/model/productivity/ProductivityMetric.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/events/OrderPlacedEvent.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/model/productivity/UserTask.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/events/StockLevelCriticalEvent.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/model/user/CustomerProfile.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/model/catalog/Product.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/model/productivity/WorkQueue.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/ports/out/notification/EmailNotificationPort.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/model/catalog/Category.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/model/order/Order.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/ports/out/search/ProductSearchPort.java",
    "sprintcart-pro/sprintcart-pro-application/src/main/java/com/sprintcart/application/dto/ProductDTO.java",
    "sprintcart-pro/sprintcart-pro-application/src/main/java/com/sprintcart/application/dto/OrderDTO.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/ports/out/persistence/UserRepositoryPort.java",
    "sprintcart-pro/docs/api/openapi.yml",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/ports/out/erp/ErpSystemPort.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/model/user/Role.java",
    "sprintcart-pro/docs/guides/deployment_guide.md",
    "sprintcart-pro/sprintcart-pro-domain/README.md",
    "sprintcart-pro/sprintcart-pro-app/src/main/java/com/sprintcart/app/SprintCartProApplication.java",
    "sprintcart-pro/sprintcart-pro-adapters/notification-adapter/src/main/java/com/sprintcart/adapters/notification/sendgrid/SendGridEmailAdapter.java",
    "sprintcart-pro/sprintcart-pro-app/src/main/java/com/sprintcart/app/config/BeanConfiguration.java",
    "sprintcart-pro/sprintcart-pro-adapters/persistence-adapter/src/main/java/com/sprintcart/adapters/persistence/entity/OrderEntity.java",
    "sprintcart-pro/sprintcart-pro-application/README.md",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/ports/out/payment/PaymentGatewayPort.java",
    "sprintcart-pro/README.md",
    "sprintcart-pro/sprintcart-pro-adapters/web-adapter/src/main/java/com/sprintcart/adapters/web/graphql/ProductGraphQLController.java",
    "sprintcart-pro/sprintcart-pro-application/src/main/java/com/sprintcart/application/dto/mappers/ProductMapper.java",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/model/order/OrderStatus.java",
    "sprintcart-pro/sprintcart-pro-application/src/main/java/com/sprintcart/application/dto/mappers/OrderMapper.java",
    "sprintcart-pro/.github/workflows/ci-cd-pipeline.yml",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/model/productivity/Action.java",
    "sprintcart-pro/docs/guides/setup_guide.md",
    "sprintcart-pro/sprintcart-pro-adapters/web-adapter/src/main/java/com/sprintcart/adapters/web/rest/AuthController.java",
    "sprintcart-pro/docs/api/graphql.schema",
    "sprintcart-pro/sprintcart-pro-domain/src/main/java/com/sprintcart/domain/ports/out/persistence/AutomationRuleRepositoryPort.java",
    "sprintcart-pro/sprintcart-pro-adapters/persistence-adapter/src/main/java/com/sprintcart/adapters/persistence/mapper/PersistenceMapper.java",
    "sprintcart-pro/docker-compose.yml",
    "sprintcart-pro/sprintcart-pro-adapters/persistence-adapter/src/main/java/com/sprintcart/adapters/persistence/adapter/ProductRepositoryAdapter.java",
    "sprintcart-pro/sprintcart-pro-app/src/main/resources/application-prod.yml"
  ],
  "task_category": "architectural_understanding",
  "evaluation_criteria": [
    "**Adherence to Hexagonal Architecture:** Did the agent correctly place new logic in the domain, application, and a new adapter layer, respecting the dependency rule?",
    "**Correct Component Identification:** Did the agent correctly identify the need for a new adapter module, new inbound/outbound ports, and a new controller?",
    "**Data Flow Accuracy:** Was the agent able to accurately trace the sequence of component interactions for both inbound and outbound scenarios?",
    "**Architectural Justification:** Did the agent successfully reference and apply the principles from the provided architectural documentation (`.md`, `.puml`)?",
    "**Distinction between Ports:** Did the agent correctly identify that the inbound interaction is a 'Use Case' port while the outbound interaction is a generic 'outbound' port (like a repository)?",
    "**Completeness and Detail:** Is the plan comprehensive, addressing all parts of the prompt with sufficient technical detail (e.g., method signatures, module dependencies)?"
  ]
}