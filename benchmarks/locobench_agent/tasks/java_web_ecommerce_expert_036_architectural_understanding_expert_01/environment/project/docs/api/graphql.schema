"""
SprintCart Pro GraphQL Schema (SDL)
===================================

The schema below describes the public GraphQL contract exposed by
SprintCart Pro.  It is written with extensibility and clarity in mind
and mirrors the platform’s Hexagonal Architecture: the schema merely
defines **ports** (use-cases) and **DTOs** (data structures) while the
actual business logic lives in application services.

Style guide:
‣ All types and fields are documented with descriptions so that tools
  like GraphQL Voyager and GraphiQL can surface helpful hints.
‣ Connections follow Relay-style pagination semantics.
‣ Mutations are side-effecting and therefore verb-prefixed.
‣ Custom scalars (e.g. Money, DateTime) are defined at the bottom.

Any breaking change MUST bump the `x-sprintcart-version` directive.
"""

directive @auth(
  """
  Minimum role required to access the target field.
  """
  requires: Role = MERCHANT
) on FIELD_DEFINITION | OBJECT

"""
Semantic version of the public contract.
"""
directive @sprintcartVersion(version: String!) on SCHEMA

schema
  @sprintcartVersion(version: "1.2.0")
{
  query: Query
  mutation: Mutation
  subscription: Subscription
}

# ---------------------------------------------------------------------
# ENUMS
# ---------------------------------------------------------------------

"""
Supported user roles inside SprintCart Pro.
"""
enum Role {
  ADMIN
  MERCHANT
  STAFF
  CUSTOMER
}

"""
All possible order lifecycle stages.
"""
enum OrderStatus {
  PENDING
  AWAITING_PAYMENT
  PAID
  IN_FULFILLMENT
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

# ---------------------------------------------------------------------
# SCALARS
# ---------------------------------------------------------------------

scalar DateTime   # ISO 8601 (e.g., 2023-10-31T15:04:05Z)
scalar Money      # String in major units, e.g. "24.99 USD"
scalar JSONObject # Arbitrary JSON blobs

# ---------------------------------------------------------------------
# COMMON REUSABLE TYPES
# ---------------------------------------------------------------------

"""
An RFC 3986 compliant URL.
"""
scalar URL

"""
Metadata for paginated result sets.
"""
type PageInfo {
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  startCursor: String
  endCursor: String
}

# ---------------------------------------------------------------------
# PRODUCT CATALOG
# ---------------------------------------------------------------------

"""
Primary sellable item inside SprintCart Pro.
"""
type Product {
  id: ID!
  sku: String!              # Merchant-provided identifier
  name: String!
  description: String
  price: Money!
  currency: String!         # ISO 4217 (e.g., "USD")
  stock: Int!               # Units on hand
  thumbnail: Image
  gallery: [Image!]!
  attributes: JSONObject    # Flexible key/val store
  tags: [String!]!
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
Image with responsive breakpoints.
"""
type Image {
  url: URL!
  alt: String
  width: Int
  height: Int
}

"""
Relay-style connection for Products.
"""
type ProductConnection {
  nodes: [Product!]!
  totalCount: Int!
  pageInfo: PageInfo!
}

"""
Filtering options when querying products.
"""
input ProductFilter {
  search: String
  tags: [String!]
  minPrice: Float
  maxPrice: Float
  inStockOnly: Boolean = false
}

# ---------------------------------------------------------------------
# CART & CHECKOUT
# ---------------------------------------------------------------------

"""
A single item inside a Cart.
"""
type CartItem {
  product: Product!
  quantity: Int!
  subtotal: Money!
}

"""
Shopping cart instance.
"""
type Cart {
  id: ID!
  items: [CartItem!]!
  total: Money!
  currency: String!
  createdAt: DateTime!
  updatedAt: DateTime!
}

# ---------------------------------------------------------------------
# ORDERS
# ---------------------------------------------------------------------

"""
Line item inside an Order.
"""
type OrderItem {
  product: Product!
  quantity: Int!
  unitPrice: Money!
  totalPrice: Money!
}

"""
Customer order.
"""
type Order {
  id: ID!
  number: String!         # Human-friendly identifier
  status: OrderStatus!
  items: [OrderItem!]!
  subtotal: Money!
  shippingFee: Money!
  tax: Money!
  total: Money!
  currency: String!
  placedAt: DateTime!
  fulfilledAt: DateTime
}

# ---------------------------------------------------------------------
# USERS & AUTH
# ---------------------------------------------------------------------

"""
Authenticated user entity.
"""
type User {
  id: ID!
  email: String!
  firstName: String
  lastName: String
  roles: [Role!]!
  createdAt: DateTime!
}

"""
Return type for auth mutations.
"""
type AuthPayload {
  user: User!
  accessToken: String!
  refreshToken: String
  expiresAt: DateTime!
}

# ---------------------------------------------------------------------
# QUERIES
# ---------------------------------------------------------------------

type Query {
  """
  Retrieve a single product by its ID.
  """
  product(id: ID!): Product

  """
  List products with optional filtering and pagination.
  """
  products(
    filter: ProductFilter
    first: Int = 20
    after: String
  ): ProductConnection!

  """
  Current authenticated user.
  """
  me: User @auth(requires: CUSTOMER)

  """
  Retrieve an active cart by ID.
  """
  cart(id: ID!): Cart @auth(requires: CUSTOMER)

  """
  Fetch an order by its ID.
  """
  order(id: ID!): Order @auth(requires: CUSTOMER)
}

# ---------------------------------------------------------------------
# MUTATIONS
# ---------------------------------------------------------------------

input ProductInput {
  sku: String!
  name: String!
  description: String
  price: Float!
  currency: String! = "USD"
  stock: Int! = 0
  tags: [String!]
  attributes: JSONObject
}

type Mutation {
  # -------------------------------
  # Auth
  # -------------------------------
  signIn(email: String!, password: String!): AuthPayload!
  refreshAccessToken(refreshToken: String!): AuthPayload!
  signOut: Boolean! @auth(requires: CUSTOMER)

  # -------------------------------
  # Cart
  # -------------------------------
  createCart: Cart @auth(requires: CUSTOMER)
  addToCart(cartId: ID!, productId: ID!, quantity: Int! = 1): Cart! @auth(requires: CUSTOMER)
  removeFromCart(cartId: ID!, productId: ID!): Cart! @auth(requires: CUSTOMER)
  updateCartItemQuantity(cartId: ID!, productId: ID!, quantity: Int!): Cart! @auth(requires: CUSTOMER)

  # -------------------------------
  # Checkout
  # -------------------------------
  checkout(cartId: ID!): Order! @auth(requires: CUSTOMER)

  # -------------------------------
  # Catalog maintenance (merchant)
  # -------------------------------
  createProduct(input: ProductInput!): Product! @auth(requires: MERCHANT)
  updateProduct(id: ID!, input: ProductInput!): Product! @auth(requires: MERCHANT)
  deleteProduct(id: ID!): Boolean! @auth(requires: MERCHANT)
}

# ---------------------------------------------------------------------
# SUBSCRIPTIONS
# ---------------------------------------------------------------------

"""
Payload emitted when product stock falls below merchant-defined threshold.
"""
type StockLowEvent {
  productId: ID!
  stock: Int!
  threshold: Int!
  triggeredAt: DateTime!
}

type Subscription {
  """
  Real-time inventory monitoring for ops staff.
  """
  stockLow(productId: ID!): StockLowEvent!
    @auth(requires: STAFF)
}

# ---------------------------------------------------------------------
# END OF FILE
# ---------------------------------------------------------------------