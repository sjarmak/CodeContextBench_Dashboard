@startuml
' ###########################################################################
' Component Diagram – SprintCart Pro – Hyper-Productive E-Commerce Workbench
' C4-Model Level 3: Components inside the “SprintCart Pro Backend” container
' ###########################################################################

!includeurl https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml
!includeurl https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

' --------------------------------------------------
' Styling
' --------------------------------------------------
LAYOUT_WITH_LEGEND()
SHOW_FLOATING_LEGEND()
AddElementTag("Inbound") {
    BackgroundColor #ECFBFF
    LineColor       #0069BF
    FontColor       #00345D
}
AddElementTag("Core") {
    BackgroundColor #FFF5E5
    LineColor       #D57B00
    FontColor       #663C00
}
AddElementTag("Outbound") {
    BackgroundColor #E8FFE5
    LineColor       #2B7A1E
    FontColor       #12470D
}
AddElementTag("Infrastructure") {
    BackgroundColor #F3F3F3
    LineColor       #666666
    FontColor       #333333
}

' --------------------------------------------------
' External Actors / Systems (needed for relationships)
' --------------------------------------------------
Person(merchant, "Merchant Operator", "Power user who manages catalog, orders, and productivity automations.")
Person(customer,  "Shopper",          "Purchases products via storefront.")
System_Ext(emailSvc,  "SendGrid",           "Cloud email delivery service")
System_Ext(paymentGW, "Stripe",            "Payment gateway")
System_Ext(erpSys,    "Acme ERP",          "3rd-party ERP")

' --------------------------------------------------
' Container being decomposed
' --------------------------------------------------
Container_Boundary(scBackend, "SprintCart Pro Backend", "Java 21 + Spring Boot 3") {

    ' ----------------------- Inbound Adapters -------------------------------
    Component(apiGateway,      "API Gateway", 
              "Spring MVC & GraphQL Controllers", 
              "Maps HTTP/GraphQL calls to application ports.", 
              $tags = "Inbound")
              
    Component(authMiddleware,  "AuthN/AuthZ Middleware",
              "Spring Security & JWT", 
              "Validates access tokens and injects user context.", 
              $tags = "Inbound,Infrastructure")

    Component(uploadAdapter,   "File Upload Adapter",
              "S3 SDK", 
              "Streams multipart uploads (e.g., product images) to S3-compatible object storage.", 
              $tags = "Inbound")

    ' ----------------------- Application Services --------------------------
    Component(catalogSvc,      "CatalogService", 
              "Application Service", 
              "Exposes use-cases for managing products & variants.", 
              $tags = "Core")

    Component(orderSvc,        "OrderService",   
              "Application Service", 
              "Handles checkout, payments, and fulfillment orchestration.", 
              $tags = "Core")

    Component(workQueueSvc,    "WorkQueueService",
              "Application Service",
              "Manages prioritized task queues that drive operator workflows.",
              $tags = "Core")

    Component(automationStudioSvc, "AutomationStudioService",
              "Application Service",
              "Allows users to chain trigger-action rules (e.g., stock < X ⇒ reorder).",
              $tags = "Core")

    Component(metricsSvc,      "ProductivityMetricsService",
              "Domain Service",
              "Aggregates KPIs and emits real-time nudges.", 
              $tags = "Core")

    ' ----------------------- Domain & Infrastructure -----------------------
    Component(domainModel, "Domain Model", 
              "Hexagonal Domain Layer", 
              "Pure business logic (Entities, Value Objects, Domain Events).", 
              $tags = "Core")

    Component(repositoryLayer, "Repository Layer", 
              "Spring Data JPA + Flyway", 
              "Persistence for domain aggregates.", 
              $tags = "Infrastructure")

    Component(eventBus, "Domain Event Bus",
              "Spring ApplicationEvents",
              "Publishes domain events to interested handlers.",
              $tags = "Infrastructure")

    ' ----------------------- Outbound Adapters -----------------------------
    Component(paymentAdapter,  "PaymentGatewayAdapter",
              "Stripe SDK", 
              "Processes credit-card and wallet payments.", 
              $tags = "Outbound")

    Component(emailAdapter,    "EmailNotificationAdapter",
              "SendGrid SDK", 
              "Sends transactional and automation emails.", 
              $tags = "Outbound")

    Component(erpAdapter,      "ERPAdapter",
              "REST/JSON Client", 
              "Syncs inventory & invoices with ERP.", 
              $tags = "Outbound")

}

' --------------------------------------------------
' Relationships — External Actors to Inbound Layer
' --------------------------------------------------
customer -> apiGateway : Browse & Checkout (HTTPS)
merchant -> apiGateway : Admin & Automation APIs (HTTPS)

' --------------------------------------------------
' Relationships — Inbound Layer
' --------------------------------------------------
apiGateway -> authMiddleware : Validate JWT / OAuth2
apiGateway -> catalogSvc     : Invoke catalog use-cases
apiGateway -> orderSvc       : Place orders / returns
apiGateway -> workQueueSvc   : CRUD work tasks
apiGateway -> automationStudioSvc : Configure automation chains
apiGateway -> metricsSvc     : Query productivity reports
uploadAdapter -> catalogSvc  : Notify product-image uploaded

' --------------------------------------------------
' Relationships — Application Services to Domain
' --------------------------------------------------
catalogSvc          -> domainModel : Manipulate product aggregates
orderSvc            -> domainModel : Create / update order aggregates
workQueueSvc        -> domainModel : Enqueue / dequeue WorkItems
automationStudioSvc -> domainModel : Persist automation rules
metricsSvc          -> domainModel : Read domain events

' --------------------------------------------------
' Relationships — Domain to Infrastructure
' --------------------------------------------------
domainModel  -> repositoryLayer : CRUD via repositories
domainModel  -> eventBus        : Publish DomainEvents
eventBus     -> metricsSvc      : KPI aggregations (subscribe)

' --------------------------------------------------
' Outbound integration
' --------------------------------------------------
orderSvc            -> paymentAdapter : Charge / refund
paymentAdapter      -> paymentGW      : REST + Webhooks

automationStudioSvc -> emailAdapter   : Send automated email
emailAdapter        -> emailSvc       : SMTP/API

repositoryLayer     -> erpAdapter     : Sync inventory
erpAdapter          -> erpSys         : REST

' --------------------------------------------------
' Notes
' --------------------------------------------------
SHOW_LEGEND()

@enduml