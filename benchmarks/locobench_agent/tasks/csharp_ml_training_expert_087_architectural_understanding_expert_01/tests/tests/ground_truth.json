{
  "ground_truth": "### 1. Analysis of Current State\nThe current system is a modular monolith. The `ServingController` handles prediction requests and publishes a `ModelPredictionQueriedEvent` to a RabbitMQ message bus. Within the same process, the `CanvasCraft.Monitoring` module runs as a background service, subscribed to this message bus. It uses an internal Observer pattern (`ModelServingSubject` notifying `DataDriftObserver` and `PerformanceFadeObserver`). When these observers detect an issue, they publish a new event (e.g., `RetrainingRequiredEvent`) back to RabbitMQ. The `AutomatedRetrainingTrigger` in the `CanvasCraft.Pipeline` module subscribes to this event to initiate a new training pipeline.\n\n### 2. Proposed Microservice Architecture\n\na. **Communication Strategy:** The communication will be fully asynchronous using the existing RabbitMQ message bus. This aligns with `ADR-002` and ensures loose coupling and independent scalability. The main application will be the producer of prediction events, and the new `MonitoringService` will be the consumer. The `MonitoringService` will, in turn, become a producer of `RetrainingRequiredEvent`s.\n\nb. **Data Flow:**\n   1. `CanvasCraft.Api` receives a prediction request and publishes `ModelPredictionQueriedEvent` to a RabbitMQ topic.\n   2. The new standalone `MonitoringService` is the sole subscriber to this topic.\n   3. The `MonitoringService` processes the event, updates its internal state, and runs its drift/fade detection logic.\n   4. If a significant event is detected, the `MonitoringService` publishes a `RetrainingRequiredEvent` to a different RabbitMQ topic.\n   5. The `AutomatedRetrainingTrigger` within the main application's `CanvasCraft.Pipeline` module subscribes to this `RetrainingRequiredEvent` topic and initiates the retraining pipeline.\n\n### 3. Implementation & Refactoring Plan\n\na. **Code Changes:**\n   - **`CanvasCraft.Api/Startup.cs`**: Remove dependency injection registration for all services from the `CanvasCraft.Monitoring` project.\n   - **`CanvasCraft.sln` & Project Files**: Remove the `CanvasCraft.Monitoring` project reference from the solution and any project that references it.\n   - **`CanvasCraft.Pipeline/Triggers/AutomatedRetrainingTrigger.cs`**: Ensure its message bus subscription logic is robust enough to handle events from an external service. No significant change is likely needed if it's already using `IMessageBus`.\n   - **`CanvasCraft.Api/Controllers/MonitoringController.cs`**: This controller, if used for querying monitoring status, must be refactored. Its GET endpoints should be moved to the new microservice. The main API could optionally act as a proxy to the new service's API for a unified front-end experience.\n\nb. **New Components:**\n   - A new C# solution and project for `MonitoringService` will be created, containing all the code from the original `CanvasCraft.Monitoring` project.\n   - It will have its own `Program.cs`/`Startup.cs` to register its services and configure the RabbitMQ listener.\n   - It will expose a minimal REST API for health checks and to allow manual querying of drift/performance status.\n\nc. **Deployment (`docker-compose.yml`):**\n   A new service definition must be added:\n   ```yaml\n   services:\n     # ... existing services (api, db, rabbitmq)\n     monitoring-service:\n       image: canvascraft-monitoring-service\n       build:\n         context: .\n         dockerfile: src/MonitoringService/Dockerfile # New Dockerfile for the service\n       depends_on:\n         - rabbitmq\n         - db\n       environment:\n         - RabbitMq__HostName=rabbitmq\n         - ConnectionStrings__DefaultConnection=...\n       networks:\n         - canvascraft-net\n   ```",
  "context_files": [
    "CanvasCraftMLStudio/src/CanvasCraft.Api/appsettings.json",
    "CanvasCraftMLStudio/src/CanvasCraft.Monitoring/Observers/IModelObserver.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Monitoring/Observers/DataDriftObserver.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Monitoring/Observers/PerformanceFadeObserver.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.WebApp/wwwroot/index.html",
    "CanvasCraftMLStudio/src/CanvasCraft.WebApp/wwwroot/css/app.css",
    "CanvasCraftMLStudio/src/CanvasCraft.Infrastructure/Services/BlobStorageService.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Infrastructure/Services/RabbitMqService.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Core/Interfaces/Services/IStorageService.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Core/Interfaces/Services/IMessageBus.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.WebApp/Services/ApiClient.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Infrastructure/Data/Repositories/ExperimentRepository.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.WebApp/Services/VisualizationService.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Infrastructure/Data/Migrations/_placeholder.txt",
    "CanvasCraftMLStudio/docs/architecture/adr/003-dotnet-stack-selection.md",
    "CanvasCraftMLStudio/docs/architecture/c4-model.md",
    "CanvasCraftMLStudio/src/CanvasCraft.Core/Interfaces/Repositories/IExperimentRepository.cs",
    "CanvasCraftMLStudio/docs/architecture/adr/002-event-driven-monitoring.md",
    "CanvasCraftMLStudio/docs/architecture/adr/001-modular-monolith-architecture.md",
    "CanvasCraftMLStudio/src/CanvasCraft.Infrastructure/Data/Repositories/ModelVersionRepository.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Core/Interfaces/Repositories/IRepository.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Infrastructure/Data/CanvasCraftDbContext.cs",
    "CanvasCraftMLStudio/docs/architecture/overview.md",
    "CanvasCraftMLStudio/src/CanvasCraft.Core/Interfaces/Repositories/IModelVersionRepository.cs",
    "src/utils.txt",
    "CanvasCraftMLStudio/src/CanvasCraft.Monitoring/Subjects/ModelServingSubject.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Pipeline/Factories/PipelineStepFactory.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Pipeline/Steps/Training/ModelTrainerStep.cs",
    "CanvasCraftMLStudio/CanvasCraft.sln",
    "CanvasCraftMLStudio/src/CanvasCraft.Pipeline/Factories/HyperparameterTunerFactory.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Pipeline/Steps/DataPreprocessing/NormalizationBrush.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Api/Controllers/ServingController.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Pipeline/Triggers/AutomatedRetrainingTrigger.cs",
    "CanvasCraftMLStudio/tests/CanvasCraft.Integration.Tests/PipelineExecutionTests.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Pipeline/Steps/HyperparameterTuning/IHyperparameterTuningStrategy.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Pipeline/Steps/FeatureEngineering/PcaPalette.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Api/Controllers/WorkspacesController.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Pipeline/Steps/HyperparameterTuning/GridSearchColorWheel.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Core/Models/Dataset.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Pipeline/Steps/DataPreprocessing/ScalingBrush.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Api/Controllers/PipelinesController.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.WebApp/Pages/Studio.razor",
    "CanvasCraftMLStudio/src/CanvasCraft.Core/Models/PipelineDefinition.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Core/Models/ModelVersion.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Api/Controllers/ExperimentsController.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Core/Models/Artifact.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Core/Models/FeatureDefinition.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Core/Models/Experiment.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Api/Controllers/ModelRegistryController.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Core/Models/Workspace.cs",
    "CanvasCraftMLStudio/docs/guides/user-guide.md",
    "CanvasCraftMLStudio/src/CanvasCraft.WebApp/Pages/Dashboard.razor",
    "CanvasCraftMLStudio/src/CanvasCraft.WebApp/Pages/FeatureExplorer.razor",
    "CanvasCraftMLStudio/src/CanvasCraft.Pipeline/Orchestrator/PipelineOrchestrator.cs",
    "CanvasCraftMLStudio/tests/CanvasCraft.Api.Tests/Controllers/PipelinesControllerTests.cs",
    "CanvasCraftMLStudio/docs/api/postman_collection.json",
    "CanvasCraftMLStudio/src/CanvasCraft.WebApp/Pages/ModelGallery.razor",
    "CanvasCraftMLStudio/docs/api/openapi.v1.json",
    "CanvasCraftMLStudio/src/CanvasCraft.Api/Controllers/MonitoringController.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Shared/Constants/ConfigurationKeys.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Pipeline/Steps/Evaluation/ModelEvaluatorStep.cs",
    "CanvasCraftMLStudio/docs/guides/developer-guide.md",
    "CanvasCraftMLStudio/src/CanvasCraft.Pipeline/Steps/HyperparameterTuning/RandomSearchColorWheel.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Shared/Dtos/FeatureValueDto.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Api/Controllers/FeatureStoreController.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Pipeline/Steps/IPipelineStep.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Api/Controllers/DatasetsController.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Api/Startup.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Shared/Utils/JsonSerializer.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Pipeline/Steps/FeatureEngineering/IFeatureEngineeringStrategy.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.WebApp/Shared/MainLayout.razor",
    "CanvasCraftMLStudio/tests/CanvasCraft.Integration.Tests/ModelServingTests.cs",
    "CanvasCraftMLStudio/tests/CanvasCraft.Pipeline.Tests/Factories/PipelineStepFactoryTests.cs",
    "CanvasCraftMLStudio/docker-compose.yml",
    "CanvasCraftMLStudio/src/CanvasCraft.Pipeline/Steps/FeatureEngineering/OneHotEncodingPalette.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Monitoring/Events/ModelPredictionQueriedEvent.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Api/DTOs/ModelVersionDto.cs",
    "CanvasCraftMLStudio/src/CanvasCraft.Pipeline/Steps/DataPreprocessing/IDataPreprocessingStrategy.cs",
    "CanvasCraftMLStudio/docs/README.md"
  ],
  "task_category": "architectural_understanding",
  "evaluation_criteria": [
    "Correctly identifies the existing architecture as a modular monolith with event-driven communication via RabbitMQ.",
    "Accurately describes the current data flow from API event publication to monitoring consumption and subsequent trigger activation.",
    "Proposes a viable, asynchronous communication pattern for the new microservice that leverages existing infrastructure (RabbitMQ).",
    "Clearly defines the responsibilities of both the main application and the new microservice in the proposed architecture.",
    "Correctly identifies the full-circle event path, including how monitoring results are communicated back to trigger retraining.",
    "Lists the key files/areas for modification, including `Startup.cs` (DI removal), project references, and `docker-compose.yml`.",
    "Demonstrates an understanding of microservice principles by creating a plan that promotes loose coupling and independent deployment."
  ]
}