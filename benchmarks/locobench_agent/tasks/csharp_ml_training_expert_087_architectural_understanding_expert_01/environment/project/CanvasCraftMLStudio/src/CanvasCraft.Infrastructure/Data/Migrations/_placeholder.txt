```csharp
// -----------------------------------------------------------------------------
// <auto-generated>
//     This file contains the initial Entity Framework Core migration for
//     the CanvasCraft ML Studio data layer.  It creates the foundational
//     schema that powers the Experiment Tracking subsystem, Feature Store,
//     Model Registry, and Observer/Event-driven monitoring.
// </auto-generated>
// -----------------------------------------------------------------------------

using System;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

namespace CanvasCraft.Infrastructure.Data.Migrations
{
    /// <summary>
    /// InitialCanvasCraftSchema sets up core tables and relationships that back the
    /// MLOps, Experiment-Tracking, Feature-Store, and Model-Registry domains.
    /// </summary>
    public partial class InitialCanvasCraftSchema : Migration
    {
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            // -----------------------------------------------------------------
            //  Experiments
            // -----------------------------------------------------------------
            migrationBuilder.CreateTable(
                name: "Experiments",
                columns: table => new
                {
                    Id              = table.Column<Guid>(nullable: false),
                    Name            = table.Column<string>(maxLength: 256, nullable: false),
                    Description     = table.Column<string>(maxLength: 2048, nullable: true),
                    StartedAt       = table.Column<DateTime>(nullable: false),
                    EndedAt         = table.Column<DateTime>(nullable: true),
                    Status          = table.Column<string>(maxLength: 64, nullable: false),
                    CreatedAt       = table.Column<DateTime>(nullable: false, defaultValueSql: "GETUTCDATE()"),
                    LastModifiedAt  = table.Column<DateTime>(nullable: false, defaultValueSql: "GETUTCDATE()")
                },
                constraints: table => table.PrimaryKey("PK_Experiments", x => x.Id));

            // -----------------------------------------------------------------
            //  Datasets (Feature-Store artefacts)
            // -----------------------------------------------------------------
            migrationBuilder.CreateTable(
                name: "Datasets",
                columns: table => new
                {
                    Id              = table.Column<Guid>(nullable: false),
                    ExperimentId    = table.Column<Guid>(nullable: false),
                    Name            = table.Column<string>(maxLength: 256, nullable: false),
                    Version         = table.Column<string>(maxLength: 64, nullable: false),
                    StorageLocation = table.Column<string>(maxLength: 2048, nullable: false),
                    Hash            = table.Column<string>(maxLength: 128, nullable: true),
                    CreatedAt       = table.Column<DateTime>(nullable: false, defaultValueSql: "GETUTCDATE()"),
                    LastModifiedAt  = table.Column<DateTime>(nullable: false, defaultValueSql: "GETUTCDATE()")
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Datasets", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Datasets_Experiments_ExperimentId",
                        column: x => x.ExperimentId,
                        principalTable: "Experiments",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateIndex(
                name: "IX_Datasets_ExperimentId",
                table: "Datasets",
                column: "ExperimentId");

            // -----------------------------------------------------------------
            //  Features (Feature Store atoms)
            // -----------------------------------------------------------------
            migrationBuilder.CreateTable(
                name: "Features",
                columns: table => new
                {
                    Id              = table.Column<Guid>(nullable: false),
                    DatasetId       = table.Column<Guid>(nullable: false),
                    Name            = table.Column<string>(maxLength: 256, nullable: false),
                    DataType        = table.Column<string>(maxLength: 128, nullable: false),
                    Description     = table.Column<string>(maxLength: 1024, nullable: true),
                    ImportanceScore = table.Column<double>(nullable: true),
                    CreatedAt       = table.Column<DateTime>(nullable: false, defaultValueSql: "GETUTCDATE()")
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Features", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Features_Datasets_DatasetId",
                        column: x => x.DatasetId,
                        principalTable: "Datasets",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateIndex(
                name: "IX_Features_DatasetId",
                table: "Features",
                column: "DatasetId");

            // -----------------------------------------------------------------
            //  Models (Model Registry entries)
            // -----------------------------------------------------------------
            migrationBuilder.CreateTable(
                name: "Models",
                columns: table => new
                {
                    Id                  = table.Column<Guid>(nullable: false),
                    ExperimentId        = table.Column<Guid>(nullable: false),
                    Name                = table.Column<string>(maxLength: 256, nullable: false),
                    Version             = table.Column<string>(maxLength: 64, nullable: false),
                    ArtifactLocation    = table.Column<string>(maxLength: 2048, nullable: false),
                    TrainingStartedAt   = table.Column<DateTime>(nullable: false),
                    TrainingCompletedAt = table.Column<DateTime>(nullable: true),
                    Status              = table.Column<string>(maxLength: 64, nullable: false),
                    CreatedAt           = table.Column<DateTime>(nullable: false, defaultValueSql: "GETUTCDATE()"),
                    LastModifiedAt      = table.Column<DateTime>(nullable: false, defaultValueSql: "GETUTCDATE()")
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Models", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Models_Experiments_ExperimentId",
                        column: x => x.ExperimentId,
                        principalTable: "Experiments",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateIndex(
                name: "IX_Models_ExperimentId",
                table: "Models",
                column: "ExperimentId");

            // -----------------------------------------------------------------
            //  Metrics (Key/Value time-series per Model)
            // -----------------------------------------------------------------
            migrationBuilder.CreateTable(
                name: "Metrics",
                columns: table => new
                {
                    Id         = table.Column<Guid>(nullable: false),
                    ModelId    = table.Column<Guid>(nullable: false),
                    Name       = table.Column<string>(maxLength: 256, nullable: false),
                    Value      = table.Column<double>(nullable: false),
                    Timestamp  = table.Column<DateTime>(nullable: false, defaultValueSql: "GETUTCDATE()"),
                    CreatedAt  = table.Column<DateTime>(nullable: false, defaultValueSql: "GETUTCDATE()")
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Metrics", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Metrics_Models_ModelId",
                        column: x => x.ModelId,
                        principalTable: "Models",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateIndex(
                name: "IX_Metrics_ModelId",
                table: "Metrics",
                column: "ModelId");

            // -----------------------------------------------------------------
            //  ModelEvents (Observer Pattern hooks)
            // -----------------------------------------------------------------
            migrationBuilder.CreateTable(
                name: "ModelEvents",
                columns: table => new
                {
                    Id         = table.Column<Guid>(nullable: false),
                    ModelId    = table.Column<Guid>(nullable: false),
                    EventType  = table.Column<string>(maxLength: 128, nullable: false),
                    Payload    = table.Column<string>(type: "jsonb", nullable: true),
                    OccurredAt = table.Column<DateTime>(nullable: false, defaultValueSql: "GETUTCDATE()")
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_ModelEvents", x => x.Id);
                    table.ForeignKey(
                        name: "FK_ModelEvents_Models_ModelId",
                        column: x => x.ModelId,
                        principalTable: "Models",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateIndex(
                name: "IX_ModelEvents_ModelId",
                table: "ModelEvents",
                column: "ModelId");

            // -----------------------------------------------------------------
            //  [Optional] SQL Helpers for auto-updating LastModifiedAt fields
            //  NOTE: Guarded by TRY / CATCH for cross-provider safety.
            // -----------------------------------------------------------------
            try
            {
                migrationBuilder.Sql(@"
IF OBJECT_ID('dbo.trg_SetLastModifiedAt', 'TR') IS NULL
BEGIN
    EXEC('
        CREATE TRIGGER dbo.trg_SetLastModifiedAt
        ON dbo.Experiments, dbo.Datasets, dbo.Models
        AFTER UPDATE
        AS
        BEGIN
            SET NOCOUNT ON;
            UPDATE t SET LastModifiedAt = GETUTCDATE()
            FROM inserted i
            JOIN deleted d ON i.Id = d.Id
            JOIN (
                    SELECT Id, LastModifiedAt FROM dbo.Experiments
                    UNION ALL
                    SELECT Id, LastModifiedAt FROM dbo.Datasets
                    UNION ALL
                    SELECT Id, LastModifiedAt FROM dbo.Models
                  ) t ON t.Id = i.Id;
        END');
END");
            }
            catch
            {
                // Swallow exceptions so that migrations remain provider-agnostic
                // (e.g. SQLite, PostgreSQL). Providers that don't support triggers
                // simply won't execute the SQL above.
            }
        }

        protected override void Down(MigrationBuilder migrationBuilder)
        {
            // Drop tables in reverse order of creation to satisfy FK constraints.
            migrationBuilder.DropTable(name: "ModelEvents");
            migrationBuilder.DropTable(name: "Metrics");
            migrationBuilder.DropTable(name: "Features");
            migrationBuilder.DropTable(name: "Models");
            migrationBuilder.DropTable(name: "Datasets");
            migrationBuilder.DropTable(name: "Experiments");
        }
    }
}
```