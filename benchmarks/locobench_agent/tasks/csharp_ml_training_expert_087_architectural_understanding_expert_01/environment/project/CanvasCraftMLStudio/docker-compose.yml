```yaml
# ------------------------------------------------------------------------
# CanvasCraft ML Studio : docker-compose.yml
#
# Production-grade orchestration for the complete CanvasCraft ML Studio
# stack, including:
#   • ASP.NET Core MVC web portal
#   • REST / gRPC API gateway
#   • GPU-enabled model training worker
#   • MLOps backing services (PostgreSQL, Redis, RabbitMQ, MinIO)
#   • Observability (Prometheus & Grafana)
#
# Prerequisites:
#   • Docker 20.10+
#   • docker-compose v2.5+
#   • (Optional) NVIDIA Container Toolkit for GPU scheduling
#
# Usage:
#   # Build containers & start detached
#   docker compose up -d --build
#
#   # Tear down
#   docker compose down -v
# ------------------------------------------------------------------------

version: "3.8"

# ------------------------------------------------------------------------
# NETWORKS
# ------------------------------------------------------------------------
networks:
  ml_net:
    driver: bridge

# ------------------------------------------------------------------------
# VOLUMES
# ------------------------------------------------------------------------
volumes:
  pg_data:          {}   # PostgreSQL durable storage
  redis_data:       {}   # Redis persistence (AOF)
  rabbitmq_data:    {}   # RabbitMQ persisted queues
  minio_data:       {}   # MinIO object store
  model_registry:   {}   # Versioned model artifacts
  shared_storage:   {}   # Cross-service shared workspace

# ------------------------------------------------------------------------
# SERVICES
# ------------------------------------------------------------------------
services:

  # --------------------------------------------------
  # Web: ASP.NET Core MVC front-end
  # --------------------------------------------------
  web:
    build:
      context: ./src/CanvasCraftMLStudio.Web
      dockerfile: Dockerfile
    container_name: canvascraft-web
    environment:
      ASPNETCORE_ENVIRONMENT: "Production"
      CONNECTIONSTRINGS__DefaultConnection: "Host=postgres;Port=5432;Database=canvascraft;Username=canvas;Password=secret"
      REDIS__HOST: "redis"
      MESSAGE_BROKER__HOST: "rabbitmq"
      MINIO__ENDPOINT: "http://minio:9000"
      MINIO__ACCESS_KEY: "admin"
      MINIO__SECRET_KEY: "password"
      FEATURE_STORE__BUCKET: "feature-store"
      MODEL_REGISTRY__BUCKET: "model-registry"
    depends_on:
      - postgres
      - redis
      - rabbitmq
      - minio
    ports:
      - "8080:80"
    networks:
      - ml_net
    restart: unless-stopped

  # --------------------------------------------------
  # API Gateway: REST / gRPC façade for automation
  # --------------------------------------------------
  api:
    build:
      context: ./src/CanvasCraftMLStudio.Api
      dockerfile: Dockerfile
    container_name: canvascraft-api
    environment:
      ASPNETCORE_ENVIRONMENT: "Production"
      CONNECTIONSTRINGS__DefaultConnection: "Host=postgres;Port=5432;Database=canvascraft;Username=canvas;Password=secret"
      REDIS__HOST: "redis"
      MESSAGE_BROKER__HOST: "rabbitmq"
      MINIO__ENDPOINT: "http://minio:9000"
      MINIO__ACCESS_KEY: "admin"
      MINIO__SECRET_KEY: "password"
    depends_on:
      - postgres
      - redis
      - rabbitmq
      - minio
    ports:
      - "5000:80"
    networks:
      - ml_net
    restart: unless-stopped

  # --------------------------------------------------
  # Trainer: GPU-enabled background worker
  # --------------------------------------------------
  trainer:
    build:
      context: ./src/CanvasCraftMLStudio.Trainer
      dockerfile: Dockerfile
    container_name: canvascraft-trainer
    environment:
      ASPNETCORE_ENVIRONMENT: "Production"
      CONNECTIONSTRINGS__DefaultConnection: "Host=postgres;Port=5432;Database=canvascraft;Username=canvas;Password=secret"
      MESSAGE_BROKER__HOST: "rabbitmq"
      MINIO__ENDPOINT: "http://minio:9000"
      MINIO__ACCESS_KEY: "admin"
      MINIO__SECRET_KEY: "password"
      TRAINER__GPU_ENABLED: "true"
      CUDA_VISIBLE_DEVICES: "all"
    depends_on:
      - rabbitmq
      - minio
      - postgres
    volumes:
      - shared_storage:/workspace
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [ gpu ]
    runtime: nvidia   # Requires NVIDIA Container Runtime (ignored if unavailable)
    networks:
      - ml_net
    restart: unless-stopped

  # --------------------------------------------------
  # PostgreSQL: Experiment Tracking & Feature Store
  # --------------------------------------------------
  postgres:
    image: postgres:14-alpine
    container_name: canvascraft-postgres
    restart: unless-stopped
    environment:
      POSTGRES_DB: "canvascraft"
      POSTGRES_USER: "canvas"
      POSTGRES_PASSWORD: "secret"
    volumes:
      - pg_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    networks:
      - ml_net
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U canvas -d canvascraft"]
      interval: 10s
      timeout: 5s
      retries: 5

  # --------------------------------------------------
  # Redis: Low-latency cache & pub/sub bus
  # --------------------------------------------------
  redis:
    image: redis:7-alpine
    container_name: canvascraft-redis
    restart: unless-stopped
    command: ["redis-server", "--appendonly", "yes"]
    volumes:
      - redis_data:/data
    ports:
      - "6379:6379"
    networks:
      - ml_net

  # --------------------------------------------------
  # RabbitMQ: Asynchronous orchestration
  # --------------------------------------------------
  rabbitmq:
    image: rabbitmq:3.11-management
    container_name: canvascraft-rabbitmq
    restart: unless-stopped
    environment:
      RABBITMQ_DEFAULT_USER: "canvas"
      RABBITMQ_DEFAULT_PASS: "secret"
    volumes:
      - rabbitmq_data:/var/lib/rabbitmq
    ports:
      - "5672:5672"     # AMQP
      - "15672:15672"   # Management UI
    networks:
      - ml_net
    healthcheck:
      test: ["CMD-SHELL", "rabbitmq-diagnostics -q ping"]
      interval: 30s
      timeout: 10s
      retries: 5

  # --------------------------------------------------
  # MinIO: Object storage for feature/data/model artifacts
  # --------------------------------------------------
  minio:
    image: quay.io/minio/minio:RELEASE.2023-02-22T18-23-45Z
    container_name: canvascraft-minio
    command: server /data --console-address ":9001"
    environment:
      MINIO_ROOT_USER: "admin"
      MINIO_ROOT_PASSWORD: "password"
    volumes:
      - minio_data:/data
    ports:
      - "9000:9000"  # S3
      - "9001:9001"  # Console
    networks:
      - ml_net
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 20s
      retries: 3

  # --------------------------------------------------
  # Prometheus: Metrics collection
  # --------------------------------------------------
  prometheus:
    image: prom/prometheus:latest
    container_name: canvascraft-prometheus
    volumes:
      - ./infrastructure/prometheus.yml:/etc/prometheus/prometheus.yml:ro
    ports:
      - "9090:9090"
    networks:
      - ml_net
    restart: unless-stopped

  # --------------------------------------------------
  # Grafana: Metrics dashboard
  # --------------------------------------------------
  grafana:
    image: grafana/grafana:9.5.2
    container_name: canvascraft-grafana
    environment:
      GF_SECURITY_ADMIN_USER: "admin"
      GF_SECURITY_ADMIN_PASSWORD: "secret"
    ports:
      - "3000:3000"
    depends_on:
      - prometheus
    networks:
      - ml_net
    restart: unless-stopped
```