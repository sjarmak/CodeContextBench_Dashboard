```razor
@page "/feature-explorer"
@attribute [Authorize] <!-- Require authenticated users -->

@using System.Reactive.Linq
@using CanvasCraft.Core.FeatureStore
@using CanvasCraft.WebApp.Services
@using MudBlazor

@inject IFeatureStoreClient FeatureStoreClient
@inject ISnackbar Snackbar
@inject ILogger<FeatureExplorer> Logger
@inject IDialogService DialogService

<!--
    FeatureExplorer.razor
    An interactive page that lets creators browse, filter, and inspect
    engineered features stored in the CanvasCraft Feature Store.  The page
    demonstrates reactive updates (Observer pattern) by listening to the
    feature-store event stream, refreshing the UI whenever a feature is
    added, updated, or removed.
-->

<MudPaper Elevation="0" Class="pa-4">

    <!-- PAGE HEADER -->
    <MudStack Row="true" AlignItems="center" Spacing="2">
        <MudText Typo="Typo.h4" Class="font-weight-bold">Feature Explorer</MudText>

        <MudTooltip Text="Refresh">
            <MudIconButton Icon="@Icons.Material.Filled.Refresh"
                           Color="Color.Primary"
                           Disabled="@_isBusy"
                           OnClick="RefreshAsync" />
        </MudTooltip>

        @if (_isBusy)
        {
            <MudProgressCircular Color="Color.Primary" Size="Size.Small" Indeterminate />
        }
    </MudStack>

    <MudDivider Class="my-3" />

    <MudGrid GutterSize="GutterSize.Small">
        <!-- FILTER PANE --------------------------------------------------- -->
        <MudItem xs="12" sm="4" lg="3">
            <MudCard Class="pa-4">
                <MudCardHeader>
                    <MudText Typo="Typo.subtitle1" Class="font-weight-semibold">
                        Filters
                    </MudText>
                </MudCardHeader>

                <MudCardContent>
                    <!-- Dataset selector -->
                    <MudSelect Label="Dataset"
                               Dense
                               T="string"
                               Clearable
                               @bind-Value="_selectedDataset">
                        @foreach (var ds in _datasets)
                        {
                            <MudSelectItem Value="@ds">@ds</MudSelectItem>
                        }
                    </MudSelect>

                    <!-- Text search -->
                    <MudTextField @bind-Value="_searchTerm"
                                  Placeholder="Search by name / description"
                                  Adornment="Adornment.Start"
                                  Dense
                                  Immediate="true"
                                  OnBlur="ApplyFilters"
                                  AdornmentIcon="@Icons.Material.Filled.Search"
                                  Class="mt-3" />

                    <!-- Tag chips -->
                    <MudText Typo="Typo.caption" Class="mt-4 mb-1">Tags</MudText>
                    <MudChipSet MultiSelection="true"
                                @bind-SelectedChips="_selectedTags"
                                SelectionChanged="ApplyFilters">
                        @foreach (var tag in _availableTags)
                        {
                            <MudChip Color="Color.Info"
                                     Variant="Variant.Outlined"
                                     Text="@tag" />
                        }
                    </MudChipSet>

                    <MudButton Variant="Variant.Filled"
                               Color="Color.Primary"
                               Class="mt-4"
                               StartIcon="@Icons.Material.Filled.FilterAlt"
                               OnClick="ApplyFilters">
                        Apply
                    </MudButton>
                </MudCardContent>
            </MudCard>
        </MudItem>

        <!-- FEATURE TABLE -------------------------------------------------- -->
        <MudItem xs="12" sm="8" lg="9">
            <MudTable Hover="true"
                      Dense="true"
                      Items="_filteredFeatures"
                      SortLabel="Sort"
                      Filter="TableFilter"
                      OnRowClick="@(row => ShowMetricsAsync(row.Item))">
                <HeaderContent>
                    <MudTh>NAME</MudTh>
                    <MudTh>DATASET</MudTh>
                    <MudTh>TYPE</MudTh>
                    <MudTh>TAGS</MudTh>
                    <MudTh Align="Right">ACTIONS</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Name">@context.Name</MudTd>
                    <MudTd DataLabel="Dataset">@context.Dataset</MudTd>
                    <MudTd DataLabel="Type">@context.DataType</MudTd>
                    <MudTd DataLabel="Tags">
                        <MudChipSet ReadOnly="true" Dense="true">
                            @foreach (var t in context.Tags.Take(3))
                            {
                                <MudChip Color="Color.Secondary" Size="Size.Small" Variant="Variant.Outlined" Text="@t" />
                            }
                            @if (context.Tags.Count > 3)
                            {
                                <MudChip Color="Color.Secondary" Size="Size.Small" Variant="Variant.Outlined" Text="+@((context.Tags.Count-3))" />
                            }
                        </MudChipSet>
                    </MudTd>
                    <MudTd Align="Right">
                        <MudTooltip Text="View metrics">
                            <MudIconButton Icon="@Icons.Material.Filled.Insights"
                                           Color="Color.Info"
                                           OnClick="@((_) => ShowMetricsAsync(context))" />
                        </MudTooltip>
                    </MudTd>
                </RowTemplate>
                <PagerContent>
                    <MudTablePager />
                </PagerContent>
            </MudTable>
        </MudItem>
    </MudGrid>
</MudPaper>

@code : IDisposable
{
    /* ============================== STATE ============================== */
    private List<FeatureSummary> _allFeatures = new();
    private List<FeatureSummary> _filteredFeatures = new();

    private IEnumerable<string> _datasets = Enumerable.Empty<string>();
    private IEnumerable<string> _availableTags = Enumerable.Empty<string>();

    private string? _selectedDataset;
    private string _searchTerm = string.Empty;
    private HashSet<string> _selectedTags = new();

    private bool _isBusy;

    /* ============================== LIFECYCLE ========================== */
    protected override async Task OnInitializedAsync()
    {
        // Initial UI population
        await SafeInvokeAsync(async () =>
        {
            await RefreshDatasetsAsync();
            await LoadFeaturesAsync();
        });

        // Subscribe to the Feature-Store event stream (Observer pattern)
        _featureSubscription = FeatureStoreClient
            .FeatureStream                     // IObservable<FeatureEvent>
            .Where(e => e is FeatureChangedEvent) // respond only to relevant events
            .Throttle(TimeSpan.FromSeconds(1)) // avoid excessive refresh
            .Subscribe(async _ => await SafeInvokeAsync(LoadFeaturesAsync));
    }

    /* ============================== COMMANDS =========================== */
    private async Task RefreshAsync()
    {
        await SafeInvokeAsync(async () =>
        {
            await RefreshDatasetsAsync();
            await LoadFeaturesAsync();
            Snackbar.Add("Feature list refreshed.", Severity.Success);
        });
    }

    private async Task RefreshDatasetsAsync()
    {
        _datasets = await FeatureStoreClient
            .GetDatasetsAsync()
            .ConfigureAwait(false);
    }

    private async Task LoadFeaturesAsync()
    {
        _allFeatures = (await FeatureStoreClient
                .GetFeatureSummariesAsync()
                .ConfigureAwait(false))
            .OrderBy(f => f.Name)
            .ToList();

        // Flatten tag universe
        _availableTags = _allFeatures
                         .SelectMany(f => f.Tags)
                         .Distinct()
                         .OrderBy(t => t, StringComparer.OrdinalIgnoreCase);

        ApplyFilters();
    }

    /* -------------------- Filtering Logic ----------------------------- */
    private void ApplyFilters()
    {
        IEnumerable<FeatureSummary> query = _allFeatures;

        if (!string.IsNullOrWhiteSpace(_selectedDataset))
        {
            query = query.Where(f => f.Dataset.Equals(_selectedDataset, StringComparison.OrdinalIgnoreCase));
        }

        if (_selectedTags.Any())
        {
            query = query.Where(f => _selectedTags.IsSubsetOf(f.Tags));
        }

        if (!string.IsNullOrWhiteSpace(_searchTerm))
        {
            query = query.Where(f =>
                f.Name.Contains(_searchTerm, StringComparison.OrdinalIgnoreCase) ||
                f.Description.Contains(_searchTerm, StringComparison.OrdinalIgnoreCase));
        }

        _filteredFeatures = query.ToList();
    }

    /* -------------------- Table callback ------------------------------ */
    private bool TableFilter(FeatureSummary feature, string searchString)
        => true; // Filtering handled manually above (ApplyFilters).

    /* ============================== METRICS DIALOG ==================== */
    private async Task ShowMetricsAsync(FeatureSummary feature)
    {
        try
        {
            var metrics = await FeatureStoreClient
                .GetFeatureMetricsAsync(feature.Id)
                .ConfigureAwait(false);

            var parameters = new DialogParameters<FeatureMetricsDialog>
            {
                { p => p.Feature, feature },
                { p => p.Metrics, metrics }
            };

            DialogService.Show<FeatureMetricsDialog>($"{feature.Name} â€“ Metrics", parameters);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Failed to load feature metrics for {FeatureId}.", feature.Id);
            Snackbar.Add(" Failed to load metrics. See logs for details.", Severity.Error);
        }
    }

    /* ============================== HELPERS =========================== */
    private async Task SafeInvokeAsync(Func<Task> asyncFunc)
    {
        try
        {
            _isBusy = true;
            await asyncFunc.Invoke();
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Unhandled error in FeatureExplorer.");
            Snackbar.Add("An error occurred while processing your request.", Severity.Error);
        }
        finally
        {
            _isBusy = false;
            StateHasChanged();
        }
    }

    /* ============================== DISPOSAL ========================== */
    private IDisposable? _featureSubscription;

    public void Dispose()
    {
        _featureSubscription?.Dispose();
    }
}

/* ====================================================================== */
/*  DOMAIN MODELS (simplified)                                            */
/* ====================================================================== */

/// <summary>
/// A summary of an engineered feature stored in the Feature Store.
/// </summary>
/// <param name="Id">Immutable identifier.</param>
/// <param name="Name">Human-friendly name.</param>
/// <param name="Dataset">Originating dataset name.</param>
/// <param name="DataType">Data type (numeric, categorical, image, etc.).</param>
/// <param name="Description">Free-form description.</param>
/// <param name="Tags">Arbitrary tags for discovery.</param>
public record FeatureSummary(
    string Id,
    string Name,
    string Dataset,
    string DataType,
    string Description,
    IReadOnlyCollection<string> Tags);
```