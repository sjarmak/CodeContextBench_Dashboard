{
  "$schema": "https://json.schemastore.org/appsettings.json",

  /* ---------------------------------------------------------------------------
     PaletteStream.Quality — Central configuration file
     ---------------------------------------------------------------------------
     This file configures the Data-Quality micro-service responsible for
     validating, profiling, and certifying data “pigments” before they flow
     onward in the ETL pipeline. Settings are overridden by
     `appsettings.{Environment}.json` and/or environment variables.
  --------------------------------------------------------------------------- */

  "Service": {
    "Name": "PaletteStream.Quality",
    "Version": "1.0.0",
    "Environment": "${ASPNETCORE_ENVIRONMENT}"
  },

  /* ---------------------------------------------------------------------------
     Logging & Tracing
  --------------------------------------------------------------------------- */
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft": "Warning",
      "Microsoft.Hosting.Lifetime": "Information",
      "PaletteStream": "Debug"
    },
    "Seq": {
      "ServerUrl": "http://seq:5341",
      "ApiKey": "${SEQ_API_KEY:#{null}}"
    }
  },

  "OpenTelemetry": {
    "Exporter": {
      "Otlp": {
        "Endpoint": "http://otel-collector:4317"
      }
    },
    "Tracing": {
      "Enabled": true,
      "SampleRate": 1.0
    }
  },

  /* ---------------------------------------------------------------------------
     Connection Strings
  --------------------------------------------------------------------------- */
  "ConnectionStrings": {
    "DataLake": "Host=${DATALAKE_HOST};Port=5432;Database=palette_stream;Username=${DATALAKE_USER};Password=${DATALAKE_PASS}",
    "Hangfire": "Server=${SQL_HOST};Database=hangfire;User Id=${SQL_USER};Password=${SQL_PASS};",
    "Redis": "redis:6379,password=${REDIS_PASS}"
  },

  /* ---------------------------------------------------------------------------
     Kafka & Event Streaming
  --------------------------------------------------------------------------- */
  "Kafka": {
    "BootstrapServers": "${KAFKA_BOOTSTRAP_SERVERS:kafka:9092}",
    "SchemaRegistryUrl": "${SCHEMA_REGISTRY:http://schema-registry:8081}",
    "SecurityProtocol": "Plaintext",
    "GroupId": "palette-stream-quality",
    "Topics": {
      "RawPigments": "etl.raw.pigments",
      "DeadLetter": "etl.quality.dlq",
      "Success": "etl.quality.validated"
    },
    "ConsumerConfig": {
      "AutoOffsetReset": "Earliest",
      "EnableAutoCommit": false,
      "SessionTimeoutMs": 30000
    }
  },

  /* ---------------------------------------------------------------------------
     Data-Quality Rules & Thresholds
     -------------------------------------------------------------------------
     IDs are matched to rule strategy classes via DI (Strategy Pattern)
  --------------------------------------------------------------------------- */
  "QualityEngine": {
    "DefaultFailAction": "DeadLetter",
    "Rules": [
      {
        "Id": "SchemaConformance",
        "Enabled": true,
        "Severity": "Error",
        "Config": {
          "AllowAdditionalFields": false
        }
      },
      {
        "Id": "NullCheck",
        "Enabled": true,
        "Severity": "Warn",
        "Config": {
          "NullThresholdPercent": 5
        }
      },
      {
        "Id": "RangeValidation",
        "Enabled": true,
        "Severity": "Error",
        "Config": {
          "Fields": [
            { "Name": "amount", "Min": 0, "Max": 1000000 },
            { "Name": "rating", "Min": 1, "Max": 5 }
          ]
        }
      },
      {
        "Id": "ReferenceIntegrity",
        "Enabled": true,
        "Severity": "Error",
        "Config": {
          "LookupDataset": "curated.dim_product"
        }
      }
    ]
  },

  /* ---------------------------------------------------------------------------
     Dead-Letter & Error Recovery
  --------------------------------------------------------------------------- */
  "DeadLetterPolicy": {
    "MaxRetryCount": 3,
    "BackoffSeconds": 30,
    "CompensatingAction": "RollbackIngest"
  },

  /* ---------------------------------------------------------------------------
     Metrics & Health Probes
  --------------------------------------------------------------------------- */
  "Metrics": {
    "Prometheus": {
      "Endpoint": "/metrics",
      "Enabled": true
    },
    "QualityDashboard": {
      "Url": "http://blazor-gallery/quality",
      "ApiKey": "${DASHBOARD_API_KEY:#{null}}"
    }
  },

  /* ---------------------------------------------------------------------------
     Feature Flags
  --------------------------------------------------------------------------- */
  "Features": {
    "EnableGpuProfiling": false,
    "EnableStreamingProfiling": true
  }
}