<?xml version="1.0" encoding="utf-8"?>
<Project Sdk="Microsoft.NET.Sdk.Web">

  <!--
    PaletteStream.Loader
    ====================
    Loader micro-service responsible for ingesting raw “pigments” (data) from
    external sources and placing them on the Data Lake “canvas”.  The service
    supports both batch and streaming workloads and exposes health-check and
    metrics endpoints for the Studio UI.
  -->
  
  <PropertyGroup>
    <!-- Target .NET 8 for latest features and performance improvements -->
    <TargetFramework>net8.0</TargetFramework>
    
    <!-- Modern C# settings -->
    <Nullable>enable</Nullable>
    <ImplicitUsings>enable</ImplicitUsings>
    <LangVersion>latest</LangVersion>

    <!-- Build quality gates -->
    <TreatWarningsAsErrors>true</TreatWarningsAsErrors>
    <AnalysisMode>AllEnabledByDefault</AnalysisMode>
    <GenerateDocumentationFile>true</GenerateDocumentationFile>
    
    <!-- Publish optimisations -->
    <PublishReadyToRun>true</PublishReadyToRun>
    <PublishTrimmed>false</PublishTrimmed>
    <Deterministic>true</Deterministic>
  </PropertyGroup>

  <!-- Core runtime libraries -->
  <ItemGroup>
    <!-- Logging / Observability -->
    <PackageReference Include="Serilog.AspNetCore" Version="7.0.0" />
    <PackageReference Include="Serilog.Sinks.Console" Version="5.0.1" />
    <PackageReference Include="OpenTelemetry.Extensions.Hosting" Version="1.7.0" />
    <PackageReference Include="OpenTelemetry.Exporter.OpenTelemetryProtocol" Version="1.7.0" />
    
    <!-- Streaming & Messaging -->
    <PackageReference Include="Confluent.Kafka" Version="2.3.0" />
    <PackageReference Include="KafkaFlow" Version="5.1.1" />
    
    <!-- Batch processing / Scheduling -->
    <PackageReference Include="Hangfire.Core" Version="1.7.36" />
    <PackageReference Include="Hangfire.SqlServer" Version="1.7.36" />
    
    <!-- Data processing & GPU acceleration -->
    <PackageReference Include="Apache.Arrow" Version="14.0.1" />
    <PackageReference Include="ComputeSharp" Version="2.2.0" />
    
    <!-- Data Lake storage -->
    <PackageReference Include="Azure.Storage.Blobs" Version="12.18.0" />
    
    <!-- Health checks & Validation -->
    <PackageReference Include="AspNetCore.HealthChecks.System" Version="6.0.1" />
    <PackageReference Include="FluentValidation" Version="11.8.0" />
  </ItemGroup>

  <!-- Code-quality tooling -->
  <ItemGroup>
    <PackageReference Include="Microsoft.CodeAnalysis.NetAnalyzers" Version="8.0.0" PrivateAssets="all" />
    <PackageReference Include="StyleCop.Analyzers" Version="1.2.0-beta.483" PrivateAssets="all" />
  </ItemGroup>

  <!-- Test dependencies -->
  <ItemGroup>
    <PackageReference Include="xunit" Version="2.5.0" />
    <PackageReference Include="xunit.runner.visualstudio" Version="2.5.0" />
    <PackageReference Include="coverlet.collector" Version="6.0.2" />
  </ItemGroup>

  <!-- Internal project references -->
  <ItemGroup>
    <ProjectReference Include="..\..\Shared\PaletteStream.Shared\PaletteStream.Shared.csproj" />
  </ItemGroup>

  <!-- Configuration-specific constants -->
  <PropertyGroup Condition="'$(Configuration)' == 'Debug'">
    <DefineConstants>DEBUG;TRACE</DefineConstants>
  </PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)' == 'Release'">
    <DefineConstants>TRACE</DefineConstants>
    <Optimize>true</Optimize>
  </PropertyGroup>

  <!-- Copy configuration files to output -->
  <ItemGroup>
    <Content Include="appsettings.json" CopyToOutputDirectory="Always" />
    <Content Include="appsettings.Development.json" CopyToOutputDirectory="Always" Condition="'$(Configuration)'=='Debug'" />
  </ItemGroup>

  <!-- Pre/Post build hooks for additional validation or packaging -->
  <Target Name="PreBuild" BeforeTargets="Build">
    <Message Importance="high" Text="PaletteStream.Loader ➜ Running pre-build tasks…" />
  </Target>

  <Target Name="PostBuild" AfterTargets="Build">
    <Message Importance="high" Text="PaletteStream.Loader ➜ Build completed successfully." />
  </Target>

</Project>