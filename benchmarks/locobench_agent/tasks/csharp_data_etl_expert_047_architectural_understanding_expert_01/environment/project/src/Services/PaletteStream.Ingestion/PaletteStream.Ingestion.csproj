```xml
<Project Sdk="Microsoft.NET.Sdk.Web">

  <!-- 
    PaletteStream.Ingestion.csproj
    Project: PaletteStream ETL Canvas â€“ Ingestion Micro-Service
    Description:
      Hosts the API & background workers responsible for data ingestion
      (Kafka stream + micro-batch jobs via Hangfire) for the PaletteStream
      platform. Targets .NET 8 and follows modern cloud-native best practices.
  -->

  <PropertyGroup>
    <!-- Target the latest LTS for long-term stability -->
    <TargetFramework>net8.0</TargetFramework>

    <!-- Enable implicit global using directives and nullable reference types -->
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>

    <!-- Produce XML doc file for every build so the service is self-documenting -->
    <GenerateDocumentationFile>true</GenerateDocumentationFile>
    <NoWarn>$(NoWarn);1591</NoWarn> <!-- Ignore missing XML comments warnings -->

    <!-- Publish-ready trimming & single-file options for container deployment -->
    <PublishTrimmed>true</PublishTrimmed>
    <PublishSingleFile>true</PublishSingleFile>
    <PublishReadyToRun>true</PublishReadyToRun>

    <!-- Docker Discovery -->
    <DockerDefaultTargetOS>Linux</DockerDefaultTargetOS>
    <ContainerBaseImage>mcr.microsoft.com/dotnet/aspnet:8.0</ContainerBaseImage>

    <!-- Treat all warnings as errors except the ones explicitly ignored -->
    <TreatWarningsAsErrors>true</TreatWarningsAsErrors>
  </PropertyGroup>

  <!-- Code-quality & analyzers -->
  <ItemGroup>
    <PackageReference Include="Microsoft.CodeAnalysis.NetAnalyzers" Version="8.0.0" PrivateAssets="All" />
    <PackageReference Include="StyleCop.Analyzers" Version="1.3.2" PrivateAssets="All" />
  </ItemGroup>

  <!-- Core infrastructure packages -->
  <ItemGroup>
    <PackageReference Include="Confluent.Kafka"                  Version="2.3.0" />
    <PackageReference Include="Hangfire.Core"                    Version="1.7.36" />
    <PackageReference Include="Hangfire.AspNetCore"              Version="1.7.36" />
    <PackageReference Include="Polly"                            Version="8.2.4" />
    <PackageReference Include="Serilog.AspNetCore"               Version="8.0.0" />
    <PackageReference Include="Serilog.Sinks.Console"            Version="5.0.1" />
    <PackageReference Include="Serilog.Sinks.Seq"                Version="5.2.0" />
    <PackageReference Include="Apache.Arrow"                     Version="13.0.0" />
    <PackageReference Include="ComputeSharp"                     Version="2.2.0" />
    <PackageReference Include="MediatR"                          Version="12.0.1" />
    <PackageReference Include="AutoMapper.Extensions.Microsoft.DependencyInjection" Version="12.0.0" />
    <PackageReference Include="Dapper"                           Version="2.1.35" />
    <PackageReference Include="Npgsql"                           Version="8.0.3" />
    <PackageReference Include="Swashbuckle.AspNetCore"           Version="6.6.0" />
    <PackageReference Include="prometheus-net.AspNetCore"        Version="7.0.1" />
    <PackageReference Include="Microsoft.Extensions.Diagnostics.HealthChecks" Version="8.0.0" />
  </ItemGroup>

  <!-- Testing packages (used by the accompanying *Tests* project via InternalsVisibleTo) -->
  <ItemGroup Condition="'$(Configuration)' == 'Debug'">
    <PackageReference Include="coverlet.collector"        Version="6.0.0" PrivateAssets="All" />
    <PackageReference Include="Microsoft.NET.Test.Sdk"    Version="17.9.0" PrivateAssets="All" />
  </ItemGroup>

  <!-- Make internal types visible to the test project -->
  <ItemGroup>
    <AssemblyAttribute Include="System.Runtime.CompilerServices.InternalsVisibleTo">
      <_Parameter1>PaletteStream.Ingestion.Tests</_Parameter1>
    </AssemblyAttribute>
  </ItemGroup>

  <!-- Environment-specific transformations -->
  <PropertyGroup Condition="'$(Configuration)' == 'Debug'">
    <DefineConstants>DEBUG;TRACE;FEATURE_DETAILED_LOGGING</DefineConstants>
    <Optimize>false</Optimize>
  </PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)' == 'Release'">
    <DefineConstants>TRACE</DefineConstants>
    <Optimize>true</Optimize>
  </PropertyGroup>

  <!-- Exclude Secrets.json from being published in containers -->
  <ItemGroup>
    <None Update="secrets.json">
      <CopyToOutputDirectory>Never</CopyToOutputDirectory>
    </None>
  </ItemGroup>

  <!-- Custom tooling targets -->
  <Target Name="VerifyCodeFormatting" BeforeTargets="Build">
    <!-- Ensure dotnet-format has been run -->
    <Exec Command="dotnet format --verify-no-changes" ContinueOnError="true">
      <Output TaskParameter="ExitCode" PropertyName="FormatExitCode" />
    </Exec>
    <Error Condition="'$(FormatExitCode)' != '0'" Text="Code formatting discrepancies detected. Run 'dotnet format' to fix them." />
  </Target>

</Project>
```