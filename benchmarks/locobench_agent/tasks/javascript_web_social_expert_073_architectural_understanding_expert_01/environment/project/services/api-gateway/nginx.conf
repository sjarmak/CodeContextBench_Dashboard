```javascript
/**
 * PulseLearn Campus Hub – Dynamic Nginx Configuration Builder
 * -----------------------------------------------------------
 * This script is responsible for generating a robust, battle-tested
 * nginx.conf file that fronts the API-Gateway of the PulseLearn platform.
 *
 * Why JavaScript for an “nginx.conf”?
 * ----------------------------------
 * • Configuration needs to adapt to dynamic container / k8s deployments.
 * • Runtime values (hostnames, ports, ssl paths) come from ENV vars.
 * • We want validation, helpful error messages and unit-testability.
 *
 * Usage
 * -----
 *  $ node nginx.conf [output-path]
 *
 *  – If executed via `node`, the generated configuration is written to
 *    the provided output path (default: /etc/nginx/conf.d/pulselearn.conf)
 *  – When imported (`require('./nginx.conf')`) the `buildNginxConfig`
 *    method returns the config as a string.
 */

'use strict';

const fs   = require('fs');
const path = require('path');
const os   = require('os');

////////////////////////////////////////////////////////////////////////////////
// Environment Schema
////////////////////////////////////////////////////////////////////////////////

const ENV_SCHEMA = {
  /** Comma-separated hosts for each micro-service.
   *  Example: AUTH_SERVICE_HOSTS="auth1:4000,auth2:4000" */
  AUTH_SERVICE_HOSTS        : { required: true  },
  USER_SERVICE_HOSTS        : { required: true  },
  CONTENT_SERVICE_HOSTS     : { required: true  },
  NOTIFICATION_SERVICE_HOSTS: { required: true  },

  /** SSL certificate / key */
  SSL_CERT_PATH             : { required: false, default: '/etc/ssl/certs/pulselearn.crt' },
  SSL_KEY_PATH              : { required: false, default: '/etc/ssl/private/pulselearn.key' },

  /** Optional toggles */
  FORCE_SSL                 : { required: false, default: 'true' },
  CLIENT_MAX_BODY_SIZE_MB   : { required: false, default: '20' },
  RATE_LIMIT_REQ_PER_MIN    : { required: false, default: '600' },

  /** Logging */
  ACCESS_LOG_PATH           : { required: false, default: '/var/log/nginx/access.log' },
  ERROR_LOG_PATH            : { required: false, default: '/var/log/nginx/error.log' }
};

/**
 * Load and validate environment variables against the schema.
 * Throws if a required variable is missing.
 */
function loadEnv () {
  const conf = {};

  Object.entries(ENV_SCHEMA).forEach(([key, meta]) => {
    const value = process.env[key] ?? meta.default;
    if (meta.required && (value === undefined || value === null)) {
      throw new Error(`Missing required environment variable: ${key}`);
    }
    conf[key] = value;
  });

  return conf;
}

////////////////////////////////////////////////////////////////////////////////
// Helper Functions
////////////////////////////////////////////////////////////////////////////////

/**
 * Parse upstream hosts into nginx `server` directives.
 *
 * @param {string} hostsString - Comma-separated host:port pairs.
 * @returns {string}           - Multi-line string ready to embed.
 */
function toUpstreamServers (hostsString) {
  return hostsString
    .split(',')
    .map(host => host.trim())
    .filter(Boolean)
    .map(host => `        server ${host};`)
    .join('\n');
}

/**
 * Render a single upstream block.
 *
 * @param {string} name       - Upstream name (e.g. "auth_service").
 * @param {string} hosts      - Comma-separated list of host:port targets.
 * @param {object} [opts={}]  - Options like keepalive settings.
 */
function renderUpstream (name, hosts, opts = {}) {
  const keepalive = opts.keepalive ?? 64;
  return `
    upstream ${name} {
${toUpstreamServers(hosts)}
        keepalive ${keepalive};
    }`;
}

/**
 * Render a location block that proxies to a given upstream service.
 *
 * @param {string} pathPrefix   - URI prefix (e.g. "/auth/").
 * @param {string} upstreamName - Name defined in an `upstream` block.
 */
function renderLocation (pathPrefix, upstreamName) {
  return `
            location ${pathPrefix} {
                proxy_pass          http://${upstreamName};
                proxy_http_version  1.1;
                proxy_set_header    Connection "";
                proxy_set_header    Host              $host;
                proxy_set_header    X-Real-IP         $remote_addr;
                proxy_set_header    X-Forwarded-For   $proxy_add_x_forwarded_for;
                proxy_set_header    X-Forwarded-Proto $scheme;
                proxy_set_header    X-Request-ID      $request_id;
                proxy_cache_bypass  $cookie_session;
            }`;
}

////////////////////////////////////////////////////////////////////////////////
// Main Config Builder
////////////////////////////////////////////////////////////////////////////////

/**
 * Build the complete nginx.conf string.
 *
 * @returns {string} The final configuration.
 */
function buildNginxConfig () {
  const env = loadEnv();

  const RATE_LIMIT_ZONE = `
    limit_req_zone $binary_remote_addr zone=req_limit:${parseInt(env.RATE_LIMIT_REQ_PER_MIN, 10) * 32}k rate=${env.RATE_LIMIT_REQ_PER_MIN}r/m;`;

  const UPSTREAMS = [
    ['auth_service',          env.AUTH_SERVICE_HOSTS],
    ['user_service',          env.USER_SERVICE_HOSTS],
    ['content_service',       env.CONTENT_SERVICE_HOSTS],
    ['notification_service',  env.NOTIFICATION_SERVICE_HOSTS]
  ].map(([name, hosts]) => renderUpstream(name, hosts)).join('\n');

  const LOCATIONS =
      renderLocation('/auth/',         'auth_service')          +
      renderLocation('/users/',        'user_service')          +
      renderLocation('/content/',      'content_service')       +
      renderLocation('/notifications/','notification_service');

  const SSL_CONFIG = (env.FORCE_SSL === 'true')
    ? `
        listen 443 ssl http2;
        ssl_certificate     ${env.SSL_CERT_PATH};
        ssl_certificate_key ${env.SSL_KEY_PATH};
        ssl_protocols       TLSv1.2 TLSv1.3;
        ssl_ciphers         HIGH:!aNULL:!MD5;
        ssl_prefer_server_ciphers on;
        ssl_session_cache   shared:SSL:10m;
        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;`
    : 'listen 80;';

  const REDIRECT_HTTP_TO_HTTPS = (env.FORCE_SSL === 'true')
    ? `
    server {
        listen      80;
        server_name _;
        return 301 https://$host$request_uri;
    }`
    : '';

  return `
###############################################################################
#  PulseLearn Campus Hub – Auto-Generated Nginx Configuration
#  ---------------------------------------------------------------------------
#  This file was generated by services/api-gateway/nginx.conf (NodeJS script).
#  DO NOT EDIT MANUALLY. Changes will be overwritten on the next deployment.
###############################################################################

worker_processes auto;
pid /run/nginx.pid;
events { worker_connections 1024; }

${RATE_LIMIT_ZONE}

http {
    include       mime.types;
    default_type  application/octet-stream;

    # Logs --------------------------------------------------------------------
    access_log ${env.ACCESS_LOG_PATH} main;
    error_log  ${env.ERROR_LOG_PATH}  warn;

    # Compression -------------------------------------------------------------
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # Upstreams ---------------------------------------------------------------
${UPSTREAMS}

    # API Gateway Server Block -------------------------------------------------
    server {
${SSL_CONFIG}

        server_name _;  # catch-all

        client_max_body_size ${env.CLIENT_MAX_BODY_SIZE_MB}M;

        # Rate Limiting -------------------------------------------------------
        limit_req zone=req_limit burst=15 nodelay;

        # Security Headers ----------------------------------------------------
        add_header X-Content-Type-Options nosniff;
        add_header X-Frame-Options DENY;
        add_header X-XSS-Protection "1; mode=block";

        # Proxy Routes --------------------------------------------------------
${LOCATIONS}

        # Fallback ------------------------------------------------------------
        location / {
            return 404;
        }
    }

${REDIRECT_HTTP_TO_HTTPS}
}
`;
}

////////////////////////////////////////////////////////////////////////////////
// CLI Entrypoint
////////////////////////////////////////////////////////////////////////////////

if (require.main === module) {
  (async () => {
    try {
      const outputPath = process.argv[2] ?? '/etc/nginx/conf.d/pulselearn.conf';
      const config     = buildNginxConfig();

      // Ensure destination directory exists
      fs.mkdirSync(path.dirname(outputPath), { recursive: true });

      // Write atomically
      const tmpFile = path.join(os.tmpdir(), `nginx-${Date.now()}.conf`);
      fs.writeFileSync(tmpFile, config, { encoding: 'utf8', mode: 0o644 });
      fs.renameSync(tmpFile, outputPath);

      console.log(`✔︎ nginx.conf successfully written to ${outputPath}`);
    } catch (err) {
      console.error('✖︎ Failed to generate nginx.conf:', err.message);
      process.exitCode = 1;
    }
  })();
}

////////////////////////////////////////////////////////////////////////////////
// Exports (for unit-tests)
////////////////////////////////////////////////////////////////////////////////
module.exports = { buildNginxConfig };
```