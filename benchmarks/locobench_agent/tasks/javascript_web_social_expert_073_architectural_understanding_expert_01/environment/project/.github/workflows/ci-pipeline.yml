```yaml
# File: .github/workflows/ci-pipeline.yml
#
# PulseLearn Campus Hub â€“ Continuous-Integration pipeline
# -------------------------------------------------------
# This workflow performs the following steps on every push / PR:
# 1.   Lints the codebase (ESLint & Prettier)
# 2.   Runs unit / component tests with Jest and collects coverage
# 3.   Performs dependency and vulnerable-package scans
# 4.   Builds the production bundle
# 5.   Creates & pushes a Docker image to GHCR on main / version tags
#
# The pipeline targets multiple Node.js LTS versions to ensure compatibility
# across active runtimes. Caching speeds up installs and build steps.

name: CI Pipeline

on:
  push:
    branches:
      - '**'
      - '!releases/**'    # release branches handled separately
    tags:
      - 'v*.*.*'          # semantic version tags
  pull_request:
    branches:
      - '**'
  workflow_dispatch:

# Cancel in-flight runs for the same ref to reduce unnecessary CI minutes
concurrency:
  group: ci-${{ github.head_ref || github.ref }}
  cancel-in-progress: true

env:
  # Centralized versions & config flags
  NODE_VERSION_MATRIX: '["16.x", "18.x", "20.x"]'
  # turn off NPM ads + reduce noise
  NPM_CONFIG_FUND: 'false'
  NPM_CONFIG_AUDIT: 'false'

jobs:
  # --------------------------------------------------
  # 1. Install dependencies and run lint / tests
  # --------------------------------------------------
  build-test:
    name: ğŸ§ª Lint â€¢ Test â€¢ Scan (Node ${{ matrix.node }})
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node: ${{ fromJson(env.NODE_VERSION_MATRIX) }}

    steps:
      - name: â¬‡ï¸  Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # full history for test snapshots & coverage diff

      - name: ğŸ—ï¸  Setup Node.js ${{ matrix.node }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node }}
          cache: 'npm'

      - name: ğŸ“¦ Install dependencies
        run: |
          # npm ci provides clean, reproducible installs
          npm ci
        env:
          # Ensure clean install even if lockfile changes
          CI: 'true'

      - name: ğŸ§¹ Lint & format check (ESLint, Prettier)
        run: |
          npm run lint
          npm run format:check

      - name: ğŸ” Security audit
        run: |
          npx audit-ci --moderate --report-type=summary
        continue-on-error: true # do not fail build on advisory, surface in PR comment

      - name: ğŸ§ª Run tests + collect coverage
        run: |
          npm run test:ci -- --coverage --runInBand
        env:
          NODE_ENV: test

      - name: ğŸ“Š Upload coverage to Codecov
        uses: codecov/codecov-action@v4
        with:
          files: ./coverage/lcov.info
          flags: unittests
          fail_ci_if_error: false
        if: ${{ always() }}

      - name: â¬†ï¸  Upload build artifacts (dist)
        uses: actions/upload-artifact@v4
        with:
          name: pulselearn-dist-${{ matrix.node }}
          path: |
            dist/**
            !dist/**/*.map
          retention-days: 7

  # --------------------------------------------------
  # 2. Build and push Docker image (single job, depends on build-test)
  # --------------------------------------------------
  docker:
    name: ğŸ³ Build & Push Docker image
    runs-on: ubuntu-latest
    needs: build-test
    # Only on main or version tags
    if: github.ref == 'refs/heads/main' || startsWith(github.ref, 'refs/tags/v')
    steps:
      - name: â¬‡ï¸  Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ—ï¸  Setup QEMU
        uses: docker/setup-qemu-action@v3

      - name: ğŸ—ï¸  Setup Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: ğŸ”‘ Login to GitHub Container Registry
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GHCR_TOKEN }}

      - name: ğŸ“¦ Extract version & metadata
        id: meta
        run: |
          VERSION="${GITHUB_REF#refs/*/}"
          SHA_SHORT=$(git rev-parse --short=8 HEAD)
          TAGS="ghcr.io/${{ github.repository }}:${VERSION},ghcr.io/${{ github.repository }}:${SHA_SHORT}"
          echo "tags=${TAGS}" >> $GITHUB_OUTPUT

      - name: ğŸ³ Build and push
        uses: docker/build-push-action@v5
        with:
          context: .
          file: ./Dockerfile
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          cache-from: type=gha
          cache-to: type=gha,mode=max
          build-args: |
            NODE_ENV=production

      - name: ğŸ“¢ Image digest
        run: echo "Image pushed with digest ${{ steps.docker-build.outputs.digest }}"

  # --------------------------------------------------
  # 3. Deploy staging environment (optional)
  # --------------------------------------------------
  staging-deploy:
    name: ğŸš€ Deploy to Staging
    runs-on: ubuntu-latest
    needs: docker
    if: github.ref == 'refs/heads/main'
    environment:
      name: staging
      url: https://staging.pulselearn.io
    steps:
      - name: ğŸ“¡ Trigger ArgoCD rollout
        run: |
          curl -X POST \
               -H "Authorization: Bearer ${{ secrets.ARGOCD_WEBHOOK_TOKEN }}" \
               -H "Content-Type: application/json" \
               -d '{"revision":"main"}' \
               ${{ secrets.ARGOCD_WEBHOOK_URL }}
```