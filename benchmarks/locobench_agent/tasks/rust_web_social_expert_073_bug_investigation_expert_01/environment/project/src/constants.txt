```rust
//! ======================
//!  EduPulse Live
//!  ----------------------
//!  Centralised constants, default values, and environment‐
//!  variable helpers used across the code-base. Although this
//!  module is purposely *plain data*, it is treated as source
//!  code and must therefore compile on its own.
//!
//!  All “magic numbers” and static strings **must** be defined
//!  here to avoid duplication and promote discoverability.
//!
//!  File path: src/constants.txt
//!  (kept `.txt` to emphasise *constant* nature; included by
//!   `include!(concat!(env!("CARGO_MANIFEST_DIR"), "/src/constants.txt"));`)
//! ======================

#![allow(clippy::unreadable_literal)]
#![allow(clippy::doc_markdown)]

use std::time::Duration;

use once_cell::sync::Lazy;

/// ---------------------------
/// Environment & Deployment
/// ---------------------------

/// Name of the application used in logs, tracing, and metrics.
pub const APP_NAME: &str = "edupulse-live";

/// Current semver. In CI, this is auto-replaced by `vergen`.
pub const APP_VERSION: &str = env!("CARGO_PKG_VERSION");

/// Public‐facing service name used for OTEL service discovery.
pub const OTEL_SERVICE_NAME: &str = "edupulse_live_api";

/// Build profile (debug / release) injected by build.rs.
pub const BUILD_PROFILE: &str = env!("PROFILE");

/// The *configured* run‐time environment.
#[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]
pub enum RunMode {
    Development,
    Staging,
    Production,
}

impl RunMode {
    /// Detect the run mode from `EDUPULSE_ENV` or fallback to `Development`.
    pub fn detect() -> Self {
        match std::env::var("EDUPULSE_ENV")
            .unwrap_or_else(|_| "development".into())
            .to_lowercase()
            .as_str()
        {
            "prod" | "production" => Self::Production,
            "stage" | "staging" => Self::Staging,
            _ => Self::Development,
        }
    }

    /// Convenience helper to switch on logging/tracing verbosity, etc.
    pub fn is_prod(self) -> bool {
        matches!(self, Self::Production)
    }
}

/// The run mode evaluated once at start-up.
pub static RUN_MODE: Lazy<RunMode> = Lazy::new(RunMode::detect);

/// ---------------------------
/// Database configuration
/// ---------------------------

/// Default PostgreSQL port (overridable via `PG_PORT` env var).
pub const DEFAULT_PG_PORT: u16 = 5432;

/// Name of the primary application database (overridable).
pub const DEFAULT_PG_DBNAME: &str = "edupulse_core";

/// Default database connection pool size.
pub const DEFAULT_DB_POOL_SIZE: u32 = 35;

/// How long we wait for a connection from the pool.
pub const DEFAULT_DB_TIMEOUT: Duration = Duration::from_secs(4);

/// Supported Postgres isolation level for critical financial ops.
pub const FINANCE_TX_ISOLATION_LEVEL: &str = "SERIALIZABLE";

/// ---------------------------
/// Redis / Session management
/// ---------------------------

pub const DEFAULT_REDIS_URL: &str = "redis://127.0.0.1:6379";
pub const REDIS_SESSION_PREFIX: &str = "sess:";
pub const REDIS_CACHE_PREFIX: &str = "cache:";

/// Sliding session expiration time.
pub const SESSION_TTL: Duration = Duration::from_secs(60 * 60 * 4); // 4h

/// Rotate session key every N hours (GDPR-friendly).
pub const SESSION_ROTATION_INTERVAL: Duration = Duration::from_secs(60 * 60 * 24); // 24h

/// ---------------------------
/// Security / Auth
/// ---------------------------

/// Length of generated CSRF tokens.
pub const CSRF_TOKEN_LENGTH: usize = 32;

/// JWT token settings.
pub const JWT_ISSUER: &str = "edupulse-live";
pub const JWT_AUDIENCE: &str = "edupulse-live-users";
pub const JWT_ALGO: &str = "HS512";
pub const JWT_EXP_DEFAULT: Duration = Duration::from_secs(60 * 60 * 2); // 2h

/// Password hashing parameters (Argon2id).
pub mod pw_hash {
    pub const MEMORY_KIB: u32 = 96 * 1024; // 96 MiB
    pub const ITERATIONS: u32 = 3;
    pub const PARALLELISM: u32 = 1;
}

/// Rate limits (per IP).
pub mod rate_limit {
    use super::*;
    pub const LOGIN_ATTEMPTS: u32 = 10;
    pub const LOGIN_WINDOW: Duration = Duration::from_secs(60 * 5); // 5 min
}

/// ---------------------------
/// Broker topics / queues
/// ---------------------------

/// Kafka topics (or NATS subjects) used by the event engine.
/// Keep alphabetical for easier merge diff.
pub mod topics {
    pub const BADGE_AWARDED: &str = "badge.awarded.v1";
    pub const COURSE_LAUNCHED: &str = "course.launched.v1";
    pub const LESSON_PUBLISHED: &str = "lesson.published.v1";
    pub const PAYMENT_PROCESSED: &str = "payment.processed.v1";
    pub const PEER_FEEDBACK_GIVEN: &str = "peer.feedback.v1";
    pub const PULSE_CREATED: &str = "pulse.created.v1";
    pub const QUIZ_SUBMITTED: &str = "quiz.submitted.v1";
}

/// ---------------------------
/// Search / Indexing
/// ---------------------------

pub const ES_INDEX_LESSONS: &str = "lessons_v6";
pub const ES_INDEX_USERS: &str = "users_v4";
pub const ES_INDEX_DISCUSSIONS: &str = "discussions_v3";

/// Default refresh interval for content indexes.
pub const ES_REFRESH_INTERVAL_MS: u64 = 5_000;

/// ---------------------------
/// CDN / File Storage
/// ---------------------------

pub const CDN_BASE_URL: &str = "https://cdn.edupulse.io";
pub const ALLOWED_UPLOAD_MIME: &[&str] = &[
    "application/pdf",
    "application/zip",
    "text/markdown",
    "image/png",
    "image/jpeg",
    "video/mp4",
];

/// Maximum file upload size (in bytes).
pub const MAX_UPLOAD_SIZE_BYTES: u64 = 1024 * 1024 * 250; // 250 MB

/// ---------------------------
/// UI / Pagination defaults
/// ---------------------------

pub const DEFAULT_PAGE_SIZE: u32 = 20;
pub const MAX_PAGE_SIZE: u32 = 100;

/// ---------------------------
/// Third-party integrations
/// ---------------------------

pub const GOOGLE_OAUTH_SCOPES: &str =
    "https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile";

pub const MICROSOFT_EDU_SCOPE: &str = "https://graph.microsoft.com/User.Read";

/// PayPal / Stripe
pub mod payments {
    pub const STRIPE_VERSION: &str = "2023-10-16";
    pub const DEFAULT_CURRENCY: &str = "usd"; // minor: we store monetary amounts in minor units
}

/// --------------
/// Misc helpers
/// --------------

/// Small helper to fetch a u16 env var with a default.
pub fn env_u16(key: &str, default: u16) -> u16 {
    std::env::var(key)
        .ok()
        .and_then(|s| s.parse::<u16>().ok())
        .unwrap_or(default)
}

/// Small helper to fetch a usize env var with a default.
pub fn env_usize(key: &str, default: usize) -> usize {
    std::env::var(key)
        .ok()
        .and_then(|s| s.parse::<usize>().ok())
        .unwrap_or(default)
}

/// Returns the canonical fully qualified topic name for a given school.
pub fn school_scoped_topic(school_id: &str, topic: &str) -> String {
    format!("{school_id}.{topic}")
}

/// ---------------------------
/// Unit Tests
/// ---------------------------
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_env_helpers() {
        // Provide a temp var
        std::env::set_var("TMP_TEST_PORT", "7777");
        assert_eq!(env_u16("TMP_TEST_PORT", 1234), 7777);
        std::env::remove_var("TMP_TEST_PORT");
        assert_eq!(env_u16("TMP_TEST_PORT", 1234), 1234);
    }

    #[test]
    fn test_run_mode_detection() {
        std::env::set_var("EDUPULSE_ENV", "production");
        assert!(matches!(RunMode::detect(), RunMode::Production));
        std::env::set_var("EDUPULSE_ENV", "StAgInG");
        assert!(matches!(RunMode::detect(), RunMode::Staging));
        std::env::remove_var("EDUPULSE_ENV");
        assert!(matches!(RunMode::detect(), RunMode::Development));
    }

    #[test]
    fn test_school_scoped_topic() {
        let scoped = school_scoped_topic("xyz_school", topics::QUIZ_SUBMITTED);
        assert_eq!(scoped, "xyz_school.quiz.submitted.v1");
    }
}
```