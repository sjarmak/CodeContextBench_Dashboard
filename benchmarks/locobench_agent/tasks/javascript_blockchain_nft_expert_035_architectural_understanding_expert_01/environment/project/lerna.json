{
  "$schema": "https://unpkg.com/lerna@latest/schemas/lerna-schema.json",

  /* 
    StellarStage Carnival is structured as a poly-repo containing:
    - domain-driven libraries in packages/
    - vertical service adapters in services/
    - front-end applications in dapps/
    - shared tooling in tooling/
    
    We rely on npm workspaces so that Lerna can delegate
    install logic to the underlying package manager while still
    orchestrating versioning, changelogs and publishing.
  */
  "packages": [
    "packages/*",
    "services/*",
    "dapps/*",
    "tooling/*"
  ],

  /*
    Independent versioning keeps contract, front-end and infra
    libraries decoupled; each package follows semver based on
    Conventional Commits parsed during `lerna version`.
  */
  "version": "independent",

  /* Delegate installs to npm workspaces */
  "npmClient": "npm",
  "useWorkspaces": true,

  /*
    Command-level overrides
  */
  "command": {
    /* 
      lerna bootstrap
      ----------------
      1. Hoist all runtime deps to the workspace root to speed up CI
      2. Preserve package-lock consistency by disabling lockfiles
    */
    "bootstrap": {
      "hoist": true,
      "hoistPattern": ["*"],
      "npmClientArgs": ["--no-package-lock"]
    },

    /*
      lerna run
      ---------
      Stream output from all packages so that our CI logs remain
      interleaved and time-ordered.
    */
    "run": {
      "stream": true
    },

    /*
      lerna version
      -------------
      - Enforce Conventional Commits
      - Auto-generate CHANGELOGs
      - Create GitHub releases
      - Only run from main, alpha or beta
    */
    "version": {
      "conventionalCommits": true,
      "changelogPreset": "conventional-changelog-conventionalcommits",
      "createRelease": "github",
      "push": true,
      "allowBranch": ["main", "alpha", "beta"],
      "message": "chore(release): publish"
    },

    /*
      lerna publish
      -------------
      - Publish packages concurrently (without order constraints as we
        depend on npm's workspaces linking)
      - Skip access verification because we use scoped, public packages
        under a service account with pre-configured permissions.
    */
    "publish": {
      "concurrency": 4,
      "verifyAccess": false
    }
  },

  /*
    Files that do NOT trigger a version bump.
    Docs and tests evolve continuously and shouldnâ€™t pollute releases.
  */
  "ignoreChanges": ["**/*.md", "**/*.spec.ts", "**/*.test.ts", "**/__snapshots__/**"],

  /*
    Additional metadata recognised by StellarStage tooling
    ------------------------------------------------------
    The release-bot inspects this block to decide whether to
    auto-deploy to staging or production.
  */
  "stellaRelease": {
    "productionBranches": ["main"],
    "stagingBranches": ["alpha", "beta"]
  },

  /*
    Silence verbose logging in CI; local devs can override with:
      $ lerna <cmd> --loglevel=mute|error|warn|info|verbose|silly
  */
  "loglevel": "info"
}