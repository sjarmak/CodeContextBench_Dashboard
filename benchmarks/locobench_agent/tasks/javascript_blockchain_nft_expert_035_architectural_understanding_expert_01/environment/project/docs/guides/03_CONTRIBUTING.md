```markdown
# Contributing to **StellarStage Carnival**  
Interactive NFT Showrunner

Welcome ðŸ‘‹â€”and thank you for taking the time to help shape the future of immersive, blockchainâ€“powered entertainment!  
This document explains the guidelines we follow to keep the code-base healthy, secure and maintainable.

---

## Table of Contents
1. Project Philosophy
2. Development Environment
3. Repository Layout
4. Branching & Release Flow
5. Coding Guidelines
6. Testing Strategy
7. Commit & Pull-Request Process
8. Security & Responsible Disclosure
9. Communication Channels
10. Contributor License Agreement (CLA)

---

## 1. Project Philosophy

StellarStage Carnival adheres to **Clean Architecture** and pursues _testability_, _modularity_ and _future chain-agnosticism_.  
Key principles:

* **Separation of Concerns** â€“ Domain logic is framework- & blockchain-agnostic.
* **Explicit Boundaries** â€“ Communication between layers happens exclusively through ports and adapters.
* **Evolvability** â€“ Upgradeable smart contracts (EIP-1967 proxy pattern) + feature-flagged TypeScript services.
* **Open Governance** â€“ Community members stake show-pass NFTs to propose and vote on changes.

---

## 2. Development Environment

â€£ **Node.js** >= 18.x  
â€£ **Yarn** >= 3.x (Berry / Plugâ€™nâ€™Play)  
â€£ **Docker** â€“ for local Ethereum (Anvil) + IPFS node  
â€£ **Solidity** 0.8.x via Hardhat  
â€£ **Bun** (optional) test runner for ultra-fast unit tests  
â€£ **VS Code** + recommended extensions (`.vscode/extensions.json`)

### 2.1 Quick Start

```bash
# clone
git clone git@github.com:StellarStage/carnival.git && cd carnival

# install deps (workspace + pnp)
corepack enable && yarn install --immutable

# spin up local infra
docker compose up -d anvil ipfs

# run all tests
yarn test:all
```

Environment variables live in `.env.local`; copy the sample and NEVER commit secrets.

```bash
cp .env.example .env.local
```

---

## 3. Repository Layout

```
.
â”œâ”€ apps/                      # front-end + admin dashboards
â”‚  â”œâ”€ show-client/            # React-Three + Zustand
â”‚  â””â”€ governance-dapp/        # Next.js
â”œâ”€ packages/
â”‚  â”œâ”€ domain/                 # core entities (TS)
â”‚  â”œâ”€ use-cases/              # orchestrations
â”‚  â”œâ”€ infra/                  # ethereum, l2, ipfs adapters
â”‚  â”œâ”€ contracts/              # Solidity + Hardhat
â”‚  â”œâ”€ event-bus/              # Node Emitter â†’ Redis Streams
â”‚  â””â”€ graphql/                # Apollo server
â””â”€ docs/                      # mkdocs-material
```

### 3.1 Layer Rules

* `domain` MUST NOT import from any other package.
* `use-cases` may depend on `domain` but NEVER on `infra`.
* `infra` implements ports found in `use-cases` or `domain`.
* `ui` layers consume GraphQL/WebSocket events only.

[Further reading â†’ Clean Architecture decision record](./adr/0001-clean-architecture.md)

---

## 4. Branching & Release Flow

* **`main`** â€“ always deployable; auto-released to staging.
* **Feature branches** â€“ `feat/<scope>-<ticketâ€id>`  
* **Hotfix branches** â€“ `hotfix/<patch-id>`
* **Release tags** â€“ SemVer, generated by **Semantic Release**.

CI/CD is GitHub Actions â†’ `staging` (Mumbai) â†’ manual promotion â†’ `production` (Polygon mainnet).

---

## 5. Coding Guidelines

### 5.1 Languages

* **TypeScript** â€“ strict mode, `noImplicitAny`
* **Solidity** â€“ ^0.8.20, `pragma experimental ABIEncoderV2`
* **GraphQL** â€“ schema-first (`/packages/graphql/schema.graphql`)

### 5.2 Style & Tooling

| Tool            | Config File           | Command             |
|-----------------|-----------------------|---------------------|
| ESLint          | `.eslintrc.cjs`       | `yarn lint`         |
| Prettier        | `.prettierrc`         | `yarn format`       |
| commitlint      | `commitlint.config.cjs`| `husky pre-commit`  |
| Solhint         | `.solhint.json`       | `yarn lint:sol`     |

Pre-commit hooks powered by **Husky** & **lint-staged** block pushes if lint or tests fail.

### 5.3 Patterns in Use

* **Factory** â€“ NFT trait generation (`packages/domain/nft/factory`)
* **Strategy** â€“ royalty distribution per performance type
* **State Machine** â€“ Show lifecycle (`Draft â†’ Live â†’ Finished â†’ Archived`)
* **Observer** â€“ Event bus broadcasting on-chain events to WebSockets
* **Proxy** â€“ EIP-1967 upgradeable contracts

Follow existing implementations; if a new abstraction is required, propose it via an ADR.

---

## 6. Testing Strategy

| Layer          | Framework         | Command           | Coverage |
|----------------|-------------------|-------------------|----------|
| Unit (TS)      | Vitest / Jest     | `yarn test:unit`  | â‰¥ 90 %   |
| Contract       | Hardhat + Foundry | `yarn test:contracts` | â‰¥ 100% public/external |
| Integration    | Mocha             | `yarn test:int`   | n/a      |
| E2E (web)      | Playwright        | `yarn test:e2e`   | critical paths |

`yarn test:all` orchestrates the full pyramid.

### 6.1 Snapshots

Avoid brittle snapshots. Only snapshot ABI interfaces & GraphQL schemas.

### 6.2 Fixtures

Use `packages/fixtures` for repeatable on-chain states.  
Fixtures MUST include a deterministic seed for fuzz testing.

---

## 7. Commit & Pull-Request Process

1. Create a feature branch.
2. Write code + tests; ensure `yarn ci` passes locally.
3. Commit using **Conventional Commits** (`feat: add stakePass use-case`).
4. Push and open a Draft PR.
5. Request review once green.
6. At least **2 approvals** required; one must be a core maintainer.
7. Squash & merge; CI will release if conditions are met.

### 7.1 PR Checklist

- [ ] Linted (`yarn lint`)
- [ ] Unit tests added/updated
- [ ] Contracts audited via `yarn audit:slither`
- [ ] Docs updated (`/docs` or JSDoc)
- [ ] No secrets committed (`git secrets --scan`)

Automated GitHub Actions also run `license-checker` to ensure OSS compliance.

---

## 8. Security & Responsible Disclosure

Blockchain and DeFi code is high-stakes.  
If you find a vulnerability:

1. Email **security@stellarstage.io** with _detailed_ steps to reproduce.
2. Allow us 90 days to remediate before public disclosure.
3. Eligible reports may receive a bounty in USDC or show-pass NFTs.

See `SECURITY.md` for PGP keys and scope.

---

## 9. Communication Channels

* **Discord** â€“ `#dev-core`, `#dev-smart-contracts`
* **GitHub Discussions** â€“ architecture questions
* **Weekly Dev Call** â€“ Thursdays 15:00 UTC (agenda in `/docs/meetings`)

---

## 10. Contributor License Agreement (CLA)

All contributors must sign the **StellarStage Individual CLA**.  
The bot will automatically trigger a check on your first pull request.

---

## FAQ

> **Q:** Can I submit improvements to the Solidity contracts?  
> **A:** Absolutely. Please include Hardhat tests and ensure gas efficiency.

> **Q:** How do I add a new chain adapter?  
> **A:** Implement the `ChainPort` interface in `packages/infra/chains` and register it in the DI container. See the Optimism adapter for reference.

---

### Happy Hacking ðŸŽ¸ðŸª©ðŸŽ¬
```