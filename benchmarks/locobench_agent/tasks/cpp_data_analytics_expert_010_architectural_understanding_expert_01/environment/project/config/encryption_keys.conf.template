#------------------------------------------------------------------------------
# CardioInsight360 – Unified Healthcare Analytics Engine
#
# File: cardio_insight_360/config/encryption_keys.conf.template
# Purpose:
#   Template file for configuring HIPAA-grade encryption secrets used by the
#   CardioInsight360 binary.  Copy this file to the same directory—removing the
#   “.template” suffix—then replace the   ${…}   placeholders with *real* values
#   or environment‐variable substitutions supported by your secrets-management
#   tooling (HashiCorp Vault, AWS KMS, Azure Key Vault, on-prem HSM, etc.).
#
#   NOTE:  The binary will refuse to start if any placeholder remains
#   unresolved, or if mandatory keys are missing.  Use `ci360 --check-config`
#   after editing to validate correctness before deploying to production.
#
# Format:
#   This file follows the HOCON/JSON-superset syntax understood by
#   `libhocon-cpp`.  Both “//” and “#” style comments are supported.
#------------------------------------------------------------------------------

encryption {

  #----------------------------#
  # 1. Encryption At-Rest      #
  #----------------------------#
  at-rest {

    # Algorithm for bulk‐data encryption at rest (raw & curated Parquet files)
    algorithm = "AES-256-GCM"          # Valid options: AES-256-GCM | AES-128-GCM

    # 256-bit Master Key Encryption Key (KEK) used to wrap the DEKs on disk.
    #
    # Best practice:
    #   • Store KEK in a hardware backed KMS/HSM.
    #   • Reference by URI so CI360 can request unwrap operations over TLS.
    #
    # Example URI schemes:
    #   kms://aws-kms/alias/ci360-prod
    #   kms://azure-keyvault/keys/ci360-prod
    #   kms://vault://kv/ci360/enc/kek
    #
    # Local deployments may embed a base64-encoded key FOR DEVELOPMENT ONLY.
    # The pre-packaged “dev” profile (ci360 --profile=dev) will auto-generate
    # one if absent.  DO NOT USE IN PRODUCTION.
    master-key-uri = ${CI360_KEK_URI}  # e.g. "kms://aws-kms/alias/ci360-prod"

    # Rotate KEK every N days; 0 disables automatic rotation.
    rotation-period-days = 90

    # When set, CI360 validates whether the KEK is already rotated at startup,
    # and performs rotation before accepting traffic, guaranteeing compliance.
    rotate-at-startup = false
  }

  #----------------------------#
  # 2. Encryption In-Transit   #
  #----------------------------#
  in-transit {

    tls {
      # Fully qualified path(s) to certificate chain and private key files.
      # Supported formats: PEM, PKCS#8, PKCS#12 (auto-detected).
      certificate-chain = "/etc/ci360/tls/server.crt"
      private-key       = "/etc/ci360/tls/server.key"
      ca-certificate    = "/etc/ci360/tls/ca-bundle.pem"

      # Enforce mutual-TLS with upstream data publishers (e.g. bedside gateways)
      client-auth = {
        mode    = "require"            # none | request | require
        ssl-dh  = "/etc/ci360/tls/dhparam.pem"
      }

      # Allowed cipher suites – OpenSSL names, comma-separated
      cipher-suites = [
        "TLS_AES_256_GCM_SHA384",
        "TLS_CHACHA20_POLY1305_SHA256",
        "TLS_AES_128_GCM_SHA256"
      ]

      # TLS protocol versions (min/max).  Uncomment to override defaults.
      # min-protocol = "TLSv1.2"
      # max-protocol = "TLSv1.3"
    }
  }

  #----------------------------#
  # 3. Field-Level Encryption  #
  #----------------------------#
  field-level {

    # Enable/disable field-level encryption for the patient-PII columns in the
    # curated Parquet tables (contact_info, physician_notes, etc.).
    enabled = true

    # Hybrid scheme:  ECC (ECIES using NIST P-256) to wrap a symmetric AES-256
    # Content Encryption Key (CEK) per column chunk.
    algorithm = "ECIES-P256+A256GCM"

    # Public key of the cluster – Base64-encoded ASN.1 SubjectPublicKeyInfo.
    #
    # To rotate, simply replace this key and restart CI360; the system will
    # continue to read historical data encrypted with older keys.
    public-key = ${CI360_PUBLIC_P256_KEY}

    # Key fingerprint (SHA-256) – for audit logs and sanity checking.  Optional.
    fingerprint = "${CI360_PUBLIC_P256_FINGERPRINT ?:"0000000000000000000000000000000000000000000000000000000000000000"}"
  }

  #----------------------------#
  # 4. Password Hashing        #
  #----------------------------#
  password-hashing {

    # Hash algorithm for user-managed credentials in the embedded auth service.
    algorithm = "argon2id"

    # Tunable Argon2 parameters – memory cost (MiB), iterations, parallelism.
    argon2 = {
      memory-mib  = 256
      iterations  = 3
      parallelism = 4
    }
  }

  #----------------------------#
  # 5. Audit & Compliance      #
  #----------------------------#
  audit-log {

    # Where cryptographic events (key rotation, failed unwrap, TLS renegotiation)
    # are persisted.  Choose "local" (JSON files), "syslog", or "splunk".
    sink = "local"

    local = {
      directory = "/var/log/ci360/audit"     # Created automatically if missing
      roll-policy = { size-mb = 50, backups = 10 }
    }

    # Optional:  integrate with enterprise SIEM via Syslog
    # syslog = {
    #   facility = "local4"
    #   address  = "udp://10.10.5.22:514"
    # }
  }
}

#------------------------------------------------------------------------------
#     END OF TEMPLATE – HAVE YOU REMOVED *EVERY* ${…} PLACEHOLDER ABOVE ?     #
#------------------------------------------------------------------------------