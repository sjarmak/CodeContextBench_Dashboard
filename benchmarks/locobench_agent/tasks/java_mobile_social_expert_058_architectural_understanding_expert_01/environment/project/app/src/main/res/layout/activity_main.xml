<?xml version="1.0" encoding="utf-8"?>
<!--
    WellSphere Connect
    Main Activity Layout

    This layout leverages:
    - Data-Binding to connect to MainViewModel
    - Coordinator/Constraint layouts for responsive UI
    - Material Components for modern look & feel
    - SwipeRefreshLayout for pull-to-refresh
    - Extended FAB for context-aware quick actions
    - BottomNavigationView for primary navigation
-->
<layout xmlns:android="http://schemas.android.com/apk/res/android"
        xmlns:app="http://schemas.android.com/apk/res-auto"
        xmlns:tools="http://schemas.android.com/tools">

    <data>
        <!-- ViewModel driving the main timeline & nav state -->
        <import type="com.wellsphere.connect.ui.main.MainViewModel"/>

        <variable
            name="vm"
            type="MainViewModel"/>
    </data>

    <androidx.coordinatorlayout.widget.CoordinatorLayout
        android:id="@+id/coordinatorRoot"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:fitsSystemWindows="true"
        tools:context=".ui.main.MainActivity">

        <!-- AppBar with collapsing behavior for larger devices -->
        <com.google.android.material.appbar.AppBarLayout
            android:id="@+id/appBar"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:theme="@style/ThemeOverlay.Material3.ActionBar.Surface">

            <com.google.android.material.appbar.MaterialToolbar
                android:id="@+id/toolbar"
                style="@style/Widget.Material3.Toolbar"
                android:layout_width="match_parent"
                android:layout_height="?attr/actionBarSize"
                android:gravity="center_vertical"
                android:title="@{vm.toolbarTitle}"
                android:contentDescription="@string/toolbar_content_description"
                app:logo="@drawable/ic_wellsphere_logo"
                app:menu="@menu/menu_main"
                app:navigationContentDescription="@string/navigation_drawer_open"
                tools:menu="@menu/menu_main"
                tools:title="@string/app_name"/>
        </com.google.android.material.appbar.AppBarLayout>

        <!-- Pull-to-refresh wrapper -->
        <androidx.swiperefreshlayout.widget.SwipeRefreshLayout
            android:id="@+id/swipeRefresh"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:layout_marginBottom="?attr/actionBarSize"
            app:layout_behavior="@string/appbar_scrolling_view_behavior"
            app:refreshing="@{vm.isRefreshing}"
            app:onRefreshListener="@{() -> vm.onRefresh()}">

            <!-- RecyclerView for the social feed -->
            <androidx.recyclerview.widget.RecyclerView
                android:id="@+id/recyclerFeed"
                android:layout_width="match_parent"
                android:layout_height="match_parent"
                android:clipToPadding="false"
                android:paddingTop="@dimen/feed_vertical_margin"
                android:paddingBottom="@dimen/feed_bottom_padding"
                android:scrollbars="vertical"
                tools:listitem="@layout/item_post_card"
                tools:itemCount="3"/>
        </androidx.swiperefreshlayout.widget.SwipeRefreshLayout>

        <!-- Empty / Error state view (data binding visibility) -->
        <FrameLayout
            android:id="@+id/stateContainer"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:layout_marginBottom="?attr/actionBarSize"
            android:visibility="@{vm.showStateLayout ? View.VISIBLE : View.GONE}"
            app:layout_behavior="@string/appbar_scrolling_view_behavior"
            tools:visibility="gone">

            <include
                layout="@layout/view_state"
                android:id="@+id/viewState"
                app:stateVariant="@{vm.currentState}"/>
        </FrameLayout>

        <!-- Extended FAB for quick post creation -->
        <com.google.android.material.floatingactionbutton.ExtendedFloatingActionButton
            android:id="@+id/fabAddPost"
            style="@style/Widget.Material3.ExtendedFloatingActionButton.Primary"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_gravity="bottom|end"
            android:layout_margin="@dimen/fab_margin"
            android:contentDescription="@string/cd_create_post"
            android:text="@string/label_new_post"
            android:visibility="@{vm.isFabVisible ? View.VISIBLE : View.GONE}"
            app:icon="@drawable/ic_add_photo"
            app:layout_anchor="@id/coordinatorRoot"
            app:layout_anchorGravity="bottom|end"
            app:onClick="@{() -> vm.onFabClicked()}"/>

        <!-- Bottom Navigation -->
        <com.google.android.material.navigationrail.NavigationRailView
            android:id="@+id/navigationRail"
            android:layout_width="wrap_content"
            android:layout_height="match_parent"
            android:layout_gravity="start"
            android:visibility="@{vm.isLargeScreen ? View.VISIBLE : View.GONE}"
            app:menu="@menu/menu_navigation"
            app:headerLayout="@layout/view_profile_header"
            app:itemActiveIndicatorStyle="@style/Widget.WellSphere.Navigation.ActiveIndicator"
            app:itemIconTint="@color/nav_item_selector"
            app:itemTextAppearanceActive="@style/TextAppearance.Navigation.Active"
            app:itemTextAppearanceInactive="@style/TextAppearance.Navigation.Inactive"
            tools:visibility="gone"/>

        <com.google.android.material.bottomnavigation.BottomNavigationView
            android:id="@+id/bottomNavigation"
            android:layout_width="match_parent"
            android:layout_height="?attr/actionBarSize"
            android:layout_gravity="bottom"
            android:background="?attr/colorSurface"
            android:elevation="8dp"
            android:visibility="@{vm.isLargeScreen ? View.GONE : View.VISIBLE}"
            app:itemIconTint="@color/nav_item_selector"
            app:itemTextColor="@color/nav_item_selector"
            app:labelVisibilityMode="labeled"
            app:menu="@menu/menu_navigation"/>

    </androidx.coordinatorlayout.widget.CoordinatorLayout>
</layout>