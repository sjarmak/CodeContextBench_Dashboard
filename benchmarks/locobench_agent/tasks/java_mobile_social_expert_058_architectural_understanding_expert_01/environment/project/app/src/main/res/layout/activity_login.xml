<?xml version="1.0" encoding="utf-8"?>
<!--
    ======================================================================
        File: activity_login.xml
        Module: WellSphere Connect (Android)
        Description:
            - Login screen layout leveraging Android Data Binding & Material
              Components.
            - Integrates with LoginViewModel (MVVM) providing two–way data
              binding, validation messages, loading state observation, and
              biometric-auth visibility.
            - Accessibility, adaptive guidelines, and night-mode compliance.
    ======================================================================
-->
<layout xmlns:android="http://schemas.android.com/apk/res/android"
        xmlns:app="http://schemas.android.com/apk/res-auto">

    <!-- ────────────────────  Data Binding  ───────────────────── -->
    <data>

        <!-- ViewModel tied to this screen -->
        <variable
            name="viewModel"
            type="com.wellsphere.connect.presentation.login.LoginViewModel" />

        <!-- Whether a biometric sensor is present & enrolled -->
        <variable
            name="isBiometricAvailable"
            type="boolean" />
    </data>

    <!-- ────────────────────  Root Layout  ────────────────────── -->
    <androidx.constraintlayout.widget.ConstraintLayout
        android:id="@+id/loginRoot"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:background="?attr/colorSurface"
        android:fitsSystemWindows="true">

        <!-- ─────────── Logo / Brand ─────────── -->
        <com.google.android.material.imageview.ShapeableImageView
            android:id="@+id/logoImage"
            android:layout_width="120dp"
            android:layout_height="120dp"
            android:contentDescription="@string/desc_app_logo"
            app:layout_constraintTop_toTopOf="parent"
            app:layout_constraintTop_margin="48dp"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintEnd_toEndOf="parent"
            app:srcCompat="@drawable/ic_wellsphere_logo"
            app:shapeAppearanceOverlay="@style/ShapeAppearance.WellSphere.Circle" />

        <!-- ─────────── Username Field ─────────── -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/usernameLayout"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:hint="@string/hint_username_email"
            app:errorEnabled="true"
            app:errorTextAppearance="@style/TextAppearance.WellSphere.Error"
            app:helperTextEnabled="false"
            app:layout_constraintTop_toBottomOf="@id/logoImage"
            app:layout_constraintTop_margin="32dp"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintWidth_percent="0.85">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/usernameEditText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:importantForAutofill="yes"
                android:inputType="textEmailAddress"
                android:maxLines="1"
                android:text="@={viewModel.username}" />
        </com.google.android.material.textfield.TextInputLayout>

        <!-- ─────────── Password Field ─────────── -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/passwordLayout"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:hint="@string/hint_password"
            app:errorEnabled="true"
            app:errorTextAppearance="@style/TextAppearance.WellSphere.Error"
            app:helperTextEnabled="false"
            app:passwordToggleEnabled="true"
            app:layout_constraintTop_toBottomOf="@id/usernameLayout"
            app:layout_constraintTop_margin="16dp"
            app:layout_constraintStart_toStartOf="@id/usernameLayout"
            app:layout_constraintEnd_toEndOf="@id/usernameLayout">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/passwordEditText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:importantForAutofill="yes"
                android:inputType="textPassword"
                android:maxLines="1"
                android:text="@={viewModel.password}" />
        </com.google.android.material.textfield.TextInputLayout>

        <!-- ─────────── Forgot Password ─────────── -->
        <TextView
            android:id="@+id/forgotPasswordText"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:clickable="true"
            android:foreground="?attr/selectableItemBackgroundBorderless"
            android:padding="4dp"
            android:text="@string/action_forgot_password"
            android:textAppearance="@style/TextAppearance.MaterialComponents.Body2"
            android:textColor="?attr/colorPrimary"
            app:layout_constraintEnd_toEndOf="@id/passwordLayout"
            app:layout_constraintTop_toBottomOf="@id/passwordLayout"
            app:layout_constraintTop_margin="4dp" />

        <!-- ─────────── Login Button ─────────── -->
        <com.google.android.material.button.MaterialButton
            android:id="@+id/loginButton"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:enabled="@{viewModel.isLoginEnabled}"
            android:text="@string/action_sign_in"
            app:icon="@drawable/ic_login_24"
            app:iconTint="?attr/colorOnPrimary"
            app:layout_constraintTop_toBottomOf="@id/forgotPasswordText"
            app:layout_constraintTop_margin="24dp"
            app:layout_constraintStart_toStartOf="@id/passwordLayout"
            app:layout_constraintEnd_toEndOf="@id/passwordLayout"
            app:layout_constraintWidth_percent="1.0"
            app:onClick="@{() -> viewModel.onLoginClicked()}" />

        <!-- ─────────── Biometric Button ─────────── -->
        <com.google.android.material.button.MaterialButton
            android:id="@+id/biometricButton"
            android:layout_width="56dp"
            android:layout_height="56dp"
            android:visibility="@{isBiometricAvailable ? View.VISIBLE : View.GONE}"
            android:contentDescription="@string/desc_biometric_login"
            app:backgroundTint="?attr/colorSurface"
            app:icon="@drawable/ic_fingerprint_24"
            app:iconSize="32dp"
            app:shapeAppearanceOverlay="@style/ShapeAppearance.WellSphere.Circle"
            app:layout_constraintTop_toBottomOf="@id/loginButton"
            app:layout_constraintTop_margin="12dp"
            app:layout_constraintEnd_toEndOf="@id/loginButton"
            app:onClick="@{() -> viewModel.onBiometricClicked()}" />

        <!-- ─────────── Or Divider ─────────── -->
        <com.google.android.material.divider.MaterialDivider
            android:id="@+id/divider"
            android:layout_width="0dp"
            android:layout_height="1dp"
            android:alpha="0.20"
            app:layout_constraintTop_toBottomOf="@id/biometricButton"
            app:layout_constraintTop_margin="24dp"
            app:layout_constraintStart_toStartOf="@id/loginButton"
            app:layout_constraintEnd_toEndOf="@id/loginButton" />

        <TextView
            android:id="@+id/orLabel"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:background="@drawable/bg_or_label"
            android:paddingStart="12dp"
            android:paddingEnd="12dp"
            android:text="@string/label_or"
            android:textAppearance="@style/TextAppearance.MaterialComponents.Caption"
            app:layout_constraintStart_toStartOf="@id/divider"
            app:layout_constraintEnd_toEndOf="@id/divider"
            app:layout_constraintTop_toTopOf="@id/divider" />

        <!-- ─────────── Sign Up Button ─────────── -->
        <com.google.android.material.button.MaterialButton
            android:id="@+id/signUpButton"
            style="?attr/materialButtonOutlinedStyle"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:text="@string/action_sign_up"
            app:layout_constraintTop_toBottomOf="@id/divider"
            app:layout_constraintTop_margin="24dp"
            app:layout_constraintStart_toStartOf="@id/divider"
            app:layout_constraintEnd_toEndOf="@id/divider"
            app:layout_constraintWidth_percent="1.0"
            app:onClick="@{() -> viewModel.onSignUpClicked()}" />

        <!-- ─────────── Progress Overlay ─────────── -->
        <FrameLayout
            android:id="@+id/progressOverlay"
            android:layout_width="0dp"
            android:layout_height="0dp"
            android:clickable="true"
            android:focusable="true"
            android:visibility="@{viewModel.isLoading ? View.VISIBLE : View.GONE}"
            android:background="@color/overlay_50"
            app:layout_constraintTop_toTopOf="parent"
            app:layout_constraintBottom_toBottomOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintEnd_toEndOf="parent">

            <com.airbnb.lottie.LottieAnimationView
                android:id="@+id/progressAnimation"
                android:layout_width="120dp"
                android:layout_height="120dp"
                android:layout_gravity="center"
                app:lottie_autoPlay="true"
                app:lottie_fileName="progress_spinner.json"
                app:lottie_loop="true"
                app:lottie_speed="1.1" />
        </FrameLayout>

        <!-- ─────────── Version Label ─────────── -->
        <TextView
            android:id="@+id/versionLabel"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:alpha="0.60"
            android:text='@{viewModel.appVersion}'
            android:textAppearance="@style/TextAppearance.MaterialComponents.Caption"
            app:layout_constraintBottom_toBottomOf="parent"
            app:layout_constraintBottom_margin="8dp"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintStart_toStartOf="parent" />
    </androidx.constraintlayout.widget.ConstraintLayout>
</layout>