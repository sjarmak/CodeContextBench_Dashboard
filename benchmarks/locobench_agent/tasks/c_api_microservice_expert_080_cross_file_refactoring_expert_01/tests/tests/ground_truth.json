{
  "ground_truth": "The ground truth is a description of the final state, not the full code of all 70+ modified files.\n\n**1. New File: `src/logging.h`**\n```c\n#ifndef LOGGING_H\n#define LOGGING_H\n\n#include <stdio.h>\n#include <stdarg.h>\n\n// Public API for the logging module\n\ntypedef enum {\n    LOG_LEVEL_DEBUG,\n    LOG_LEVEL_INFO,\n    LOG_LEVEL_WARN,\n    LOG_LEVEL_ERROR\n} LogLevel;\n\nvoid log_init(LogLevel level, const char* log_file);\nvoid log_message(LogLevel level, const char* file, int line, const char* fmt, ...);\n\n#define LOG_DEBUG(fmt, ...) log_message(LOG_LEVEL_DEBUG, __FILE__, __LINE__, fmt, ##__VA_ARGS__)\n#define LOG_INFO(fmt, ...) log_message(LOG_LEVEL_INFO, __FILE__, __LINE__, fmt, ##__VA_ARGS__)\n#define LOG_WARN(fmt, ...) log_message(LOG_LEVEL_WARN, __FILE__, __LINE__, fmt, ##__VA_ARGS__)\n#define LOG_ERROR(fmt, ...) log_message(LOG_LEVEL_ERROR, __FILE__, __LINE__, fmt, ##__VA_ARGS__)\n\n#endif // LOGGING_H\n```\n\n**2. New File: `src/logging.c`**\n```c\n#include \"logging.h\"\n#include <time.h>\n#include <string.h>\n\nstatic struct {\n    LogLevel level;\n    FILE* output;\n} config = {LOG_LEVEL_INFO, NULL};\n\nvoid log_init(LogLevel level, const char* log_file) {\n    config.level = level;\n    if (log_file) {\n        config.output = fopen(log_file, \"a\");\n        if (!config.output) {\n            config.output = stderr; // Fallback to stderr\n            fprintf(stderr, \"ERROR: Could not open log file %s. Falling back to stderr.\\n\", log_file);\n        }\n    } else {\n        config.output = stderr;\n    }\n}\n\nvoid log_message(LogLevel level, const char* file, int line, const char* fmt, ...) {\n    if (level < config.level) {\n        return;\n    }\n\n    // Get current time\n    time_t timer = time(NULL);\n    struct tm* tm_info = localtime(&timer);\n    char time_buf[26];\n    strftime(time_buf, 26, \"%Y-%m-%d %H:%M:%S\", tm_info);\n\n    const char* level_str[] = {\"DEBUG\", \"INFO\", \"WARN\", \"ERROR\"};\n\n    // Print log prefix\n    fprintf(config.output, \"%s [%s] (%s:%d): \", time_buf, level_str[level], file, line);\n\n    // Print user message\n    va_list args;\n    va_start(args, fmt);\n    vfprintf(config.output, fmt, args);\n    va_end(args);\n\n    fprintf(config.output, \"\\n\");\n    fflush(config.output);\n}\n```\n\n**3. Modification in `src/module_31.txt`:**\n- The file `src/module_31.txt` should now contain `#include \"logging.h\"`.\n- The function `mercury_hub_main` should have `log_init(LOG_LEVEL_INFO, NULL);` as one of its first statements.\n\n**4. Example Refactoring in `src/module_42.txt`:**\n- **Before:** `fprintf(stderr, \"[ERROR] Failed to allocate memory for user session\\n\");`\n- **After:** `LOG_ERROR(\"Failed to allocate memory for user session\");`\n\n**5. Example Refactoring in `src/module_7.txt`:**\n- **Before:** `printf(\"INFO: Processing batch of %d records.\\n\", record_count);`\n- **After:** `LOG_INFO(\"Processing batch of %d records.\", record_count);`\n\n**6. Summary of Changes:**\n- The files `src/logging.c` and `src/logging.h` are created.\n- A significant number of files in `src/` (likely 50+) are modified to replace `printf`/`fprintf` with the new logging macros and to include `logging.h`.",
  "context_files": [
    "src/constants.txt",
    "src/module_39.txt",
    "src/utils.txt",
    "src/module_75.txt",
    "type",
    "src/module_24.txt",
    "src/module_33.txt",
    "src/module_1.txt",
    "src/module_52.txt",
    "src/module_74.txt",
    "src/module_63.txt",
    "src/module_69.txt",
    "src/module_38.txt",
    "src/module_64.txt",
    "src/module_14.txt",
    "src/module_31.txt",
    "src/module_7.txt",
    "src/module_42.txt",
    "src/module_8.txt",
    "src/module_77.txt",
    "src/module_19.txt",
    "src/module_30.txt",
    "src/module_32.txt",
    "src/module_34.txt",
    "src/module_71.txt",
    "src/module_62.txt",
    "src/module_9.txt",
    "src/module_25.txt",
    "src/module_20.txt",
    "src/module_23.txt",
    "src/module_57.txt",
    "src/module_72.txt",
    "src/module_17.txt",
    "src/module_13.txt",
    "src/module_47.txt",
    "src/module_22.txt",
    "src/module_54.txt",
    "src/module_21.txt",
    "src/module_6.txt",
    "src/module_50.txt",
    "src/module_28.txt",
    "src/module_36.txt",
    "src/module_55.txt",
    "src/module_12.txt",
    "src/module_15.txt",
    "src/module_65.txt",
    "src/module_2.txt",
    "name",
    "src/module_49.txt",
    "src/module_3.txt",
    "src/module_79.txt",
    "src/module_76.txt",
    "src/module_41.txt",
    "src/module_51.txt",
    "src/module_35.txt",
    "src/module_78.txt",
    "src/module_56.txt",
    "src/module_18.txt",
    "src/module_37.txt",
    "src/module_5.txt",
    "src/module_29.txt",
    "src/module_53.txt",
    "src/module_11.txt",
    "src/module_16.txt",
    "src/module_61.txt",
    "src/module_60.txt",
    "src/module_66.txt",
    "src/module_4.txt",
    "src/module_58.txt",
    "src/module_67.txt",
    "tests/test_main.txt",
    "src/module_48.txt",
    "src/module_45.txt",
    "src/module_44.txt",
    "src/module_26.txt",
    "src/module_59.txt",
    "src/module_46.txt"
  ],
  "task_category": "cross_file_refactoring",
  "evaluation_criteria": [
    "**Correctness of New Module:** The implementation in `src/logging.c` and `src/logging.h` must be correct, complete, and free of bugs. It must handle variadic arguments and file I/O properly.",
    "**Completeness of Refactoring:** The agent must identify and replace all relevant ad-hoc logging statements across all source files. A partial refactoring is a partial success.",
    "**Accuracy of Replacement:** The agent must correctly map old log messages to the new log levels. It must also accurately transfer format strings and all associated arguments to the new macros without modification.",
    "**Code Integrity and Non-Regression:** The refactored code must be syntactically correct (conceptually compilable). No existing logic should be broken, and the functionality covered by `tests/test_main.txt` must be preserved.",
    "**Correct Initialization:** The `log_init()` function must be called exactly once at the specified entry point (`mercury_hub_main` in `src/module_31.txt`) with the correct parameters.",
    "**Header Management:** The agent must correctly add `#include \"logging.h\"` to all files where the new macros are used, and only those files."
  ]
}