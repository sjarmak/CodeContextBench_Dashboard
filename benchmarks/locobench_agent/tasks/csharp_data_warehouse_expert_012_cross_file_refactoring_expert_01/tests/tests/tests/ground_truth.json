{
  "ground_truth": "The expected outcome is a significant reduction in boilerplate code across multiple files, replaced by a robust, centralized pattern.\n\n**Key changes in the final state:**\n\n*   **`src/constants.txt`:**\n    *   Contains two new lines:\n        ```csharp\n        public const int API_MAX_RETRIES = 5;\n        public const int API_INITIAL_BACKOFF_MS = 200;\n        ```\n\n*   **`src/utils.txt`:**\n    *   Contains a new static class, `ResilienceHelper`, with a method signature similar to this:\n        ```csharp\n        public static class ResilienceHelper\n        {\n            public static async Task<T> ExecuteWithRetryAsync<T>(Func<Task<T>> operation)\n            {\n                int attempt = 0;\n                while (true)\n                {\n                    try\n                    {\n                        return await operation();\n                    }\n                    catch (Exception ex) when (IsTransient(ex) && attempt < Constants.API_MAX_RETRIES)\n                    {\n                        attempt++;\n                        var delay = TimeSpan.FromMilliseconds(Constants.API_INITIAL_BACKOFF_MS * Math.Pow(2, attempt - 1));\n                        // A real implementation would also include logging the retry attempt.\n                        await Task.Delay(delay);\n                    }\n                }\n            }\n\n            private static bool IsTransient(Exception ex)\n            {\n                // In a real system, this would be more robust.\n                return ex is HttpRequestException || ex is TimeoutException;\n            }\n        }\n        ```\n\n*   **`src/module_*.txt` files:**\n    *   Multiple files (likely 5-10 or more) will have their code changed.\n    *   Code blocks of 10-15 lines (e.g., a `for` loop with `try-catch` and `Task.Delay`) will be replaced by a single, elegant line:\n        *   **Before:** A complex, multi-line loop.\n        *   **After:** `var processResult = await ResilienceHelper.ExecuteWithRetryAsync(() => someApiService.GetDataAsync(request));`",
  "context_files": [
    "src/module_1.txt",
    "src/module_27.txt",
    "src/module_74.txt",
    "src/module_34.txt",
    "src/module_25.txt",
    "src/module_83.txt",
    "src/module_11.txt",
    "src/module_18.txt",
    "src/module_80.txt",
    "src/module_60.txt",
    "src/module_70.txt",
    "src/module_33.txt",
    "src/module_7.txt",
    "src/module_12.txt",
    "src/module_52.txt",
    "src/module_79.txt",
    "src/module_86.txt",
    "src/module_38.txt",
    "src/module_3.txt",
    "src/module_46.txt",
    "src/module_53.txt",
    "src/module_4.txt",
    "src/module_78.txt",
    "src/module_55.txt",
    "src/module_62.txt",
    "src/module_68.txt",
    "src/module_58.txt",
    "src/module_39.txt",
    "src/module_49.txt",
    "src/module_36.txt",
    "src/module_19.txt",
    "src/module_24.txt",
    "src/module_67.txt",
    "src/module_82.txt",
    "src/module_76.txt",
    "src/module_50.txt",
    "src/module_54.txt",
    "src/module_71.txt",
    "src/module_72.txt",
    "src/module_69.txt",
    "src/module_26.txt",
    "src/module_35.txt",
    "src/module_9.txt",
    "src/module_64.txt",
    "src/module_5.txt",
    "src/module_29.txt",
    "src/module_65.txt",
    "src/module_77.txt",
    "src/module_44.txt",
    "src/module_31.txt",
    "src/module_87.txt",
    "src/module_41.txt",
    "src/module_21.txt",
    "src/module_85.txt",
    "src/module_48.txt",
    "src/module_2.txt",
    "src/module_13.txt",
    "src/module_22.txt",
    "src/module_73.txt",
    "src/module_6.txt",
    "src/module_28.txt",
    "src/module_8.txt",
    "src/module_81.txt",
    "src/module_10.txt",
    "src/module_51.txt",
    "src/module_47.txt",
    "src/module_61.txt",
    "src/module_17.txt",
    "src/module_56.txt",
    "src/module_14.txt",
    "src/module_23.txt",
    "src/module_43.txt",
    "src/module_75.txt",
    "src/module_66.txt",
    "name",
    "src/module_42.txt",
    "src/module_30.txt",
    "src/utils.txt",
    "src/module_45.txt",
    "type",
    "src/module_40.txt",
    "src/module_63.txt",
    "src/constants.txt",
    "src/config.txt"
  ],
  "task_category": "cross_file_refactoring",
  "evaluation_criteria": [
    "**Correctness of Implementation:** The `ResilienceHelper` must correctly implement an exponential backoff strategy using the specified constants from `constants.txt`.",
    "**Completeness of Refactoring:** All identified ad-hoc retry loops across the relevant `module_*.txt` files must be successfully replaced.",
    "**Code Quality and Design:** The new `ResilienceHelper` must be generic (using `<T>`), asynchronous (`async/await`), and accept a delegate (`Func<Task<T>>`) to be maximally reusable.",
    "**Functional Preservation:** The refactoring must not alter the core business logic of the modules. The agent should only replace the error handling wrapper, not the operation itself.",
    "**Code Cleanliness:** The old, redundant retry loops and their associated variables must be completely removed from the codebase.",
    "**Configuration Centralization:** The agent must correctly add the new configuration values to `src/constants.txt` and use them in the `ResilienceHelper`, not hardcode them."
  ]
}