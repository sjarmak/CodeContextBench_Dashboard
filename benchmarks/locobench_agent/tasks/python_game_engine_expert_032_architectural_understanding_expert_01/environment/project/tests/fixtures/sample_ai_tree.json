{
  "version": "1.0.0",
  "metadata": {
    "createdBy": "LedgerQuest Engine Test Fixture",
    "createdAt": "2023-12-01T00:00:00Z",
    "engineVersion": ">=2.4.0",
    "description": "Sample AI behaviour tree used in unit-tests. Models a sales representative NPC in a business simulation."
  },
  "blackboard": {
    "leadQueue": [],
    "currentLead": null,
    "quota": 5,
    "closedDeals": 0,
    "quotaAchieved": false,
    "energy": 1.0,
    "cooldowns": {}
  },
  "root": "SalesBehaviourSelector",
  "nodes": {
    "SalesBehaviourSelector": {
      "id": "SalesBehaviourSelector",
      "type": "selector",
      "children": [
        "QuotaReachedSuccess",
        "NeedRestSequence",
        "ProcessLeadSequence",
        "IdleFallback"
      ]
    },
    "QuotaReachedSuccess": {
      "id": "QuotaReachedSuccess",
      "type": "condition",
      "name": "Quota Reached?",
      "script": "return blackboard['quotaAchieved']"
    },
    "NeedRestSequence": {
      "id": "NeedRestSequence",
      "type": "sequence",
      "name": "Handle Fatigue",
      "children": [
        "IsFatiguedCondition",
        "CooldownRestDecorator"
      ]
    },
    "IsFatiguedCondition": {
      "id": "IsFatiguedCondition",
      "type": "condition",
      "name": "Is Fatigued?",
      "script": "return blackboard['energy'] < 0.25"
    },
    "CooldownRestDecorator": {
      "id": "CooldownRestDecorator",
      "type": "decorator",
      "decoratorSubtype": "cooldown",
      "durationMs": 5000,
      "child": "RestTask"
    },
    "RestTask": {
      "id": "RestTask",
      "type": "task",
      "name": "Rest to Recover Energy",
      "script": "blackboard['energy'] = min(1.0, blackboard['energy'] + 0.5); return 'SUCCESS'"
    },
    "ProcessLeadSequence": {
      "id": "ProcessLeadSequence",
      "type": "sequence",
      "name": "Process Next Lead",
      "children": [
        "HasLeadsCondition",
        "PopLeadTask",
        "ContactLeadTask",
        "UpdateQuotaTask"
      ]
    },
    "HasLeadsCondition": {
      "id": "HasLeadsCondition",
      "type": "condition",
      "name": "Lead Queue Not Empty?",
      "script": "return len(blackboard['leadQueue']) > 0"
    },
    "PopLeadTask": {
      "id": "PopLeadTask",
      "type": "task",
      "name": "Pop Next Lead",
      "script": "blackboard['currentLead'] = blackboard['leadQueue'].pop(0); return 'SUCCESS'"
    },
    "ContactLeadTask": {
      "id": "ContactLeadTask",
      "type": "task",
      "name": "Contact Lead",
      "script": "import random\\nsuccess = random.random() < 0.6\\nif success:\\n    blackboard['currentLead']['status'] = 'CLOSED'\\n    blackboard['closedDeals'] = blackboard.get('closedDeals', 0) + 1\\n    blackboard['energy'] = max(0.0, blackboard['energy'] - 0.1)\\n    blackboard['quotaAchieved'] = blackboard['closedDeals'] >= blackboard['quota']\\n    return 'SUCCESS'\\nelse:\\n    blackboard['currentLead']['status'] = 'OPEN'\\n    blackboard['energy'] = max(0.0, blackboard['energy'] - 0.2)\\n    return 'FAILURE'"
    },
    "UpdateQuotaTask": {
      "id": "UpdateQuotaTask",
      "type": "task",
      "name": "Update Quota Progress",
      "script": "blackboard['quotaAchieved'] = blackboard['closedDeals'] >= blackboard['quota']; return 'SUCCESS'"
    },
    "IdleFallback": {
      "id": "IdleFallback",
      "type": "task",
      "name": "Idle",
      "script": "blackboard['energy'] = min(1.0, blackboard['energy'] + 0.05); return 'SUCCESS'"
    }
  }
}