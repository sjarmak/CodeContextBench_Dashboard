# -----------------------------------------------------------------------------
#  CommerceSphere Enterprise Suite – Production Configuration
# -----------------------------------------------------------------------------
#  This file contains opinionated defaults for running the monolith in a
#  hardened production context. All credentials MUST be provided through
#  environment variables or an external secret manager (e.g., Vault, AWS
#  Secrets Manager, Azure Key Vault). Never commit real secret values.
# -----------------------------------------------------------------------------

#########################################
# Core Server & Servlet Container
#########################################
server.port=8443
server.ssl.enabled=true
server.ssl.key-store=${KEYSTORE_PATH}
server.ssl.key-store-password=${KEYSTORE_PASSWORD}
server.ssl.key-store-type=PKCS12
server.ssl.key-alias=commerce
server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain,text/css,text/javascript,application/javascript
server.error.include-message=never
server.servlet.session.timeout=30m
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.http-only=true
server.servlet.session.tracking-modes=cookie

#########################################
# Spring Datasource & JPA (PostgreSQL)
#########################################
spring.datasource.url=jdbc:postgresql://db-prod.commercesphere.internal:5432/commerce_db
spring.datasource.username=${DATABASE_USERNAME}
spring.datasource.password=${DATABASE_PASSWORD}
spring.datasource.hikari.maximum-pool-size=30
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.leak-detection-threshold=15000

spring.jpa.hibernate.ddl-auto=none
spring.jpa.open-in-view=false
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQL95Dialect
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true

# 2nd-level cache (JCache/Ehcache 3.x)
spring.jpa.properties.hibernate.cache.use_second_level_cache=true
spring.jpa.properties.hibernate.cache.use_query_cache=true
spring.jpa.properties.hibernate.cache.region.factory_class=org.hibernate.cache.jcache.JCacheRegionFactory
spring.cache.jcache.config=classpath:ehcache.xml

#########################################
# Liquibase – DB Schema Management
#########################################
spring.liquibase.enabled=true
spring.liquibase.change-log=classpath:db/master-changelog.xml
spring.liquibase.rollback-file=classpath:db/liquibase/rollback.sql

#########################################
# Redis – Spring Cache & Session
#########################################
spring.cache.type=redis
spring.redis.host=redis-cache-prod.internal
spring.redis.port=6379
spring.redis.ssl.enabled=true
spring.redis.password=${REDIS_PASSWORD}
spring.redis.timeout=3000

#########################################
# Kafka – Asynchronous Domain Events
#########################################
spring.kafka.bootstrap-servers=kafka-broker-1.internal:9093,kafka-broker-2.internal:9093
spring.kafka.properties.security.protocol=SSL
spring.kafka.properties.ssl.truststore.location=classpath:certs/kafka-truststore.jks
spring.kafka.properties.ssl.truststore.password=${KAFKA_TRUSTSTORE_PASSWORD}
spring.kafka.properties.ssl.keystore.location=classpath:certs/kafka-keystore.jks
spring.kafka.properties.ssl.keystore.password=${KAFKA_KEYSTORE_PASSWORD}
spring.kafka.properties.ssl.key.password=${KAFKA_KEY_PASSWORD}
spring.kafka.consumer.group-id=commerce-suite
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.producer.compression-type=zstd
spring.kafka.producer.retries=3
spring.kafka.producer.acks=all

#########################################
# Logging – Logback (External XML)
#########################################
logging.config=classpath:logback-prod.xml
logging.level.org.springframework=INFO
logging.level.org.hibernate.SQL=ERROR
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=ERROR
logging.level.com.commercesphere=DEBUG

#########################################
# Security – JWT & Rate-Limiting
#########################################
security.jwt.public-key=classpath:keys/public.pem
security.jwt.access-token-validity=900          # 15 minutes
security.jwt.refresh-token-validity=1209600     # 14 days

security.login.rate-limiter.enabled=true
security.login.rate-limiter.max-attempts=5
security.login.rate-limiter.time-window=15m

#########################################
# Management & Observability
#########################################
management.server.port=8081
management.server.address=127.0.0.1
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when_authorized

#########################################
# Third-Party Payment Provider (Stripe)
#########################################
payment.stripe.api-key=${STRIPE_API_KEY}
payment.stripe.signing-secret=${STRIPE_SIGNING_SECRET}

#########################################
# Email (AWS SES)
#########################################
spring.mail.host=email-smtp.us-east-1.amazonaws.com
spring.mail.port=587
spring.mail.username=${SMTP_USERNAME}
spring.mail.password=${SMTP_PASSWORD}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.connectiontimeout=5000
spring.mail.properties.mail.smtp.timeout=5000
spring.mail.properties.mail.smtp.writetimeout=5000
spring.mail.default-encoding=UTF-8
spring.mail.test-connection=false

#########################################
# External REST Integrations
#########################################
inventory.service.url=https://inventory-gw.internal.svc.cluster:9443
taxation.service.url=https://taxation.api.com

#########################################
# AWS S3 – Catalog Image Storage
#########################################
commerce.catalog.image-storage.backend=s3
commerce.catalog.image-storage.bucket=commerce-prod-images
aws.access-key=${AWS_ACCESS_KEY_ID}
aws.secret-key=${AWS_SECRET_ACCESS_KEY}
aws.region=us-east-1

#########################################
# Feature Toggles
#########################################
feature.toggles.enable-tiered-pricing=true
feature.toggles.enable-contract-pricing=true
feature.toggles.enable-promotional-engine=true

#########################################
# Async Executor (Spring @Async)
#########################################
task.execution.pool.core-size=10
task.execution.pool.max-size=50
task.execution.pool.queue-capacity=1000
task.execution.thread-name-prefix=cs-async-

#########################################
# Caching Policies (ISO-8601 Durations)
#########################################
cache.ttl.catalog=PT12H
cache.ttl.pricing=PT5M

#########################################
# Scheduled Jobs (Quartz/Spring)
#########################################
jobs.data-retention.cron=0 0 3 * * ?         # Daily at 03:00
gdpr.erase.grace-period-days=30

#########################################
# OpenAPI / Swagger
#########################################
springdoc.api-docs.enabled=false
springdoc.swagger-ui.enabled=false

#########################################
# SAML 2.0 – Enterprise SSO
#########################################
saml2.relyingparty.registration.commercesphere.identityprovider.metadata-location=https://idp.prod.com/metadata
saml2.relyingparty.registration.commercesphere.identityprovider.signing=classpath:keys/idp_signing.pem
saml2.relyingparty.registration.commercesphere.identityprovider.single-sign-on-service.binding=post

#########################################
# Rate Limiting – Domain-Specific
#########################################
rate-limiter.orders.bucket-capacity=200
rate-limiter.orders.refill-tokens=50
rate-limiter.orders.refill-period=1m

# -----------------------------------------------------------------------------
#  End of application-prod.properties
# -----------------------------------------------------------------------------