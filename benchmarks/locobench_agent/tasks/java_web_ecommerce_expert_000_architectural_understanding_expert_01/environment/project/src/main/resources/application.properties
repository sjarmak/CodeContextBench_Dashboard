# --------------------------------------------------------------------
# CommerceSphere Enterprise Suite – Application Runtime Configuration
# --------------------------------------------------------------------
# This properties file bootstraps the entire monolithic JVM. 
# Every layer (MVC, REST, Service, Repository) reads settings from here
# at startup via Spring’s Environment abstraction.  
#
# Environment-specific overrides are supplied through:
#   1) OS environment variables  (e.g. DB_PASSWORD, SSL_KEYSTORE_PASSWORD)
#   2) Externalized *.properties / *.yml profiles (dev, staging, prod)
#   3) Kubernetes / Docker secrets & ConfigMaps
#
# Use ${VAR:default} syntax so that the suite starts with sane defaults
# but can be hardened in production without rebuilding artifacts.
# --------------------------------------------------------------------

#######################################################################
#  Core Application
#######################################################################
spring.application.name=commerce-sphere-enterprise-suite

# Server / Servlet
server.port=8443
server.servlet.context-path=/api
server.servlet.session.timeout=30m
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.same-site=strict

# TLS (terminates inside JVM *and* at ingress for mTLS)
server.ssl.enabled=true
server.ssl.key-store=classpath:keystore/commerce-sphere.jks
server.ssl.key-store-type=JKS
server.ssl.key-store-password=${SSL_KEYSTORE_PASSWORD:changeit}
server.ssl.key-password=${SSL_KEY_PASSWORD:changeit}

#######################################################################
#  Database – PostgreSQL 14.x
#######################################################################
spring.datasource.url=jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:commerce_sphere}
spring.datasource.username=${DB_USERNAME:cs_admin}
spring.datasource.password=${DB_PASSWORD:cs_changeit}

# HikariCP
spring.datasource.hikari.pool-name=cs-datasource-pool
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=30000       # 30 seconds
spring.datasource.hikari.max-lifetime=1800000     # 30 minutes
spring.datasource.hikari.validation-timeout=5000  #  5 seconds

# JPA / Hibernate
spring.jpa.open-in-view=false
spring.jpa.show-sql=false
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQL95Dialect
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true
spring.jpa.properties.hibernate.format_sql=false

# Flyway – DB versioning
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.validate-on-migrate=true
spring.flyway.out-of-order=false

#######################################################################
#  Caching – Redis 7.x
#######################################################################
spring.cache.type=redis
spring.redis.host=${REDIS_HOST:localhost}
spring.redis.port=${REDIS_PORT:6379}
spring.redis.password=${REDIS_PASSWORD:}
spring.redis.ssl.enabled=true
spring.redis.timeout=5000ms
spring.cache.redis.time-to-live=600s

#######################################################################
#  Messaging – Kafka (Order Events, Audit Trails)
#######################################################################
spring.kafka.bootstrap-servers=${KAFKA_HOST:localhost}:${KAFKA_PORT:9092}
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer
spring.kafka.consumer.group-id=commerce-sphere-consumers
spring.kafka.consumer.auto-offset-reset=earliest

#######################################################################
#  Async Task Execution
#######################################################################
spring.task.execution.pool.core-size=20
spring.task.execution.pool.max-size=50
spring.task.execution.shutdown.await-termination=true
spring.task.execution.shutdown.await-termination-period=30s

#######################################################################
#  Security – OAuth2/JWT
#######################################################################
spring.security.oauth2.resourceserver.jwt.issuer-uri=${OAUTH_ISSUER:https://auth.commercesphere.com}
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${OAUTH_JWKS_URI:https://auth.commercesphere.com/.well-known/jwks.json}

#######################################################################
#  Multipart / File Upload
#######################################################################
spring.servlet.multipart.max-file-size=25MB
spring.servlet.multipart.max-request-size=30MB

#######################################################################
#  Payment Gateway (PCI-DSS)
#######################################################################
commerce.payment.gateway.host=${PAYMENT_GATEWAY_HOST:sandbox.payments.local}
commerce.payment.gateway.api-key=${PAYMENT_GATEWAY_API_KEY:changeme}
commerce.payment.retry-policy.max-attempts=3
commerce.payment.retry-policy.backoff.initial-interval=2000  # ms
commerce.payment.retry-policy.backoff.max-interval=10000     # ms

#######################################################################
#  Application-Specific Toggles
#######################################################################
commerce.pricing.tiered.enabled=true
commerce.inventory.reservation.timeout=PT15M
commerce.audit.enabled=true
commerce.audit.sink.dir=${AUDIT_DIR:/var/log/commerce-sphere/audit}
commerce.compliance.pci.mode=SAQ-D
commerce.notification.enable-webhooks=true
commerce.notification.webhook.baseUrl=${WEBHOOK_BASE_URL:https://webhooks.commercesphere.com}

# Feature Flags
feature.quote-to-cash=true
feature.new-tax-engine=false

#######################################################################
#  REST API Meta
#######################################################################
commerce.api.version=v1
commerce.api.base-path=/api/${commerce.api.version}

# CORS
commerce.api.cors.allowed-origins=https://admin.commercesphere.com,https://app.commercesphere.com
commerce.api.cors.allowed-methods=GET,POST,PUT,PATCH,DELETE,OPTIONS
commerce.api.cors.allowed-headers=Authorization,Content-Type,X-Requested-With,Accept,Origin

# Idempotency
commerce.idempotency.header=X-Idempotency-Key
commerce.idempotency.expiration=PT24H

# Rate Limiting
commerce.rate-limit.enabled=true
commerce.rate-limit.permit-limit=100
commerce.rate-limit.refresh-period=1m

#######################################################################
#  Email (Order Confirmations, Password Resets)
#######################################################################
spring.mail.host=${SMTP_HOST:smtp.mailtrap.io}
spring.mail.port=2525
spring.mail.username=${SMTP_USERNAME}
spring.mail.password=${SMTP_PASSWORD}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true

#######################################################################
#  Logging
#######################################################################
logging.level.root=INFO
logging.level.com.commercesphere=DEBUG
logging.level.org.springframework.web=INFO
logging.file.name=${LOG_DIR:/var/log/commerce-sphere}/app-commercesphere.log
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{36} - %msg%n

#######################################################################
#  Actuator & Monitoring
#######################################################################
management.endpoints.web.exposure.include=health,info,metrics,beans,env,loggers,heapdump,threaddump
management.endpoint.health.show-details=when-authorized
management.endpoint.health.probes.enabled=true
management.metrics.tags.application=commerce-sphere

#######################################################################
#  Error Handling
#######################################################################
server.error.whitelabel.enabled=false
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=on_param

#######################################################################
#  Swagger / OpenAPI
#######################################################################
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html