# Ralph Progress Log
Started: Sat Jan 31 23:09:13 EST 2026
---

## Codebase Patterns
- 10Figure corpus lives at `~/10Figure-Codebases/src/{repo}/` with repos: kubernetes, envoy, django, tensorflow
- Base Docker image built via `base/build.sh`, copies entire corpus (~6-8GB) into container at `/10figure/`
- All tasks follow structure: `instruction.md`, `task.toml`, `task.yaml`, `environment/Dockerfile`, `tests/test.sh`, `tests/expected_changes.json`
- Validation uses `/10figure/scripts/validate_patch.py` inside the container (not in benchmark dir)
- Task Dockerfiles inherit from `harbor-10figure:base`, specified in `task.toml` as `localhost/harbor-10figure:base`
- sg-benchmarks org has `kubernetes--latest` mirror; django has 230 SWE-bench commit mirrors; no envoy/tensorflow mirrors yet
- Existing 4 scored tasks are all Kubernetes-only (api_upgrade_01, bug_localization_01, cross_file_reasoning_01, refactor_rename_01)
- Template `templates/test.sh.j2` generates test.sh scripts; expects patch at `/logs/agent/patch.diff`

## 2026-01-31 - US-003
- Created `benchmarks/10figure/templates/cross_repo_test.sh.j2` for cross-repo task validation
- Template splits combined patch into per-repo patches, validates each with validate_patch.py, computes weighted score
- Template variable `repo_weights` accepts "repo_name:weight repo_name:weight" format (e.g., "kubernetes:0.6 envoy:0.4")
- Writes per-repo breakdown to `/logs/verifier/validation_result.json` and combined reward to `/logs/verifier/reward.txt`
- Files changed: `benchmarks/10figure/templates/cross_repo_test.sh.j2`, `prd.json`
- **Learnings for future iterations:**
  - Patch splitting detects repo by looking for `/{repo_name}/` in diff headers (e.g., `diff --git a/src/kubernetes/...`)
  - Weight validation ensures sum is 1.0 (with 0.01 tolerance for floating point)
  - Per-repo validation runs validate_patch.py with `cwd` set to the repo directory
  - Template uses inline Python scripts rather than external scripts for portability in containers
---

## 2026-01-31 - US-002
- Rewrote `benchmarks/10figure/base/Dockerfile` as multi-stage build (builder strips .git + copies only 4 target repos; runtime installs deps)
- Updated `benchmarks/10figure/base/build.sh` with validation for all 4 repos and image size reporting
- Added pinned commit SHA env vars (KUBERNETES_SHA, ENVOY_SHA, DJANGO_SHA, TENSORFLOW_SHA)
- Files changed: `benchmarks/10figure/base/Dockerfile`, `benchmarks/10figure/base/build.sh`, `prd.json`
- **Learnings for future iterations:**
  - The corpus .git dirs are small (~195MB total) since repos are shallow/partial clones
  - 4 target repos total ~1.1GB source; full corpus is 3.6GB (has 24 repos total)
  - Multi-stage build discards builder layer, so .git stripping and intermediate copies don't add to final image
  - build.sh uses podman (not docker) - check `podman` availability on target system
---

## 2026-01-31 - US-001
- Resolved all 4 open questions in `tasks/prd-10figure-benchmark-expansion.md`
- Pinned commit SHAs from local 10Figure-Codebases corpus: kubernetes=ef274e86, envoy=782c6cae, django=c4e07f94, tensorflow=420baf67
- Decisions: single combined patch, existing corpus-copy image strategy, per-repo weighted scoring
- Files changed: `tasks/prd-10figure-benchmark-expansion.md`, `prd.json`, `progress.txt`
- **Learnings for future iterations:**
  - sg-benchmarks org only has kubernetes--latest and django SWE-bench mirrors; envoy and tensorflow need new mirrors for MCP indexing
  - The corpus is pre-built externally (not cloned inside Docker); base image just copies it in
  - No tags in the corpus repos (shallow/partial clones), so `git describe --tags` fails; use commit SHA directly
---
